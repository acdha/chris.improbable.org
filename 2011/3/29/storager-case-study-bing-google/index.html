<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Storager case study: Bing, Google</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all">
        <!--[if lte IE 8]>
            <link
                rel="stylesheet"
                href="/static/css/ie-fixes.css"
                type="text/css"
                media="all"
            />
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->

        <meta http-equiv="last-modified" content="Tue, 29 Mar 2011 04:57:17 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1><a href="/about/">Chris Adams</a></h1>
                <h2>Programmer, cyclist, photographer</h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a rel="me" href="https://code4lib.social/@acdha">Mastodon</a>
                </li>
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="https://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="https://pinboard.in/u:acdha/" rel="me">Pinboard</a>
                </li>
                <li>
                    <a href="https://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2011-03-29T00:26:23-04:00">
                    <meta itemprop="dateModified" content="2011-03-29T00:26:23-04:00">
                    <time class="date" itemprop="datePublished" datetime="2011-03-29T04:26:23+00:00">Mar 29</time>
                    <h2 class="" itemprop="title">Storager case study: Bing, Google</h2>
                </header>

                <div class="body" itemprop="articleBody"><div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/053e1a8e2d840c59">
                        <blockquote>
                            <h2>
                                Storager
                            </h2>
                            <p>
                                Last week I posted my <a href="http://www.stevesouders.com/blog/2011/03/14/mobile-comparison-of-top-11/">mobile comparison of 11 top sites</a>. One benefit of analyzing top websites is finding new best practices. In that survey I found that the mobile version of Bing used <a href="http://dev.w3.org/html5/webstorage/">localStorage</a> to reduce the size of their HTML document from ~200 kB to ~30 kB. This is a good best practice in general and makes even more sense on mobile devices where latencies are higher, caches are smaller, and localStorage is widely supported.
                            </p>
                            <p>
                                I wanted to further explore Bing’s use of localStorage for better performance. One impediment is that there’s no visibility into localStorage on a mobile device. So I created a new bookmarklet, <a href="http://stevesouders.com/mobileperf/storager.php">Storager</a>, and added it to the <a href="http://stevesouders.com/mobileperf/mobileperfbkm.php">Mobile Perf uber bookmarklet</a>. (In other words, just install <a href="http://stevesouders.com/mobileperf/mobileperfbkm.php">Mobile Perf</a> – it bundles Storager and other mobile bookmarklets.)
                            </p>
                            <p>
                                Storager lets you view, edit, clear, and save localStorage for any web page on any browser – including mobile. Viewing localStorage on a 320×480 screen isn’t ideal, so I did the obvious next step and integrated Storager with <a href="http://jdrop.org/">Jdrop</a>. With these pieces in place I’m ready to analyze how Bing uses localStorage.
                            </p>
                            <h2>
                                Bing localStorage
                            </h2>
                            <p>
                                My investigation begins by loading Bing on my mobile device – after the usual redirects I end up at the URL <a href="http://m.bing.com/?mid=10006">http://m.bing.com/?mid=10006</a>. Opening Storager from the Mobile Perf bookmarklet I see that localStorage has ~10 entries. Since I’m not sure when these were written to localStorage I clear localStorage (using Storager) and hit reload. Opening Storager again I see the same ~10 entries and save those to Jdrop. I show the truncated entries below. I made the results public so you can also <a href="http://jdrop.org/view?id=888">view the Storager results in Jdrop</a>.
                            </p>
                            <pre style="padding-left:0px;padding-bottom:1em;font-size:0.9em">
<strong>BGINFO:</strong> {"PortraitLink":"http://www.bing.com/fd/hpk2/Legzira_EN-US262...
<strong>CApp.Home.FD66E1A3:</strong> #ContentBody{position:relative;overflow:hidden;height:100%;-w...
<strong>CUX.Keyframes.B8625FE...:</strong> @-webkit-keyframes scaleout{from{-webkit-transform:scale3d(1,...
<strong>CUX.Site.18BDD936:</strong> *{margin:0;padding:0}table{border-collapse:separate;border-sp...
<strong>CUX.SiteLowRes.C8A1DA...:</strong> .blogoN{background-image:url(data:image/png;base64,iVBORw0KGg...
<strong>JApp.Home.DE384EBF:</strong> (function(){function a(){Type.registerNamespace("SS");SS.Home...
<strong>JUX.Compat.0907AAD4:</strong> function $(a){return document.getElementById(a)}var FireEvent...
<strong>JUX.FrameworkCore.A39...:</strong> (function(){function a(){Type.registerNamespace("BM");AjaxSta...
<strong>JUX.MsCorlib.172D90C3:</strong> window.ss={version:"0.6.1.0",isUndefined:function(a){return a...
<strong>JUX.PublicJson.540180...:</strong> if(!this.JSON)this.JSON={};(function(){function c(a){return a...
<strong>JUX.UXBaseControls.25...:</strong> (function(){function a(){Type.registerNamespace("UXControls")...
<strong>RMSM.Keys:</strong> CUX.Site.18BDD936~CUX.Keyframes.B8625FEE~CApp.Home.FD66E1A3~C...
</pre>
                            <p>
                                These entries are written to localStorage as part of downloading the Bing search page. These entries add up to ~170 kB in size (uncompressed). This would explain the large size of the Bing HTML document on mobile. We can verify that these keys are downloaded via the HTML document by searching for a unique string from the data such as “FD66E1A3″. We find this string in the <a href="http://jdrop.org/view?id=895">Bing document source (saved in Jdrop)</a> as the id of a STYLE block:
                            </p>
                            <pre style="padding-left:0px;padding-bottom:1em;font-size:0.9em">
&lt;style data-rms="done" id="CApp.Home.FD66E1A3" rel="stylesheet" type="text/css"&gt;
#ContentBody{position:relative;overflow:hidden;height:100%;-webkit-tap-highlight-color:...
</pre>
                            <p>
                                Notice how the content of this STYLE block matches the data in localStorage. The other localStorage entries also correspond to SCRIPT and STYLE blocks in the initial HTML document. Bing writes these blocks to localStorage and then on subsequent page views reads them back and inserts them into the document resulting in a much smaller HTML document download size. The Bing server knows which blocks are in the client’s localStorage via a cookie, where the cookie is comprised of the localStorage keys delimited by “~”:
                            </p>
                            <pre style="padding-left:0px;padding-bottom:1em;font-size:0.9em">
RMSM=JApp.Home.DE384EBF~JUX.UXBaseControls.252CB7BF~JUX.FrameworkCore.A39F6425~
JUX.PublicJson.540180A4~JUX.Compat.0907AAD4~JUX.MsCorlib.172D90C3~CUX.SiteLowRes.C8A1DA4E~
CApp.Home.FD66E1A3~CUX.Keyframes.B8625FEE~CUX.Site.18BDD936~;
</pre>
                            <p>
                                Just to be clear, everything above happens during the loading of the <em>blank</em> Bing search page. Once a query is issued the search results page downloads <a href="http://jdrop.org/view?id=889">more keys</a> (~95 kB additional data) and expands the cookie with the new key names.
                            </p>
                            <h2>
                                Google localStorage
                            </h2>
                            <p>
                                Another surprise from last week’s survey was that the mobile version of Google Search had 68 images in the results HTML document as data: URIs, compared to only 10 for desktop and iPad. Mobile browsers open fewer TCP connections and these connections are typically slower compared to desktop, so reducing the number of HTTP requests is important.
                            </p>
                            <p>
                                The additional size from inlining data: URIs doesn’t account for the large size of the Google Search results page, so perhaps localStorage is being seeded here, too. Using Storager we see over <a href="http://jdrop.org/view?id=897">130 entries in localStorage</a> after a search for flowers. Here’s a sample. (As before, the key names and values may be truncated.)
                            </p>
                            <pre style="padding-left:0px;padding-bottom:1em;font-size:0.9em">
 mres.-8Y5Dw_nSfQztyYx: &lt;style&gt;a{color:#11c}a:visited{color:#551a8b}body{margin:0;pad...
 mres.-Kx7q38gfNkQMtpx: &lt;script&gt; //&lt;![CDATA[ var Zn={},bo=function(a,b){b&amp;&amp;Zn[b]||(ne...
 mres.0kH3gDiUpLA5DKWN: &lt;style&gt;.zl9fhd{padding:5px 0 0}.sc59bg{clear:both}.pyp56b{tex...
 mres.0thHLIQNAKnhcwR4: &lt;style&gt;.fdwkxt{width:49px;height:9px;background:url("data:ima...
 mres.36ZFOahhhEK4t3WE: &lt;script&gt; //&lt;![CDATA[ var kk,U,lk;(function(){var a={};U=funct...
 mres.3lEpts5kTxnI2I5S: &lt;script&gt; //&lt;![CDATA[ var Ec,Fc,Gc=function(a){this.Jl=a},Hc="...
 mres.4fbdvu9mdAaBINjE: &lt;script&gt; //&lt;![CDATA[ u("_clOnSbt",function(){var a=document.g...
 mres.5QIb-AahnDgEGlYP: &lt;script&gt; //&lt;![CDATA[ var cb=function(a){this.Cc=a},db=/\s*;\s...
 mres:time.-8Y5Dw_nSfQ...: 1301368541872
 mres:time.-Kx7q38gfNk...: 1301368542755
 mres:time.0kH3gDiUpLA...: 1301368542257
 mres:time.0thHLIQNAKn...: 1301368542223
 mres:time.36ZFOahhhEK...: 1301368542635
 mres:time.3lEpts5kTxn...: 1301368542579
 mres:time.4fbdvu9mdAa...: 1301368542720
 mres:time.5QIb-AahnDg...: 1301368542856
</pre>
                            <p>
                                Searching the search results <a href="http://jdrop.org/view?id=898">docsource</a> for a unique key such as “8Y5D” we find:
                            </p>
                            <pre style="padding-left:0px;padding-bottom:1em;font-size:0.9em">
&lt;style id="r:-8Y5Dw_nSfQztyYx" type="text/css"&gt;
a{color:#11c}a:visited{color:#551a8b}body{margin:0;padding:0}...
</pre>
                            <p>
                                Again we see that multiple SCRIPT and STYLE blocks are being saved to localStorage totaling 154 kB. On subsequent searches the HTML document size drops from the initial size of 220 kB uncompressed (74 kB compressed) to 67 kB uncompressed (16 kB compressed). In addition to the key names being saved in a cookie, it appears that an epoch time (in milliseconds) is associated with each key.
                            </p>
                            <h2>
                                Conclusion
                            </h2>
                            <p>
                                Bing and Google Search make extensive use of localStorage for stashing SCRIPT and STYLE blocks that are used on subsequent page views. None of the other top sites from my previous post use localStorage in this way. Are Bing and Google Search onto something? Yes, definitely. As I pointed out in my previous post, this is another example of a performance best practice that is used on a top mobile site but is not in the recommendations from <a href="http://code.google.com/speed/page-speed/">Page Speed</a> or <a href="http://developer.yahoo.com/yslow/">YSlow</a>. Many of the performance best practices that I’ve evangelized over the last six years for desktop apply to mobile, but I believe there are specific mobile best practices that we’re just beginning to identify. I’ve started using “High Performance Mobile” as the title of future presentations. Another book? hmmm….
                            </p>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://www.stevesouders.com/blog/2011/03/28/storager-case-study-bing-google/">http://www.stevesouders.com/blog/2011/03/28/storager-case-study-bing-google/</a>
                    </p>
                </div>
            </article>

            <nav id="post-nav">


            </nav>
        </section>

        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the
                views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width: 0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a>
                This work is licensed under a
                <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported
                    License</a>.
            </p>
        </footer>

        <script async src="/static/js/common.js"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js" integrity="sha256-hj+5FRlAuvAFANiefn0PpJYCkV1X4QT9EgiPd+6QnCw=" crossorigin="anonymous"></script>
    </body>
</html>
