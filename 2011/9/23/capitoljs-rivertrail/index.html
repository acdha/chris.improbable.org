<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>CapitolJS, RiverTrail</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all">
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->

        <meta http-equiv="last-modified" content="Sat, 24 Sep 2011 02:11:54 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-2097834-1', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1><a href="/about/">Chris Adams</a></h1>
                <h2>Programmer, cyclist, photographer</h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="https://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="https://pinboard.in/u:acdha/" rel="me">Pinboard</a>
                </li>
                <li>
                    <a href="https://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2011-09-23T22:11:54-04:00">
                    <meta itemprop="dateModified" content="2011-09-23T22:11:54-04:00">
                    <time class="date" itemprop="datePublished" datetime="2011-09-24T02:11:54+00:00">Sep 24</time>
                    <h2 class="" itemprop="title">CapitolJS, RiverTrail</h2>
                </header>

                <div class="body" itemprop="articleBody"><div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/2357618699906b10">
                        <blockquote>
                            <p>
                                I took time away from the Mozilla all-hands last week to help out on-stage at the <a href="http://www.intel.com/idf/">Intel Developer Forum</a> with the introduction of <a href="http://blogs.intel.com/research/2011/09/pjs.php">RiverTrail</a>, Intel’s technology demonstrator for Parallel JS — JavaScript utilizing multicore (CPU) and ultimately graphics (GPU) parallel processing power, without shared memory <a href="http://brendaneich.com/2007/02/threads-suck/">threads (which suck)</a>.
                            </p>
                            <p>
                                Then over the weekend, I spoke at <a href="http://capitoljs.com/schedule.html">CapitolJS</a>, talking about ES6 and Dart, and demo’ing RiverTrail to the JS faithful. As usual, I’ll narrate <a href="http://www.slideshare.net/BrendanEich/capitol-js">my slides</a>, but look out for something new at the end: a screencast showing the RiverTrail IDF demo.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.001.png" height="432" width="576">
                            </p>
                            <p>
                                I had a lot to cover in a half-hour (a good talk-time in my view — we’ll see how the video comes out, but I found it invigorating). CapitolJS had a higher-than-<a href="http://jsconf.us/">JSConf</a> level of newcomers to JS in attendance, so I ran through material that should be familiar to readers of this blog, presented here without much commentary:
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.002.png" height="432" width="576">
                            </p>
                            <p>
                                The meaning of my color-coding should be intuitively obvious <img src="http://brendaneich.com/wp-includes/images/smilies/icon_wink.gif" alt=";-)"> .
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.003.png" height="432" width="576">
                            </p>
                            <p>
                                BTW, <a href="http://github.com/andreasgal/dom.js">dom.js</a>, with its <a href="http://brendaneich.com/2010/11/proxy-inception/">Proxy</a> usage under the hood, is going great, with <a href="https://twitter.com/#!/__DavidFlanagan">David Flanagan</a> and <a href="https://twitter.com/#!/donovanpreston">Donovan Preston</a> among others hacking away on it, and (this is important) providing <a href="http://lists.w3.org/Archives/Public/public-script-coord/">feedback</a> to <a href="http://www.w3.org/TR/WebIDL/">WebIDL</a>‘s editor, <a href="https://twitter.com/#!/heycam/">Cameron McCormack</a>.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.004.png" height="432" width="576">
                            </p>
                            <p>
                                Here I must add the usual caveat that “ES6″ might be renumbered. Were I more prudent, I’d call it “ES.next”, but it’s highly likely to be the 6th edition, and you’re all sophisticated close readers of the spec and its colorful history, right?
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.005.png" height="432" width="576">
                            </p>
                            <p>
                                The SpiderMonkey bug tracking <a href="http://wiki.ecmascript.org/doku.php?id=harmony:binary_data">binary data</a> prototype implementation is <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=578700">bug 578700</a>.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.006.png" height="432" width="576">
                            </p>
                            <p>
                                The SpiderMonkey bug tracking <a href="http://wiki.ecmascript.org/doku.php?id=harmony:quasis">quasi-literal</a> prototype implementation is <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=688857">bug 688857</a>.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.007.png" height="432" width="576">
                            </p>
                            <p>
                                The <code>@</code> notation is actually “out” for ES6, per the July meeting (see <a href="https://mail.mozilla.org/pipermail/es-discuss/2011-August/016188.html">notes</a>). Thanks to <a href="http://wiki.ecmascript.org/doku.php?id=harmony:private_name_objects">private name objects</a> and <a href="http://wiki.ecmascript.org/lib/exe/fetch.php?id=harmony%3Aprivate_name_objects&amp;cache=cache&amp;media=harmony:private-name-alternatives.pdf">object literal extensions</a> (see middle column), private access syntax is factored out of classes. Just use <code>this[x]</code> or <code>p[x]</code>, or (in an object literal for the computed property name, which need not be a private name) <code>[x]:</code> <i>value</i>.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.008.png" height="432" width="576">
                            </p>
                            <p>
                                As close to CoffeeScript as I can get them, given JS’s grammar and curly-brace (not indentation-based) block structure.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.009.png" height="432" width="576">
                            </p>
                            <p>
                                Ruby-esque, Smalltalk is the grandfather.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.010.png" height="432" width="576">
                            </p>
                            <p>
                                You know you want it.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.011.png" height="432" width="576">
                            </p>
                            <p>
                                I’ve been clear about preferring <a href="http://wiki.ecmascript.org/doku.php?id=strawman:block_lambda_revival">block-lambdas</a> over <a href="http://wiki.ecmascript.org/doku.php?id=strawman:arrow_function_syntax">arrows</a> for their added semantic value and compelling syntax mimicking control statements. It’s good to hear <a href="https://twitter.com/#!/jashkenas">@jashkenas</a> agree in effect.
                            </p>
                            <p>
                                <a href="https://twitter.com/#!/mikeal">@mikeal</a> is right that JS syntax is not a problem for some (perhaps many) users. For others, it’s a hardship. Adding block-lambdas helps that cohort, adds value for code generators (see Harmony Goals above), and on balance improves the language in my view. It won my straw show-of-hands poll at CapitolJS against all of arrows, vaguer alternatives, and doing nothing.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.012.png" height="432" width="576">
                            </p>
                            <p>
                                The epic <a href="http://news.ycombinator.com/item?id=2982256">Hacker News</a> thread on my last blog post in relation to Dart needs its own <a href="http://en.wikipedia.org/wiki/Baedeker">Baedeker</a>. For now I’ll just note that Dart and the politics evident in the memo are not making some of my standards pals who work for other browser vendors happy. Google may fancy itself the new Netscape, but it doesn’t have the market share to pull off proprietary power-move <i>de facto</i> standards.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.013.png" height="432" width="576">
                            </p>
                            <p>
                                The <a href="http://markmail.org/message/uro3jtoitlmq6x7t">leaked memo</a> makes some observations I agree with, some unbacked assertions about unfixable JS problems that TC39 work in progress may falsify this year, and a few implicit arguments that are just silly on their face.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.014.png" height="432" width="576">
                            </p>
                            <p>
                                Still, I think we should react to valid complaints about JS, whatever the source. The <code>number</code> type has well-known <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=5856">usability</a> and (in practice, in spite of aggressively optimizing JIT-compiling VMs) <a href="http://blog.mozilla.com/dmandelin/2011/06/16/know-your-engines-at-oreilly-velocity-2011/">performance</a> problems.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.015.png" height="432" width="576">
                            </p>
                            <p>
                                The last bullet shows pragmas for switching default numeric type and arithmetic evaluation regime. This would have to affect <code>Number</code> and <code>Math</code>, but lexically — no dynamic scope. Still a bit hairy, and not yet on the boards for Harmony. But perhaps it ought to be.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.016.png" height="432" width="576">
                            </p>
                            <p>
                                Links: [<a href="http://blog.mozilla.com/dmandelin/2011/06/16/know-your-engines-at-oreilly-velocity-2011/">it's true</a>], [<a href="https://wiki.mozilla.org/TypeInference">SpiderMonkey Type Inference</a>].
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.017.png" height="432" width="576">
                            </p>
                            <p>
                                Coordinated strawman prototyping in SpiderMonkey and V8 is a tall order. Perhaps we need a separate <a href="http://jswg.org/">jswg.org</a>, as whatwg.org is to the w3c, to run ahead? I’ve been told I should be BDFL of such an org. Would this work? Comments welcome.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.018.png" height="432" width="576">
                            </p>
                            <p>
                                Remember, <a href="http://en.wikipedia.org/wiki/GPU">ridiculously</a> <a href="http://en.wikipedia.org/wiki/Multi-core_processor">parallel</a> processing power is coming, if not already present, on your portable devices. It’s here on your laptops and desktops. The good news is that JS can exploit it without your having to deal with data races and deadlocks.
                            </p>
                            <p>
                                <a href="http://github.com/RiverTrail/RiverTrail">RiverTrail</a> is a <a href="http://github.com/mozilla/narcissus">Narcissus</a>-based JS to <a href="http://en.wikipedia.org/wiki/OpenCL">OpenCL</a> compiler, packaged as a Firefox add-on. It demonstrates the utility of a new <code>ParallelArray</code> built-in, based on <a href="http://www.khronos.org/registry/typedarray/specs/latest/">typed arrays</a>. The JS-to-OpenCL compiler automatically multicore-short-vectorizes your JS for you.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.019.png" height="432" width="576">
                            </p>
                            <p>
                                As noted in the previous slide, because the <code>ParallelArray</code> methods compile to parallelized folds (see <a href="http://en.wikipedia.org/wiki/Guy_L._Steele,_Jr.">Guy Steele’s</a> excellent <a href="http://vimeo.com/6624203">ICFP 2009 keynote</a>), associative operations will be reordered, resulting in small non-deterministic floating point imprecision errors. This won’t matter for graphics code in general, and it’s an inevitable cost of business using parallel floating point hardware.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.020.png" height="432" width="576">
                            </p>
                            <p>
                                The code looks like typical JS, with no hairy callbacks, workers, or threads. It requires thinking in terms of immutable trees and reductions or other folds, but that is not a huge burden. As Guy’s talk makes plain, learning to program this way is the key to parallel speedups.
                            </p>
                            <p>
                                Here is my screencast of the demo. Alas, since RiverTrail currently targets the <a href="http://en.wikipedia.org/wiki/Intel_Core_i7">CPU</a> and its short vector unit (<a href="http://en.wikipedia.org/wiki/SSE4">SSE4</a>), and my screencast software uses the same parallel hardware, the frame rate is not what it should be. But not to worry, we’re working on GPU targeting too.
                            </p>
                            <p>
                                <iframe width="560" height="315" src="http://www.youtube.com/embed/QzOIydC2Has"></iframe>
                            </p>
                            <p>
                                At CapitolJS and without <a href="http://www.telestream.net/screen-flow/">ScreenFlow</a> running, I saw frame rates above 35 for the Parallel demo, compared to 3 or 2 for Sequential.
                            </p>
                            <p>
                                The point of a technology demonstrator is to show where real JS engines can go. Automatic parallelization of <code>ParallelArray</code>-based code can be done by next year’s JS engines, based on this year’s Firefox add-on. We’re very close to exploiting massively parallel hardware from JS, without having to write <a href="http://webcl.nokiaresearch.com/">WebCL</a> and risk terrible safety and DoS bugs.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.021.png" height="432" width="576">
                            </p>
                            <p>
                                To close, I sought inspiration from Wesley Snipes in <a href="http://www.imdb.com/title/tt0105104/">Passenger 57</a>. Ok, not his best movie, but I miss the ’90s action movie era.
                            </p>
                            <p>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/CapitolJS.022.png" height="432" width="576">
                            </p>
                            <p>
                                Seriously, the shortest path on the Web usually is the winning play. JS is demonstrably able to grow new capabilities with less effort than a “replacement” entails. Always bet on JS!
                            </p>
                            <p>
                                /be
                            </p>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://brendaneich.com/2011/09/capitoljs-rivertrail/">http://brendaneich.com/2011/09/capitoljs-rivertrail/</a>
                    </p>
                </div>
            </article>

            <nav id="post-nav">


            </nav>

            <script id="discus-javascript">
                var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script>

            <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>

        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a>
                This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer>

        <script async src="/static/js/common.js"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js" integrity="sha256-hj+5FRlAuvAFANiefn0PpJYCkV1X4QT9EgiPd+6QnCw=" crossorigin="anonymous"></script>
    </body>
</html>
