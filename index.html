<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>
            Chris Adams' Blog
        </title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all"><!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->
        <meta name="author" content="Chris Adams">
        <link rel="author" href="https://plus.google.com/116562742092842686896/posts">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script type="application/javascript">
var _prum={id:"5166be01e6e53d1007000001"};var PRUM_EPISODES=PRUM_EPISODES||{};PRUM_EPISODES.q=[];PRUM_EPISODES.mark=function(b,a){PRUM_EPISODES.q.push(["mark",b,a||new Date().getTime()])};PRUM_EPISODES.measure=function(b,a,b){PRUM_EPISODES.q.push(["measure",b,a,b||new Date().getTime()])};PRUM_EPISODES.done=function(a){PRUM_EPISODES.q.push(["done",a])};PRUM_EPISODES.mark("firstbyte");(function(){var b=document.getElementsByTagName("script")[0];var a=document.createElement("script");a.type="text/javascript";a.async=true;a.charset="UTF-8";a.src="//rum-static.pingdom.net/prum.min.js";b.parentNode.insertBefore(a,b)})();
        </script>
    </head>
    <body id="page-root" class="homepage blog post_list">
        <nav id="site-nav">
            <header id="about">
                <h1>
                    <a href="/about/">Chris Adams</a>
                </h1>
                <h2>
                    Programmer, cyclist, photographer
                </h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/about/" title="">About</a>
                </li>
                <li>
                    <a href="/feeds/all.rss" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="http://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="http://delicious.com/acdha" rel="me">del.icio.us</a>
                </li>
                <li>
                    <a href="http://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://plus.google.com/116562742092842686896?rel=author" rel="me">Google+</a>
                </li>
                <li>
                    <a href="http://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="http://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
                <li>
                    <a href="http://connect.garmin.com/explore?owner=acdha" rel="me">Garmin Connect</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <header id="site-title">
                <h1>
                    <a href="/" title="Chris Adams">Chris Adams</a>
                </h1>
            </header>
            <section class="content post-list">
                <article class="post">
                    <header>
                        <time class="date" datetime="2013-10-24T13:44:00+00:00">Oct 24</time>
                        <h2>
                            <a class="title" href="/2013/10/4/dear-eff/">Dear EFF: please don't pick the wrong fight</a>
                        </h2>
                    </header>
                    <p class="summary">
                        The fight against DRM is not worth discarding your integrity. Misrepresenting the W3C's Encrypted Media Extensions will not do anything useful but it will hold the web back and make the EFF less effective.
                    </p>
                    <div class="body">
                        <p>
                            First, some background: I've been a supporter and donor to the <a href="https://www.eff.org/">Electronic Frontier Foundation</a> for a long time – at least 2001, although I believe I started earlier during the <a href="http://wiki.openrightsgroup.org/wiki/Crypto_Wars">90s Crypto Wars</a> – and opposed to to <a href="http://en.wikipedia.org/wiki/Digital_rights_management">DRM</a> for at least as long. I've also been a fan of <a href="http://en.wikipedia.org/wiki/Danny_O%27Brien">Danny O'Brien</a>'s reporting and personal blog for a similarly long time.
                        </p>
                        <p>
                            Unfortunately, today had me reconsidering that support because of O'Brien's recent blog post: <a href="https://www.eff.org/deeplinks/2013/10/lowering-your-standards">Lowering Your Standards: DRM and the Future of the W3C</a> . I feel this marks a dangerous trend of playing very loose with the facts in an attempt to pressure the W3C to drop the <a href="https://dvcs.w3.org/hg/html-media/raw-file/tip/encrypted-media/encrypted-media.html">Encrypted Media Extensions (EME)</a> spec and that this is not only like to fail but actually backfire in ensuring that millions of people continue to access content through proprietary, closed systems.
                        </p>
                        <h3>
                            Background
                        </h3>
                        <p>
                            A little background information: most video played on the web and particularly commercial content uses <a href="http://en.wikipedia.org/wiki/Adobe_Flash" title="Adobe Flash - Wikipedia, the free encyclopedia">Adobe's Flash</a> or <a href="http://en.wikipedia.org/wiki/Microsoft_Silverlight" title="Microsoft Silverlight - Wikipedia, the free encyclopedia">Microsoft's Silverlight</a> plugins to run a video player inside a webpage. Both Flash and Silverlight are full programming environments with a significant range of capabilities beyond video playback and have significant overlap with the features provided by your browser. They're distributed as browser plugins, which require a hefty download to be installed before viewing anything, and both generally require proprietary tools for developers to create applications.
                        </p>
                        <p>
                            They're annoying for developers because they require using a completely different set of technologies than you use for everything else on the web but many places will write that off as a cost of doing business. What's more of a concern is that both plugins have a history of security problems and neither Microsoft nor Adobe appear to be particularly motivated to build the kind of fast, reliable, automatic update system which the modern browsers have so in addition to requiring your users to download something before viewing content, you're contributing to one of the leading sources of security exploits for the average user. It also means that anyone who wishes to publish video on the web is generally subject to the development roadmap for one of two companies.
                        </p>
                        <p>
                            HTML5 offers a way out of this mess: browsers could play back video directly, avoiding the massive external dependency and allowing them to make improvements for video as quickly as they do anything else rather than hoping a third-party developer wants to make improvements. <a href="http://en.wikipedia.org/wiki/HTML5_video">HTML5 &lt;video&gt;</a> is very easy to use, fast and has a consistent high-quality user experience. Unfortunately anyone looking to use it for commercial content will learn that the licensing rules from all of the major content owners require the use of DRM and thus HTML5 video is not an option.
                        </p>
                        <h4>
                            What is EME, anyway?
                        </h4>
                        <p>
                            The W3C's <a href="https://dvcs.w3.org/hg/html-media/raw-file/tip/encrypted-media/encrypted-media.html">EME</a> group is working on way to reduce this dependency by adding a general mechanism which allows the use of HTML5 video with a little bit of JavaScript to specify a <abbr title="Content Decryption Module">CDM</abbr> and a decryption key for the file. This allows content providers to use the entire modern web stack and limit the DRM dependency to a small chunk of code which handles only the actual decryption – dramatically lowering the <a href="http://en.wikipedia.org/wiki/Attack_surface" title="Attack surface - Wikipedia, the free encyclopedia">attack surface</a> and avoiding the need for anywhere near as frequent updates as the actual decryption mechanism is far less complex than the entire, largely-duplicative platform which Flash or Silverlight provide.
                        </p>
                        <h3>
                            The problem
                        </h3>
                        <p>
                            DRM does not work and all DRMed content has ended up being available in unencrypted form very quickly because the only way to make DRM work is by completely locking down a device to prevent its owner from running code which can access the unencrypted data and, of course, there's always the <a href="http://en.wikipedia.org/wiki/Analog_hole" title="Analog hole - Wikipedia, the free encyclopedia">Analog Hole</a>. The EFF has a <a href="https://www.eff.org/issues/drm">long, laudable history attempting to educate the public and lawmakers</a> about these issues and I completely support those efforts.
                        </p>
                        <p>
                            Unfortunately, this effort has failed. No significant amount of commercial video on the web is available without DRM and users don't seem to care as the billions of dollars of sales through iTunes, Amazon, Google Play, etc. and Netflix is using somewhere around <a href="http://arstechnica.com/tech-policy/2011/05/netflix-now-owns-almost-30-percent-of-north-american-fixed-internet-traffic/">30% of the total Internet traffic in North America</a> to serve DRM-encumbered video, mostly using Silverlight. Clearly convenience and availability are more important to people.
                        </p>
                        <p>
                            The EFF has been taking a hard-line position on EME, focused on slippery-slope claims:
                        </p>
                        <figure class="quote">
                            <blockquote>
                                <p>
                                    By approving this idea, the W3C has ceded control of the "user agent" (the term for a Web browser in W3C parlance) to a third-party, the content distributor. That breaks a—perhaps until now unspoken—assurance about who has the final say in your Web experience, and indeed who has ultimate control over your computing device.
                                </p>
                            </blockquote>…
                            <blockquote>
                                <p>
                                    <em>A Web where you cannot cut and paste text; where your browser can't "Save As..." an image</em>; where the "allowed" uses of saved files are monitored beyond the browser; where JavaScript is sealed away in opaque tombs; and maybe even where we can no longer effectively "View Source" on some sites, is a very different Web from the one we have today. It's a Web where user agents—browsers—must navigate a nest of enforced duties every time they visit a page. It's a place where the next Tim Berners-Lee or Mozilla, if they were building a new browser from scratch, couldn't just look up the details of all the "Web" technologies. They'd have to negotiate and sign compliance agreements with a raft of DRM providers just to be fully standards-compliant and interoperable.
                                </p>
                            </blockquote>
                            <figcaption>
                                <cite><a href="https://www.eff.org/deeplinks/2013/10/lowering-your-standards">Lowering Your Standards: DRM and the Future of the W3C</a>, Danny O'Brien, EFF</cite> <small>(emphasis mine)</small>
                            </figcaption>
                        </figure>
                        <p>
                            This is similar to some of the past claims made by <a href="http://craphound.com/bio.php" title="Cory Doctorow’s craphound.com">Cory Doctorow</a>:
                        </p>
                        <figure class="quote">
                            <blockquote cite="http://www.theguardian.com/technology/blog/2013/mar/12/tim-berners-lee-drm-cory-doctorow">
                                <p>
                                    The first of these conditions – "robustness" against end-user modification – is a blanket ban on all free/open source software (free/open source software, by definition, can be modified by its users). <em>That means that the two most popular browser technologies on the Web – WebKit (used in Chrome and Safari) and Gecko (used in Firefox and related browsers) – would be legally prohibited from implementing whatever "standard" the W3C emerges</em>.
                                </p>
                            </blockquote>
                            <figcaption>
                                <cite><a href="http://www.theguardian.com/technology/blog/2013/mar/12/tim-berners-lee-drm-cory-doctorow">What I wish Tim Berners-Lee understood about DRM</a></cite>, Cory Doctorow, The Guardian. <small>(emphasis mine)</small>
                            </figcaption>
                        </figure>
                        <p>
                            Both of these are simply wrong: there is no meaningful distinction between what EME proposes and what is already the case with a browser plugin. If Firefox can play Flash or Silverlight content, it can decrypted video using a CDM which is either included in the host operating system, bundled under an agreement similar to Chrome's Flash plugin or installed by the user.
                        </p>
                        <p>
                            The real problem is that they're arguing the wrong point: those requests have always been made and, in most cases, have already happened. The lack of a W3C standard hasn't prevented the Amazon Kindle app from preventing your ability to save unencrypted text, iTunes from blocking saving snippets of a rented movie, etc. and it hasn't prevented either Adobe or Microsoft from adding every DRM feature requested by the content owners. What this has done is ensured that the web community hasn't had much say in the process because all of the content is created and played using proprietary closed software.
                        </p>
                        <p>
                            <strong>The EFF is shouting loudly but only Adobe and Microsoft will benefit</strong>. There's no indication whatsoever that the studios are going to drop their DRM requirements if this W3C spec is scuttled – we'll just continue to see a lot of opaque plugin content and, of course, more pressure away from the web towards proprietary app stores. Mozilla's Asa Dotzler summed this up perfectly earlier today on <a href="https://news.ycombinator.com/item?id=6492027">Hacker News:</a> <q cite="https://news.ycombinator.com/item?id=6492027">[T]he businesses (Hollywood) with the content that Web users want have done that math and decided that DRM through plug-ins and native apps is an EXCELLENT system and they're happy to keep mandating it forever. If Plug-ins go away, as they're slowly but surely doing, then native apps will be the only place to get this content.</q>
                        </p>
                        <p>
                            This approach also runs the risk of damaging the reputation of the EFF and making it less effective: beyond basic factual problems, exaggerating the risks will backfire badly if people look and – correctly – see that the situation isn't so terrible (Netflix at $10/month is absurdly popular despite the DRM) and discount future claims made by the EFF. They'll need that credibility as the <a href="http://boingboing.net/2012/08/23/civilwar.html">war on general purpose computing</a> continues — and Cory is not wrong to sound the alarm over that.
                        </p>
                        <p>
                            What the open web community should be doing now is working to ensure that EME is designed in a way which improves security and reduces the proprietary footprint. If the standard for CDMs includes aggressive sandboxing it's a huge win for security alone even if all it does is turn Flash into a collective bad memory for web users. Additionally, separating the task of building a decryption module from building a high-performance video player with robust networking, makes it significantly easier for new vendors to enter the market and increases portability because so much less code needs to be adapted to a new platform.
                        </p>
                        <p>
                            There are some interesting long-term trends, as well: more education about the risks of DRMed content is good and reducing what consumers are willing to pay for restricted content may be the best long-term strategy. Some of that effort needs to be directed towards content owners and providers who are thinking about investing in complex, expensive systems which don't actually work. A very interesting approach was highlighted by Mozilla's <a href="https://brendaneich.com/">Brendan Eich</a> earlier this year in the form of OTOY's pure-JavaScript video codec which in addition to avoiding all of the issues with binary plugins has first-class support for <a href="http://en.wikipedia.org/wiki/Digital_watermarking" title="Digital watermarking - Wikipedia, the free encyclopedia">watermarking</a>.
                        </p>
                        <figure class="quote">
                            <blockquote cite="https://brendaneich.com/2013/05/today-i-saw-the-future/">
                                <p>
                                    Watermarking, not DRM. This could be huge. OTOY’s GPU cloud approach enables individually watermarking every intra-frame, and according to some of its Hollywood supporters including Ari Emanuel, this may be enough to eliminate the need for DRM.
                                </p>
                            </blockquote>
                            <figcaption>
                                <cite><a href="https://brendaneich.com/2013/05/today-i-saw-the-future/">Today I saw the future</a>, Brendan Eich (Mozilla CTO)</cite>
                            </figcaption>
                        </figure>
                        <p>
                            Obviously a shift away from the DRM obsession won't happen overnight but it's not impossible, either, as content owners are concerned about the market leverage which the major DRM vendors like Apple and Amazon have. There's space for smart players willing to back away from DRM in favor of an approach which works at least as well and doesn't require hardware vendors to sell out their users. As Brendan said, <a href="https://news.ycombinator.com/item?id=6496128"><q cite="https://news.ycombinator.com/item?id=6496128">there is hope</q></a>.
                        </p>
                        <div>
                            <h4>
                                2013-10-24 update
                            </h4>
                            <p>
                                Brendan Eich, Mozilla's CTO, posted his position on the EME issue: <a href="https://brendaneich.com/2013/10/the-bridge-of-khazad-drm/">The Bridge of Khazad-DRM</a>. Pushing the W3C for CDM-level interoperability is a good call and definitely feels characteristic of Mozilla by balancing the goal of protecting users’ interests with the realistic constraints of the current browser market. I strongly hope they succeed.
                            </p>
                            <p>
                                Since Mozilla seems to be the only browser vendor taking a strong position in favor of user rights, now is a great time to <a href="https://join.mozilla.org">support their work with a donation</a>.
                            </p>
                        </div>
                        <aside>
                            <h4>
                                Disclaimer
                            </h4>
                            <p>
                                While I work at the Library of Congress, I do not work for the Copyright Office and have no connection with official policy and my job does not involve copyright, intellectual property or DRM in any way. Just to reiterate the site-wide footer message: this is solely my personal opinion written on my own time.
                            </p>
                        </aside>
                    </div>
                </article>
                <article class="post">
                    <header>
                        <time class="date" datetime="2013-09-20T00:31:26.093447+00:00">Sep 20</time>
                        <h2>
                            <a class="title" href="/2013/9/19/nsa-risks-to-us-businesses/">The NSA’s recklessness poses a risk to US business</a>
                        </h2>
                    </header>
                    <p class="summary">
                        IT is one of the bright spots in the US economy – perhaps our government should be more cautious about helping the competition…
                    </p>
                    <div class="body">
                        <p>
                            This is a great example of how the NSA's rogue actions are going to be endangering US IT companies for years: RSA has a security advisory out for several products, including a widely-used cryptography library, which defaulted to using the Dual EC DRBG random number generator, which we now know was released by the NSA with a backdoor to make it easier to spy on people.
                        </p>
                        <blockquote cite="http://www.wired.com/threatlevel/2013/09/rsa-advisory-nsa-algorithm/">
                            <p>
                                Amidst all of the confusion and concern over an encryption algorithm that may contain an NSA backdoor, RSA Security released an advisory to developer customers today noting that the algorithm is the default algorithm in one of its toolkits and strongly advises them to stop using the algorithm.
                            </p><cite><a href="http://www.wired.com/threatlevel/2013/09/rsa-advisory-nsa-algorithm/">RSA Tells Its Developer Customers: Stop Using NSA-Linked Algorithm</a>, Kim Zetter, Wired</cite>
                        </blockquote>
                        <p>
                            This likely makes things weaker in a way which others could exploit – and given the high odds that people in e.g. China and Russia are racing to test that, it's likely that the NSA's actions exposed millions of people to unnecessary additional risk by weakening important software.
                        </p>
                        <p>
                            It's likely even more damaging, however, to the US IT industry's future. We can ship updates to software relatively quickly but the question of trust is going to be much thornier: almost every RSA customer – and especially foreign ones – must be asking whether RSA was innocently dupe or actively collaborating. Given how much business they do with the US government, they're probably never going to be able to convincingly disprove that theory. Every other major security vendor in the US and certain allied countries is going to face a similar question: “How do we know you won't be in the news next?”
                        </p>
                    </div>
                </article>
                <article class="post">
                    <header>
                        <time class="date" datetime="2013-08-31T22:15:00+00:00">Aug 31</time>
                        <h2>
                            <a class="title" href="/2013/8/31/extracting-images-from-scanned-pages/">Extracting images from scanned book pages</a>
                        </h2>
                    </header>
                    <p class="summary">
                        A first step toward building a visual index for books automatically
                    </p>
                    <div class="body">
                        <p>
                            I work on a project which has placed <a title="List of books available from the World Digital Library" href="http://www.wdl.org/en/search/?item_type=book">a number of books</a> online. Over the years we've improved server performance and worked on a <a href="https://github.com/LibraryOfCongress/wdl-viewer/">fast, responsive viewer for scanned books</a> to make our books as accessible as possible but it's still challenging to help visitors find something of interest out of hundreds of thousands of scanned pages.
                        </p>
                        <p>
                            <a href="http://www.trevorowens.org">Trevor</a> and I have discussed various ways to improve the situation and one idea which seemed promising was seeing how hard it would be to extract the images from digitized pages so we could present a visual index of an item. Trevor’s THATCamp CHNM post on <a href="http://chnm2013.thatcamp.org/06/03/freeing-images-from-inside-digitized-books-and-newspapers/">Freeing Images from Inside Digitized Books and Newspapers</a> got a favorable reception and since it kept coming up at work I decided to see how far I could get using <a href="http://www.opencv.org/">OpenCV</a>.
                        </p>
                        <p>
                            Everything you see below is open-source and <a href="mailto:chris@improbable.org">comments are highly welcome</a>. I created a <a href="https://github.com/acdha/image-mining/tree/book-illustration-detection">book-illustration-detection</a> branch in my <a href="https://github.com/acdha/image-mining/">image mining</a> project (see my previous <a href="http://chris.improbable.org/2013/06/30/reconstructing-thumbnails-using-opencv/">experiment reconstructing higher-resolution thumbnails from the masters</a>) so feel free to fork it or open issues.
                        </p>
                        <p>
                            The <a href="https://github.com/acdha/image-mining/blob/914b5c2c2d83508826933ca0b5b92ab28c6f97b8/bin/locate-figures.py">current process (locate-figures.py)</a> is rather primitive:
                        </p>
                        <ol>
                            <li>
                                <a href="https://github.com/acdha/image-mining/blob/914b5c2c2d83508826933ca0b5b92ab28c6f97b8/bin/locate-figures.py#L30">convert the image to grayscale</a>, which is both necessary for some of the algorithms
                            </li>
                            <li>
                                <a href="https://github.com/acdha/image-mining/blob/914b5c2c2d83508826933ca0b5b92ab28c6f97b8/bin/locate-figures.py#L34">apply a binary filter converting image to black and white</a>
                            </li>
                            <li>Optionally, apply an <a href="https://github.com/acdha/image-mining/blob/914b5c2c2d83508826933ca0b5b92ab28c6f97b8/bin/locate-figures.py#L61-L67">erode</a> or <a href="https://github.com/acdha/image-mining/blob/914b5c2c2d83508826933ca0b5b92ab28c6f97b8/bin/locate-figures.py#L70-L76">dilate</a> filter (see the <a href="http://docs.opencv.org/doc/tutorials/imgproc/erosion_dilatation/erosion_dilatation.html">OpenCV erosion and dilation tutorial</a>)
                            </li>
                            <li>Optionally, apply <a href="https://github.com/acdha/image-mining/blob/914b5c2c2d83508826933ca0b5b92ab28c6f97b8/bin/locate-figures.py#L80">Canny edge detection</a> (<a href="http://docs.opencv.org/doc/tutorials/imgproc/imgtrans/canny_detector/canny_detector.html">OpenCV tutorial</a>)
                            </li>
                            <li>
                                <a href="https://github.com/acdha/image-mining/blob/914b5c2c2d83508826933ca0b5b92ab28c6f97b8/bin/locate-figures.py#L83">find contours</a> (i.e. what appear to be lines) (<a href="http://docs.opencv.org/doc/tutorials/imgproc/shapedescriptors/find_contours/find_contours.html">OpenCV tutorial</a>)
                            </li>
                            <li>
                                <a href="https://github.com/acdha/image-mining/blob/914b5c2c2d83508826933ca0b5b92ab28c6f97b8/bin/locate-figures.py#L95-L122">Filter contours which are very small or very large</a>, to avoid extracting small things like defects, letters, etc. or large artifacts like borders from the scanning process which span an entire edge
                            </li>
                        </ol>
                        <p>
                            The program requires Python, <a href="http://www.opencv.org">OpenCV</a> and <a href="http://numpy.org/">numpy</a>, all of which should be easy to install on Ubuntu/Debian Linux or using <a href="http://brew.sh/">Homebrew</a> on OS X. When the prerequisites are installed, the program can be run like this:
                        </p>
                        <figure>
                            <img style="max-width: 60%" src="/2013/8/31/extracting-images-from-scanned-pages/applying-filters-2.jpg">
                            <figcaption>
                                Applying filters interactively, with contours and their bounding boxes displayed
                                <pre>
<code>locate-figures.py --interactive 211_1_82.png sn99021999_1913-08-31_1_1.png</code>
</pre>
                            </figcaption>
                        </figure>
                        <h3>
                            Results
                        </h3>
                        <p>
                            The results are quite promising:
                        </p>
                        <div style="text-align: center">
                            <figure>
                                <a href="http://chroniclingamerica.loc.gov/lccn/sn99021999/1913-08-31/ed-1/seq-1/"><img style="border: solid blue 1px" width="291" height="309" src="/experiments/opencv/page-image-extraction/sn99021999_1913-08-31_1_1%20extract%205489.jpg"></a>
                                <figcaption>
                                    Extracted cartoon from the <a href="http://chroniclingamerica.loc.gov/lccn/sn99021999/1913-08-31/ed-1/seq-1/">Omaha Daily Bee front page for August 31st, 1913</a> <a href="http://chroniclingamerica.loc.gov/lccn/sn99021999/1913-08-31/ed-1/seq-1.jp2">JPEG-2000 Master</a> (courtesy of <a href="http://chroniclingamerica.loc.gov/">Chronicling America</a>)
                                </figcaption>
                            </figure>
                            <figure>
                                <a href="http://www.wdl.org/en/item/211/view/1/77/"><img style="border: solid blue 1px" src="/experiments/opencv/page-image-extraction/211/211_1_77%20extract%201622.jpg"></a>
                                <figcaption>
                                    Extracted illustration from <a href="http://www.wdl.org/en/item/211/">The Amazon and Madeira Rivers: Sketches and Descriptions from the Note-Book of an Explorer</a>
                                </figcaption>
                            </figure>
                            <figure>
                                <a href="http://www.wdl.org/en/item/211/view/1/246/"><img style="border: solid blue 1px" src="/experiments/opencv/page-image-extraction/211/211_1_246%20extract%201654.jpg"></a>
                                <figcaption>
                                    Extracted illustration from <a href="http://www.wdl.org/en/item/211/">The Amazon and Madeira Rivers: Sketches and Descriptions from the Note-Book of an Explorer</a>
                                </figcaption>
                            </figure>
                            <figure>
                                <a href="http://www.wdl.org/en/item/101/view/1/26/"><img style="border: solid blue 1px" src="/experiments/opencv/page-image-extraction/101/101_1_26%20extract%201267.jpg"></a>
                                <figcaption>
                                    Extracted print from <a href="http://www.wdl.org/en/item/101/">Guide to the Great Siberian Railway</a>
                                </figcaption>
                            </figure>
                        </div>
                        <p>
                            There are, of course, some problems:
                        </p>
                        <figure style="text-align: center">
                            <a href="http://www.wdl.org/en/item/211/view/1/253/"><img style="border: solid blue 1px" src="/experiments/opencv/page-image-extraction/211/211_1_253%20extract%20805.jpg"></a> <a href="http://www.wdl.org/en/item/211/view/1/253/"><img style="border: solid blue 1px" src="/experiments/opencv/page-image-extraction/211/211_1_253%20extract%2010415.jpg"></a>
                            <figcaption>
                                Multiple contours were detected in multiple points of this illustration but unfortunately they weren't seen as contiguous and both were large enough to be extracted
                                <aside>
                                    (Source: <a href="http://www.wdl.org/en/item/211/">The Amazon and Madeira Rivers: Sketches and Descriptions from the Note-Book of an Explorer</a>)
                                </aside>
                            </figcaption>
                        </figure>
                        <p>
                            The full results are worth reviewing – I was surprised at the quality from the initial pass:
                        </p>
                        <ul>
                            <li>
                                <a href="/experiments/opencv/page-image-extraction/211/">The Amazon and Madeira Rivers: Sketches and Descriptions from the Note-Book of an Explorer</a>
                            </li>
                            <li>
                                <a href="/experiments/opencv/page-image-extraction/101/">Guide to the Great Siberian Railway</a>
                            </li>
                        </ul>
                        <p>
                            There are some obvious areas for improvement such as attempting to prevent the above problem by filtering boxes which are entirely contained within other boxes. It would also be interesting to attempt to examine the surrounding area to see whether there appears to be a caption.
                        </p>
                        <p>
                            Cool ideas? Deep experience with image processing? <a href="mailto:chris@improbable.org">I'd love to hear what you think</a>.
                        </p>
                    </div>
                </article>
                <article class="post">
                    <header>
                        <time class="date" datetime="2013-08-29T08:42:00+00:00">Aug 29</time>
                        <h2>
                            <a class="title" href="/2013/8/29/how-simple-web-kiosks-have-become/">How simple web kiosks have become thanks to Webconverger</a>
                        </h2>
                    </header>
                    <p class="summary">
                        Creating a fullscreen web app kiosk has never been easier thanks to Webconverger
                    </p>
                    <div class="body">
                        <p>
                            Recently I decided it was time to get around to creating a dashboard for the <a href="http://www.wdl.org/">World Digital Library</a>. We'd talked about it for years but there was always the hassle of maintaining another system acting as a deterrent for a side project. Since browsers have become more capable, however, I decided yesterday to see how far I could get with a pure static HTML page and a static boot-to-browser system.
                        </p>
                        <p>
                            I quickly found <a href="http://webconverger.org/">Webconverger</a>, which is a Debian derivative intended for kiosks, schools &amp; libraries, etc. A quick look at the <a href="http://webconverger.org/API/">API documentation</a> showed that all of the configuration I needed was possible simply by editing the boot-loader config. I tossed together a quick HTML page which loaded various things from Twitter, <a href="https://graphite.readthedocs.org">Graphite</a>, Atom feeds, etc. and tossed it into an S3 bucket.
                        </p>
                        <h2>
                            Building the bootable USB key
                        </h2>
                        <ol>
                            <li>I downloaded the <a href="http://dl.webconverger.com/latest.iso">ISO image</a> and used dd to transfer it to a spare USB key (thanks conference vendors!) and booted to confirm that my hardware was supported and that the page looked great after typing the URL into the browser.
                            </li>
                            <li>
                                <p>
                                    As per the documentation, everything worked automatically once I added a few boot parameters at startup: <code>noblank chrome=webcfullscreen homepage=http://example.org</code>
                                </p>
                                <p>
                                    Unfortunately, on OS X there's no easy way to mount an ISO image read-write so it's not as simple as editing the file in your favorite editor…
                                </p>
                            </li>
                            <li>
                                <p>
                                    Now for the applied laziness: there's a paid configuration service and full developer instructions, and for that matter there are generic ISO editing tools, but I really just wanted to edit a text file which lives in <code>/boot/live.cfg</code> and it felt somewhat excessive to setup a full toolchain to change a few bytes of ASCII text
                                </p>
                                <p>
                                    Solution: make a copy of the ISO file, open up <a href="http://ridiculousfish.com/hexfiend/">Hex Fiend</a> and search for a string which would only appear in the target file, as determined by looking in <code>/boot/live.cfg</code> after mounting the ISO read-only:<br>
                                    <code>append initrd=/live/initrd2.img boot=live skipconfig quiet splash</code>
                                </p>
                                <aside>
                                    (Did I really just describe hex-editing a binary file as the easy option? Well, yes — it's a standard system search dialog, a click to move the cursor, pasting, a click to change panes and holding down the 0 key for a few seconds. If you've ever tried to get Word to format a large document consistently, this is a piece of cake…)
                                </aside>
                            </li>
                            <li>It's not quite simple as simply inserting text because I don't want to corrupt the ISO image by changing the size but fortunately there's a ton of boilerplate which I don't need for a simple dashboard. Like most C programs, the bootloader is almost certain to stop reading once it finds null bytes and indeed a quick glance shows a block of 00 bytes starting after the final character in the file.
                            </li>
                            <li>
                                <p>
                                    A quick pass through an editor and I have the following trimmed down config with the customizations on the end of the append line:
                                </p>
                                <pre style="white-space: pre; word-wrap: normal; overflow-x: scroll">
DEFAULT live-686-pae

label live-686-pae
        menu label 686-pae: Live
        kernel /live/vmlinuz2
        append initrd=/live/initrd2.img boot=live skipconfig quiet splash bootfrom=removable <strong>noblank chrome=webcfullscreen homepage=http://example.org</strong>
</pre>
                                <p>
                                    Past it in at the start of live.cfg, switch to the hex pane and pad out the file with NULLs until the original text is completely replaced.
                                </p>
                            </li>
                            <li>Use dd to write the modified ISO to your USB key and reboot
                            </li>
                        </ol>
                        <figure>
                            <img src="/2013/8/29/how-simple-web-kiosks-have-become/dashboard.jpg" width="1360" height="768">
                            <figcaption>
                                Screenshot of the final dashboard
                            </figcaption>
                        </figure>
                    </div>
                </article>
            </section>
        </section>
        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer><script defer async="" src="/static/js/common.js">
</script> <script id="google-analytics">
    var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-2097834-1']);
            _gaq.push(['_setDomainName', 'improbable.org']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </body>
</html>
