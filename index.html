<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Chris Adams' Blog</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all">
        <meta name="author" content="Chris Adams">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-2097834-1', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body id="page-root" class="homepage blog post_list">
        <nav id="site-nav">
            <header id="about">
                <h1><a href="/about/">Chris Adams</a></h1>
                <h2>Programmer, cyclist, photographer</h2>
            </header>

            <ul class="links">
                <li>
                    <a href="/about/" title="">About</a>
                </li>
                <li>
                    <a href="/feeds/all.rss" title="Site Feed">Site Feed</a>
                </li>
            </ul>

            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="https://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="https://pinboard.in/u:acdha/" rel="me">Pinboard</a>
                </li>
                <li>
                    <a href="https://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>

        <section id="main">
            <header id="site-title">
                <h1>
                    <a href="/" title="Chris Adams">Chris Adams</a>
                </h1>
            </header>
            <section class="post-list content"><article class="post">
                    <header>
                        <time class="date" datetime="2014-08-25T16:05:28+00:00">Aug 25</time>
                        <h2>
                            <a class="title" href="/2014/8/25/adventures-in-unicode-digits/">So you think you know what a number is…</a>
                        </h2>
                    </header>

                    <div class="body"><p>
                        I was recently surprised by a 404 which I noticed in <a href="https://www.google.com/webmasters/tools">Google's Webmaster Tools</a>,
                        which pointed to a truncated URL (<code>http://www.wdl.org/en/item/</code>) which is
                        never actually linked to. This happens frequently but in this case the failure was
                        interesting because the source link was an unlinked URL on a Persian blog and the
                        source link actually worked:

                        <a href="http://www.wdl.org/en/item/%DB%B2%DB%B6%DB%B7%DB%B9/" title="Map of Persia and Adjacent Countries, for Sir John Malcolm's History of Persia - World Digital Library">http://www.wdl.org/en/item/۲۶۷۹/</a>.<br>

                        The canonical URL for that page is

                        <a href="http://www.wdl.org/en/item/2679/" title="Map of Persia and Adjacent Countries, for Sir John Malcolm's History of Persia - World Digital Library">http://www.wdl.org/en/item/2679/</a>
                        and the author had presumably pasted the URL into a page where their software had
                        helpfully converted the latin digits (e.g. <code>0123456789</code>) into what are
                        known as

                        <a href="http://en.wikipedia.org/wiki/Eastern_Arabic_numerals" title="Eastern Arabic numerals - Wikipedia, the free encyclopedia">Eastern Arabic, Hindi or Indic-Arabic numerals</a>:
                        <code>٠١٢٣٤٥٦٧٨٩</code> (a closer look shows that this is the Persian variant as the
                        6 is actually <abbr title="EXTENDED ARABIC-INDIC DIGIT SIX">۶</abbr> instead of
                        <abbr title="ARABIC-INDIC DIGIT SIX">٦</abbr>).
                    </p>



                    <p>
                        Presumably Googlebot scans HTML for text which look like URLs but uses a limited
                        parser which breaks as soon as it finds a character which isn't in a limited set of
                        characters, presumably only ISO-8859-1, causing it to break the URL while other services
                        (e.g. Facebook, Google+, Github, etc.) extract the full URL.
                    </p>



                    <p>
                        So … mystery solved, we're done, right?
                    </p>



                    <p>
                        Wait, why does that URL work in the first place? We never added that as a supported
                        feature and, being security-aware, all of our URLs are carefully validated to ensure
                        that the IDs are valid numeric values – both as part of
                        <a href="https://docs.djangoproject.com/en/dev/topics/http/urls/">Django's URL dispatching</a>
                        and when the item is retrieved from the database. Besides, since the item IDs aren't
                        assigned using Eastern-Arabic digits how does it actually match the record?
                    </p>



                    <p>
                        Python's documentation for <code>int()</code> doesn't mention anything about this but
                        <a href="https://docs.python.org/2/library/stdtypes.html#unicode.isdecimal"><code>isdecimal()</code></a>
                        gives us a clue:
                    </p>



                    <blockquote>
                        Decimal characters include digit characters, and all characters that can be used to form decimal-radix numbers, e.g. U+0660, ARABIC-INDIC DIGIT ZERO.
                    </blockquote>



                    <p>
                        What's happening here is that Python uses the <a href="http://www.unicode.org/">Unicode</a> definition of “digit”, which is actually a fairly long list.
                        The specification uses the
                        <a href="http://www.unicode.org/versions/Unicode6.0.0/ch04.pdf">“Nd = Number, decimal digit” classification</a>
                        and a quick look at the
                        <a href="http://www.unicode.org/Public/UNIDATA/ScriptExtensions.txt">Unidata script extensions list</a>
                        shows quite a few different characters flagged with Nd. Python should treat all of those
                        as valid digits for the purposes of calling <code>int()</code>, <code>isdecimal()</code>,
                        and even the regular expressions used to validate our URLs. ۲۶۷۹ will match <code>\d+</code>
                        and will have been converted to the number <code>2679</code> by the time the database
                        sees it.
                    </p>



                    <p>
                        If you want to see this in action, I created a quick <a href="https://gist.github.com/acdha/e9d22a7c37961d043f58">test script which allows you to test numeric characters</a> from <a href="http://www.fileformat.info/info/unicode/category/Nd/list.htm" title="Unicode Characters in the 'Number, Decimal Digit' Category">the full list</a>.
                        Try it interactively in your browser: <a target="_blank" href="http://repl.it/X3G">http://repl.it/X3G</a>.
                    </p>



                    <p>
                        Left as an exercise for the reader is building a tool which will translate URLs to a specific script, such as this Burmese variant for the Ramayana:
                        <a href="http://www.wdl.org/en/item/%E1%81%81%E1%81%84%E1%81%82%E1%81%88%E1%81%85/" title="Ramayana - World Digital Library">http://www.wdl.org/en/item/၁၄၂၈၅/</a>
                    </p></div>
                </article>
            <article class="post">
                    <header>
                        <time class="date" datetime="2014-03-19T00:22:46.608059+00:00">Mar 19</time>
                        <h2>
                            <a class="title" href="/2014/3/17/content-search-on-a-budget/">Content search on a budget</a>
                        </h2>
                    </header>
                    <p class="summary">Automatic bulk OCR and full-text search for digital collections using Tesseract and Solr</p><div class="body"><p>
                        Digitizing printed material has become an industrial process for large collections. Modern scanning equipment makes it easy to process millions of pages and concerted engineering effort has even produced options at the high-end for <a href="http://www.flickr.com/photos/acdha/7404633950/in/set-72157628000441127/">fragile rare items</a> while innovative open-source projects like <a href="http://projectgado.org/our-technology/">Project Gado</a> make continual progress reducing the cost of reliable, batch scanning to fit almost any organization's budget.
                    </p>

                    <p>
                        Such efficiencies are great for our goals of preserving history and making it available but they start making painfully obvious the degree to which digitization capacity outstrips our ability to create metadata. This is a big problem because most of the ways we find information involves searching for text and a large TIFF file is effectively invisible to a full-text search engine. The classic library solution to this challenge has been cataloging but the required labor is well beyond most budgets and runs into philosophical challenges when users want to search on something which wasn't considered noteworthy at the time an item was cataloged.
                    </p>

                    <p>
                        In the spirit of finding <a href="http://www.artima.com/intv/simplest.html">the simplest thing that could possibly work</a> I've been experimenting with a completely automated approach to perform <a href="http://en.wikipedia.org/wiki/OCR" title="Optical Character Recognition">OCR</a> on new items and offering combined full-text search over both the available metadata and OCR text, as can be seen in this example:
                    </p>

                    <figure>
                        <img src="/2014/3/17/content-search-on-a-budget/Screenshot%202014-03-17%2018.26.21.png">
                        <figcaption>
                            <a href="http://www.wdl.org/en/search/?q=whales&amp;qla=en">Searching for “whales” on the World Digital Library</a>
                        </figcaption>
                    </figure>

                    <h3 id="process-overview">
                        The Process
                    </h3>

                    <h4 id="generating-ocr">
                        Generating OCR text
                    </h4>

                    <p>
                        As we receive new items, anything which matches our criteria (books, journals and newspapers created after 1800 — see below) is automatically placed into a <a href="http://www.celeryproject.org/">Celery task queue</a> as a low-priority task. Workers on multiple servers accept OCR tasks from the queue and process the master image using <a href="https://code.google.com/p/tesseract-ocr/">Tesseract</a> using a simple shell command to generate text and HTML with embedded <a href="http://en.wikipedia.org/wiki/HOCR">hOCR metadata</a>.
                    </p>

                    <p>
                        Once we have the OCR text, it's transformed to solve two different needs: a full-text search engine like <a href="https://lucene.apache.org/solr/">Apache Solr</a> or <a href="http://www.elasticsearch.org/">ElasticSearch</a> works with the pure text output but because we want to be able to highlight specific words the task also <a href="https://gist.github.com/acdha/9610005">converts the hOCR into a word coordinates JSON file</a> with the pixel coordinates for every word on the page.
                    </p>

                    <h4 id="search-indexing">
                        Indexing the text for search
                    </h4>

                    <p>
                        Most people expect a combined search these days where relevant terms are selected from both descriptive metadata and the text contents. Simply combining all of the text into a single document to be indexed is unsuitable, however, because we want to be able to offer the ability to only search metadata in certain cases and we want to be able to return specific pages rather than telling someone to visually scan through a 700 page book. Unfortunately, this approach is incompatible with the normal way search engines determine the most relevant results for a query:
                    </p>

                    <aside style="margin: .3em 1em; float: right; width: 20em;">
                        <h5 style="margin: 0">
                            Background: how search engines work
                        </h5>Most search engines use an <a href="http://en.wikipedia.org/wiki/Inverted_index" title="Inverted index - Wikipedia, the free encyclopedia">inverted index</a>, which is essentially a list of words and the documents which contain them. When you search for “whales”, the search engine simply looks for that entry in the index and retrieves the document list. The search engine next sorts the results by calculating a relevancy score for each document (see the <a href="http://lucene.apache.org/core/3_5_0/scoring.html" title="Apache Lucene - Scoring">Lucene scoring guide</a> for the exact details about how <a href="http://en.wikipedia.org/wiki/Tf%E2%80%93idf" title="tf–idf - Wikipedia, the free encyclopedia">TD-IDF</a> works) and returns the top scores first.
                    </aside>

                    <p>
                        Storing each page separately means that the search score will be determined independently rather than for the entire item. This would prevent books from scoring highly unless all of the words were mentioned on a single page and, far worse, many queries would return pages from a single book mixed throughout the results based on their individual scores! The solution this final problem is a technique which Solr calls <a href="https://wiki.apache.org/solr/FieldCollapsing">Field Collapsing</a> (the ElasticSearch team is <a href="https://github.com/elasticsearch/elasticsearch/issues/256">working on a similar feature</a>). With field collapsing enabled, Solr will first group all of the matching documents using a specified fieldand then compute the scores for each combined <em>group</em>. This means that we can group our results by the item ID and receive a list of groups (i.e. items) with one or more documents (i.e. pages or metadata) which we can use to build exact links into a large book.
                    </p>

                    <aside>
                        (I have released an experimental <a href="http://haystacksearch.org">django-haystack</a> <a href="https://gist.github.com/acdha/3750774">Solr grouped search backend</a> which adds support for Field Collapsing.)
                    </aside>

                    <h4 id="highlighting-results">
                        Highlighting Results
                    </h4>

                    <p>
                        Search results are returned as simple HTML with the embedded data which we'll need to provide the original image segments. Here's what happens when someone <a href="http://www.wdl.org/en/search/?q=guine%C3%A9&amp;qla=fr">searches for guineé</a>:
                    </p>

                    <ol>
                        <li>Solr performs its normal <a href="https://wiki.apache.org/solr/LanguageAnalysis">language analysis</a> and selects relevant documents
                        </li>
                        <li>All of the documents are grouped by item ID and each group is ranked for relevance
                        </li>
                        <li>Solr <a href="http://wiki.apache.org/solr/HighlightingParameters">highlights</a> the matched terms in the response
                        </li>
                        <li>The web site formats all of the results into an HTML document and adds some metadata indicating the type of document which contained each match so it can be enhanced by JavaScript later
                        </li>
                    </ol>

                    <figure>
                        <img src="/2014/3/17/content-search-on-a-budget/Screenshot%202014-03-17%2019.20.06.png">
                        <figcaption>
                            The raw search results before JavaScript runs
                        </figcaption>
                    </figure>

                    <p>
                        At this point we have quickly returned search results and can link directly to individual pages but we're showing frequently ugly OCR text directly and not providing as much context as we'd like. The next step is to replace that raw text with an image slice from the scanned page:
                    </p>

                    <ol>
                        <li>JavaScript looks for highlighted results from OCR text and uses the embedded microdata to determine the source volume and page
                        </li>
                        <li>An <a href="http://en.wikipedia.org/wiki/XMLHttpRequest" title="XMLHttpRequest - Wikipedia, the free encyclopedia">XHR request</a> is made to retrieve the word coordinates for every word on each returned page
                        </li>
                        <li>The word coordinate list is scanned for each highlighted word and the coordinates are selected. Since we often find words in multiple places on the same page and we want to display an easily readable section of text, the list of word coordinates is coalesced starting from the top of the page and no more than the first third of the page will be returned. For this display, we always use the full width of the page but the same process could be used to generate smaller slices if desired.
                        </li>
                        <li>A separate request is made to load the relevant image slice. When the image has loaded, we replace the raw OCR text with the image. This way the raw text is visible for as long as it takes to load the image so we avoid showing empty areas until everything has transferred.
                        </li>
                        <li>Finally, a partially-transparent overlay is displayed over the image for each word coordinate to highlight the matches (see e.g. <a href="http://css-tricks.com/text-blocks-over-image/">css-tricks.com</a> if you're not familiar with this form of CSS positioning). Since the OCRed word coordinates aren't consistently tightly cropped around the letters in the word a minor <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/box-shadow">CSS box-shadow</a> is used to make the edges softer and more like a highlighter.
                        </li>
                    </ol>

                    <h4 id="notes">
                        Notes
                    </h4>

                    <ul>
                        <li>From a workflow perspective, I highly recommend recording the source of your OCR text and whether it's been reviewed. Since this is a fully automated process it is extremely handy to be able to reprocess items in the future if your software improves without accidentally clobbering any items which have been hand-corrected by humans.
                        </li>
                        <li>The word coordinates are pixel level coordinates based on the input file but our requests are made using calculated percentages since it's often the case that the scans are much higher resolution than we would want to display in a web-browser and our users wouldn't want to wait for a 600-dpi image to download in any case
                        </li>
                        <li>You might be wondering why all of this work is performed on the client side rather than having the server return highlighted images. In addition to reducing server load, this approach is friendlier for caches because a given image segment can be reused for multiple words (rounding the coordinates improves the cache hit ratio significantly) and both the image and word coordinates can thus be cached by <a href="http://en.wikipedia.org/wiki/Content_delivery_network" title="Content delivery network - Wikipedia, the free encyclopedia">CDN edge servers</a> rather than requiring a full round-trip back to the server.<br>
                            One common example of the cache-ability benefit is when you <a href="http://www.wdl.org/en/item/7309/view/1/491/#q=whales">open a result and start reading it</a>: in the viewer, we display full page images rather than the trimmed slices so we must fetch new images but those are likely to be cached because they haven't been customized with the search text and we can reuse the locally-cached word coordinates to immediately display the highlighting. If you change your search text within an item, we can again immediately update the display while the revised page list is retrieved.
                        </li>
                    </ul>

                    <h3 id="future-directions">
                        Challenges &amp; Future Directions
                    </h3>

                    <p>
                        This was supposed to be the simplest thing which could possibly work and it turned out not to be that simple. As you might imagine, this leaves a number of open questions for where to go next:
                    </p>

                    <ul>
                        <li>OCR results vary considerably based on the quality of the input image. Accuracy can be improved considerably by preprocessing the image to remove borders, noise or use a more sophisticated algorithm to convert a full-color scan into the black-and-white image which Tesseract operates on. The trick is either coming up with good presets for your data, perhaps integrated with an image processing tool like <a href="http://scantailor.sourceforge.net/">ScanTailor</a>, or developing smarter code which can select filters based on the characteristics of the image.
                        </li>
                        <li>For older items, the OCR process is complicated by the condition of the materials, more primitive printing technology and stylistic choices like the <a href="http://en.wikipedia.org/wiki/Long_s">long s (ſ)</a> or ligatures which are no longer in common usage and thus not well supported by common OCR programs. One of my future goals is looking into the tools produced by the <a href="http://emop.tamu.edu/">Early Modern OCR Project</a> and seeing whether there's a production-ready path for this.
                        </li>
                        <li>It would be interesting combine the results of OCR with my earlier <a href="http://chris.improbable.org/2013/8/31/extracting-images-from-scanned-pages/" title="Extracting images from scanned book pages">figure extraction project</a> for innovative displays like the <a href="http://mechanicalcurator.tumblr.com/">Mechanical Curator</a> or, with more work, trying to extract full figures with captions.
                        </li>
                        <li>Finally, there's considerable room for integrating crowd-sourcing approaches like the direct text correction as epitomized by the <a href="http://trove.nla.gov.au/newspaper">National Library of Australia's wonderful Trove project</a> and promising improvements on that concept like the UMD-MITH's <a href="http://mith.umd.edu/research/project/active-ocr/" title="Active OCR">ActiveOCR</a> project.<br>
                            <br>
                            This seems like an area for research which any organization with large digitized collections should be supporting, particularly with an eye towards easier reuse. <a href="http://inkdroid.org">Ed Summers</a> and I have idly discussed the idea for a generic web application which would display hOCR with the corresponding images for correction with all of the data stored somewhere like Github for full change tracking and review. It seems like something along those lines would be particularly valuable as a public service to avoid the expensive of everyone reinventing large parts of this process customized for their particular workflow.
                        </li>
                    </ul></div>
                </article>
            <article class="post">
                    <header>
                        <time class="date" datetime="2013-10-24T13:44:00+00:00">Oct 24</time>
                        <h2>
                            <a class="title" href="/2013/10/4/dear-eff/">Dear EFF: please don't pick the wrong fight</a>
                        </h2>
                    </header>
                    <p class="summary">The fight against DRM is not worth discarding your integrity. Misrepresenting the W3C's Encrypted Media Extensions will not do anything useful but it will hold the web back and make the EFF less effective.</p><div class="body"><p>
                        First, some background: I've been a supporter and donor to the <a href="https://www.eff.org/">Electronic Frontier Foundation</a> for a long time – at least 2001, although I believe I started earlier during the <a href="http://wiki.openrightsgroup.org/wiki/Crypto_Wars">90s Crypto Wars</a> – and opposed to to <a href="http://en.wikipedia.org/wiki/Digital_rights_management">DRM</a> for at least as long. I've also been a fan of <a href="http://en.wikipedia.org/wiki/Danny_O%27Brien">Danny O'Brien</a>'s reporting and personal blog for a similarly long time.
                    </p>

                    <p>
                        Unfortunately, today had me reconsidering that support because of O'Brien's recent blog post: <a href="https://www.eff.org/deeplinks/2013/10/lowering-your-standards">Lowering Your Standards: DRM and the Future of the W3C</a> . I feel this marks a dangerous trend of playing very loose with the facts in an attempt to pressure the W3C to drop the <a href="https://dvcs.w3.org/hg/html-media/raw-file/tip/encrypted-media/encrypted-media.html">Encrypted Media Extensions (EME)</a> spec and that this is not only like to fail but actually backfire in ensuring that millions of people continue to access content through proprietary, closed systems.
                    </p>

                    <h3>
                        Background
                    </h3>

                    <p>
                        A little background information: most video played on the web and particularly commercial content uses <a href="http://en.wikipedia.org/wiki/Adobe_Flash" title="Adobe Flash - Wikipedia, the free encyclopedia">Adobe's Flash</a> or <a href="http://en.wikipedia.org/wiki/Microsoft_Silverlight" title="Microsoft Silverlight - Wikipedia, the free encyclopedia">Microsoft's Silverlight</a> plugins to run a video player inside a webpage. Both Flash and Silverlight are full programming environments with a significant range of capabilities beyond video playback and have significant overlap with the features provided by your browser. They're distributed as browser plugins, which require a hefty download to be installed before viewing anything, and both generally require proprietary tools for developers to create applications.
                    </p>

                    <p>
                        They're annoying for developers because they require using a completely different set of technologies than you use for everything else on the web but many places will write that off as a cost of doing business. What's more of a concern is that both plugins have a history of security problems and neither Microsoft nor Adobe appear to be particularly motivated to build the kind of fast, reliable, automatic update system which the modern browsers have so in addition to requiring your users to download something before viewing content, you're contributing to one of the leading sources of security exploits for the average user. It also means that anyone who wishes to publish video on the web is generally subject to the development roadmap for one of two companies.
                    </p>

                    <p>
                        HTML5 offers a way out of this mess: browsers could play back video directly, avoiding the massive external dependency and allowing them to make improvements for video as quickly as they do anything else rather than hoping a third-party developer wants to make improvements. <a href="http://en.wikipedia.org/wiki/HTML5_video">HTML5 &lt;video&gt;</a> is very easy to use, fast and has a consistent high-quality user experience. Unfortunately anyone looking to use it for commercial content will learn that the licensing rules from all of the major content owners require the use of DRM and thus HTML5 video is not an option.
                    </p>

                    <h4>
                        What is EME, anyway?
                    </h4>

                    <p>
                        The W3C's <a href="https://dvcs.w3.org/hg/html-media/raw-file/tip/encrypted-media/encrypted-media.html">EME</a> group is working on way to reduce this dependency by adding a general mechanism which allows the use of HTML5 video with a little bit of JavaScript to specify a <abbr title="Content Decryption Module">CDM</abbr> and a decryption key for the file. This allows content providers to use the entire modern web stack and limit the DRM dependency to a small chunk of code which handles only the actual decryption – dramatically lowering the <a href="http://en.wikipedia.org/wiki/Attack_surface" title="Attack surface - Wikipedia, the free encyclopedia">attack surface</a> and avoiding the need for anywhere near as frequent updates as the actual decryption mechanism is far less complex than the entire, largely-duplicative platform which Flash or Silverlight provide.
                    </p>

                    <h3>
                        The problem
                    </h3>

                    <p>
                        DRM does not work and all DRMed content has ended up being available in unencrypted form very quickly because the only way to make DRM work is by completely locking down a device to prevent its owner from running code which can access the unencrypted data and, of course, there's always the <a href="http://en.wikipedia.org/wiki/Analog_hole" title="Analog hole - Wikipedia, the free encyclopedia">Analog Hole</a>. The EFF has a <a href="https://www.eff.org/issues/drm">long, laudable history attempting to educate the public and lawmakers</a> about these issues and I completely support those efforts.
                    </p>

                    <p>
                        Unfortunately, this effort has failed. No significant amount of commercial video on the web is available without DRM and users don't seem to care as the billions of dollars of sales through iTunes, Amazon, Google Play, etc. and Netflix is using somewhere around <a href="http://arstechnica.com/tech-policy/2011/05/netflix-now-owns-almost-30-percent-of-north-american-fixed-internet-traffic/">30% of the total Internet traffic in North America</a> to serve DRM-encumbered video, mostly using Silverlight. Clearly convenience and availability are more important to people.
                    </p>

                    <p>
                        The EFF has been taking a hard-line position on EME, focused on slippery-slope claims:
                    </p>

                    <figure class="quote">
                        <blockquote>
                            <p>
                                By approving this idea, the W3C has ceded control of the "user agent" (the term for a Web browser in W3C parlance) to a third-party, the content distributor. That breaks a—perhaps until now unspoken—assurance about who has the final say in your Web experience, and indeed who has ultimate control over your computing device.
                            </p>
                        </blockquote>…
                        <blockquote>
                            <p>
                                <em>A Web where you cannot cut and paste text; where your browser can't "Save As..." an image</em>; where the "allowed" uses of saved files are monitored beyond the browser; where JavaScript is sealed away in opaque tombs; and maybe even where we can no longer effectively "View Source" on some sites, is a very different Web from the one we have today. It's a Web where user agents—browsers—must navigate a nest of enforced duties every time they visit a page. It's a place where the next Tim Berners-Lee or Mozilla, if they were building a new browser from scratch, couldn't just look up the details of all the "Web" technologies. They'd have to negotiate and sign compliance agreements with a raft of DRM providers just to be fully standards-compliant and interoperable.
                            </p>
                        </blockquote>
                        <figcaption>
                            <cite><a href="https://www.eff.org/deeplinks/2013/10/lowering-your-standards">Lowering Your Standards: DRM and the Future of the W3C</a>, Danny O'Brien, EFF</cite> <small>(emphasis mine)</small>
                        </figcaption>
                    </figure>

                    <p>
                        This is similar to some of the past claims made by <a href="http://craphound.com/bio.php" title="Cory Doctorow’s craphound.com">Cory Doctorow</a>:
                    </p>

                    <figure class="quote">
                        <blockquote cite="http://www.theguardian.com/technology/blog/2013/mar/12/tim-berners-lee-drm-cory-doctorow">
                            <p>
                                The first of these conditions – "robustness" against end-user modification – is a blanket ban on all free/open source software (free/open source software, by definition, can be modified by its users). <em>That means that the two most popular browser technologies on the Web – WebKit (used in Chrome and Safari) and Gecko (used in Firefox and related browsers) – would be legally prohibited from implementing whatever "standard" the W3C emerges</em>.
                            </p>
                        </blockquote>
                        <figcaption>
                            <cite><a href="http://www.theguardian.com/technology/blog/2013/mar/12/tim-berners-lee-drm-cory-doctorow">What I wish Tim Berners-Lee understood about DRM</a></cite>, Cory Doctorow, The Guardian. <small>(emphasis mine)</small>
                        </figcaption>
                    </figure>

                    <p>
                        Both of these are simply wrong: there is no meaningful distinction between what EME proposes and what is already the case with a browser plugin. If Firefox can play Flash or Silverlight content, it can decrypted video using a CDM which is either included in the host operating system, bundled under an agreement similar to Chrome's Flash plugin or installed by the user.
                    </p>

                    <p>
                        The real problem is that they're arguing the wrong point: those requests have always been made and, in most cases, have already happened. The lack of a W3C standard hasn't prevented the Amazon Kindle app from preventing your ability to save unencrypted text, iTunes from blocking saving snippets of a rented movie, etc. and it hasn't prevented either Adobe or Microsoft from adding every DRM feature requested by the content owners. What this has done is ensured that the web community hasn't had much say in the process because all of the content is created and played using proprietary closed software.
                    </p>

                    <p>
                        <strong>The EFF is shouting loudly but only Adobe and Microsoft will benefit</strong>. There's no indication whatsoever that the studios are going to drop their DRM requirements if this W3C spec is scuttled – we'll just continue to see a lot of opaque plugin content and, of course, more pressure away from the web towards proprietary app stores. Mozilla's Asa Dotzler summed this up perfectly earlier today on <a href="https://news.ycombinator.com/item?id=6492027">Hacker News:</a> <q cite="https://news.ycombinator.com/item?id=6492027">[T]he businesses (Hollywood) with the content that Web users want have done that math and decided that DRM through plug-ins and native apps is an EXCELLENT system and they're happy to keep mandating it forever. If Plug-ins go away, as they're slowly but surely doing, then native apps will be the only place to get this content.</q>
                    </p>

                    <p>
                        This approach also runs the risk of damaging the reputation of the EFF and making it less effective: beyond basic factual problems, exaggerating the risks will backfire badly if people look and – correctly – see that the situation isn't so terrible (Netflix at $10/month is absurdly popular despite the DRM) and discount future claims made by the EFF. They'll need that credibility as the <a href="http://boingboing.net/2012/08/23/civilwar.html">war on general purpose computing</a> continues — and Cory is not wrong to sound the alarm over that.
                    </p>

                    <p>
                        What the open web community should be doing now is working to ensure that EME is designed in a way which improves security and reduces the proprietary footprint. If the standard for CDMs includes aggressive sandboxing it's a huge win for security alone even if all it does is turn Flash into a collective bad memory for web users. Additionally, separating the task of building a decryption module from building a high-performance video player with robust networking, makes it significantly easier for new vendors to enter the market and increases portability because so much less code needs to be adapted to a new platform.
                    </p>

                    <p>
                        There are some interesting long-term trends, as well: more education about the risks of DRMed content is good and reducing what consumers are willing to pay for restricted content may be the best long-term strategy. Some of that effort needs to be directed towards content owners and providers who are thinking about investing in complex, expensive systems which don't actually work. A very interesting approach was highlighted by Mozilla's <a href="https://brendaneich.com/">Brendan Eich</a> earlier this year in the form of OTOY's pure-JavaScript video codec which in addition to avoiding all of the issues with binary plugins has first-class support for <a href="http://en.wikipedia.org/wiki/Digital_watermarking" title="Digital watermarking - Wikipedia, the free encyclopedia">watermarking</a>.
                    </p>

                    <figure class="quote">
                        <blockquote cite="https://brendaneich.com/2013/05/today-i-saw-the-future/">
                            <p>
                                Watermarking, not DRM. This could be huge. OTOY’s GPU cloud approach enables individually watermarking every intra-frame, and according to some of its Hollywood supporters including Ari Emanuel, this may be enough to eliminate the need for DRM.
                            </p>
                        </blockquote>
                        <figcaption>
                            <cite><a href="https://brendaneich.com/2013/05/today-i-saw-the-future/">Today I saw the future</a>, Brendan Eich (Mozilla CTO)</cite>
                        </figcaption>
                    </figure>

                    <p>
                        Obviously a shift away from the DRM obsession won't happen overnight but it's not impossible, either, as content owners are concerned about the market leverage which the major DRM vendors like Apple and Amazon have. There's space for smart players willing to back away from DRM in favor of an approach which works at least as well and doesn't require hardware vendors to sell out their users. As Brendan said, <a href="https://news.ycombinator.com/item?id=6496128"><q cite="https://news.ycombinator.com/item?id=6496128">there is hope</q></a>.
                    </p>

                    <div>
                        <h4>
                            2013-10-24 update
                        </h4>
                        <p>
                            Brendan Eich, Mozilla's CTO, posted his position on the EME issue: <a href="https://brendaneich.com/2013/10/the-bridge-of-khazad-drm/">The Bridge of Khazad-DRM</a>. Pushing the W3C for CDM-level interoperability is a good call and definitely feels characteristic of Mozilla by balancing the goal of protecting users’ interests with the realistic constraints of the current browser market. I strongly hope they succeed.
                        </p>
                        <p>
                            Since Mozilla seems to be the only browser vendor taking a strong position in favor of user rights, now is a great time to <a href="https://join.mozilla.org">support their work with a donation</a>.
                        </p>
                    </div>

                    <aside>
                        <h4>
                            Disclaimer
                        </h4>
                        <p>
                            While I work at the Library of Congress, I do not work for the Copyright Office and have no connection with official policy and my job does not involve copyright, intellectual property or DRM in any way. Just to reiterate the site-wide footer message: this is solely my personal opinion written on my own time.
                        </p>
                    </aside></div>
                </article>
            <article class="post">
                    <header>
                        <time class="date" datetime="2013-09-20T00:31:26.093447+00:00">Sep 20</time>
                        <h2>
                            <a class="title" href="/2013/9/19/nsa-risks-to-us-businesses/">The NSA’s recklessness poses a risk to US business</a>
                        </h2>
                    </header>
                    <p class="summary">IT is one of the bright spots in the US economy – perhaps our government should be more cautious about helping the competition…</p><div class="body"><p>
                        This is a great example of how the NSA's rogue actions are going to be endangering US IT companies for years: RSA has a security advisory out for several products, including a widely-used cryptography library, which defaulted to using the Dual EC DRBG random number generator, which we now know was released by the NSA with a backdoor to make it easier to spy on people.
                    </p>

                    <blockquote cite="http://www.wired.com/threatlevel/2013/09/rsa-advisory-nsa-algorithm/">
                        <p>
                            Amidst all of the confusion and concern over an encryption algorithm that may contain an NSA backdoor, RSA Security released an advisory to developer customers today noting that the algorithm is the default algorithm in one of its toolkits and strongly advises them to stop using the algorithm.
                        </p><cite><a href="http://www.wired.com/threatlevel/2013/09/rsa-advisory-nsa-algorithm/">RSA Tells Its Developer Customers: Stop Using NSA-Linked Algorithm</a>, Kim Zetter, Wired</cite>
                    </blockquote>

                    <p>
                        This likely makes things weaker in a way which others could exploit – and given the high odds that people in e.g. China and Russia are racing to test that, it's likely that the NSA's actions exposed millions of people to unnecessary additional risk by weakening important software.
                    </p>

                    <p>
                        It's likely even more damaging, however, to the US IT industry's future. We can ship updates to software relatively quickly but the question of trust is going to be much thornier: almost every RSA customer – and especially foreign ones – must be asking whether RSA was innocently dupe or actively collaborating. Given how much business they do with the US government, they're probably never going to be able to convincingly disprove that theory. Every other major security vendor in the US and certain allied countries is going to face a similar question: “How do we know you won't be in the news next?”
                    </p></div>
                </article>
            </section>
        </section>

        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a>
                This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer>
        <script async src="/static/js/common.js"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js" integrity="sha256-hj+5FRlAuvAFANiefn0PpJYCkV1X4QT9EgiPd+6QnCw=" crossorigin="anonymous"></script>
    </body>
</html>
