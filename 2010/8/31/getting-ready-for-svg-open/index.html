<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Getting Ready for SVG Open</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all">
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->

        <meta http-equiv="last-modified" content="Tue, 31 Aug 2010 15:34:00 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-2097834-1', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1><a href="/about/">Chris Adams</a></h1>
                <h2>Programmer, cyclist, photographer</h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="https://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="https://pinboard.in/u:acdha/" rel="me">Pinboard</a>
                </li>
                <li>
                    <a href="https://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2010-08-31T11:34:00-04:00">
                    <meta itemprop="dateModified" content="2010-08-31T11:34:00-04:00">
                    <time class="date" itemprop="datePublished" datetime="2010-08-31T15:34:00+00:00">Aug 31</time>
                    <h2 class="" itemprop="title">Getting Ready for SVG Open</h2>
                </header>

                <div class="body" itemprop="articleBody"><div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/fe0d96f28517d86b">
                        <blockquote>
                            <div>
                                <p>
                                    I recently <a href="http://channel9.msdn.com/posts/LarryLarsen/Internet-Explorer-9-Platform-Preview-4-A-Look-at-SVG-in-IE9/">demonstrated Test Driving Modern SVG</a> using the SVG Dice sample currently on the <a href="http://ie.microsoft.com/testdrive/Default.html">Internet Explorer 9 Test Drive site</a>. While building this sample, I learned that both performance and interoperability for SVG are a subtle continuum and are <i>not</i> binary. This point resonated with me so much that I modified my presentation for this week’s <a href="http://www.svgopen.org">SVG Open Conference</a> entitled “<a href="http://www.svgopen.org/2010/registration.php?section=abstracts_and_proceedings#paper_70">The Future of SVG and HTML5</a>” to include methods by which the SVG developer community can rally around to make SVG more interoperable.
                                </p>
                                <h4>
                                    Testing SVG vs. Test Driving SVG
                                </h4>
                                <p>
                                    SVG has its roots in a document format. The most popular use case today is the static document format. Complex engineering diagrams and other illustrations are well suited for SVG given their requirements for scalability, high fidelity printing, and portability.
                                </p>
                                <p>
                                    With HTML5, the future of SVG is about the next generation of the interactive graphic web which exercises SVG in new ways. As a community, we need to think about how we test the SVG specification differently.
                                </p>
                            </div>
                            <h5>
                                Testing SVG
                            </h5>
                            <p>
                                The W3C SVG Test Suites attempt to “test” the ability to implement the spec, but as we learned in the working group, this is not enough to guarantee an interoperable set where a developer can use the same markup that works across all browsers. The SVG Test Suite is not intended to test conformance, but rather whether or not the spec can be implemented. From the <a href="http://www.w3.org/Graphics/SVG/WG/wiki/Test_Suite_Overview">W3C SVG Test Wiki:</a>
                            </p>
                            <blockquote>
                                <p>
                                    “Our test suites are necessary, but not sufficient, to test conformance… Thus, representations of tested support is skewed toward the more complex features of SVG, and is not an accurate view of overall SVG support”
                                </p>
                            </blockquote>
                            <p>
                                In other words, the existing test suite doesn’t test whether a browser conforms to the spec. To this end, we are working closely with the SVG Working Group to help round out these tests; in fact, there is an external effort to create an <a href="http://svgtorture.googlecode.com/svn/trunk/automated/test.html">SVG DOM 1.1 conformance test</a> by the SVG Interest Group. At the time of writing, IE9 passes 100% of these automated tests. In concert with the SVG Working Group, we are helping to resolve these interoperability issues by continuing to enhance the SVG Test Suite through regular contributions.
                            </p>
                            <p>
                                Additionally, there exists an imbalance between the number of requirements in the modules in the SVG Specification, and the number of tests in the SVG Test Suite that represent those requirements. The Internet Explorer team helps to address this imbalance through test asset contributions. But this is not enough. We have contributed <a href="http://samples.msdn.microsoft.com/ietestcenter/#svg11e2">56 tests</a> and expect to continue to deliver more over time.
                            </p>
                            <h5>
                                Test Driving SVG
                            </h5>
                            <p>
                                The better measure of conformance and more importantly interoperability was do develop more complex SVG for the web. My own experience in test driving SVG by developing the <a href="http://ie.microsoft.com/testdrive/Performance/SVGDice/Default.xhtml">SVG Dice</a> demo illustrates some of the places where we have more work to do as a community on interoperability of SVG.
                            </p>
                            <div style="width:500px;height:290px">
                                <img src="http://ecn.channel9.msdn.com/o9/ch9/4185/564185/IE9201003_512_ch9.png" style="margin-top:0;padding-top:0"><video preload="metadata" style="width:500px;height:283px" controls="" src="http://ecn.channel9.msdn.com/o9/ch9/4185/564185/IE9201003_ch9.mp4"><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration:none"><img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style:none"></a></video>
                            </div>
                            <p>
                                The SVG specification contains over 2000 individual requirements. This is a large number in comparison to other web specifications and means that there is plenty of room for different interpretations. We strive in the SVG W3C Working Group to identify these differences. When I developed the SVG demo with the requirement that it works across browsers, my eyes were opened to some of the difficulties web developers face.
                            </p>
                            <p>
                                Most of the interoperability issues stem from a combination of the large number of requirements, the dependencies on other specifications, and the lack of significant content on the web to ensure the features are interpreted the same by both developer and browser vendors alike. SVG is relatively new ground for web developers and whereas HTML and CSS have enjoyed decades of refinement by a large scale of users, SVG has not yet had the same level of use and scrutiny.
                            </p>
                            <p>
                                Now that SVG is a part of HTML5, we expect to see traditional web developers learning new and better ways to improve experiences for their users using vector graphics. At the last <a href="http://blogs.msdn.com/b/ie/archive/2010/06/08/getting-to-svg-2-0-a-report-from-the-svg-working-group-face-to-face-may-24th-june-1st-2010.aspx">SVG Face to Face meeting</a>, the SVG Working Group <a href="http://www.w3.org/Graphics/SVG/WG/wiki/User_talk:Pdengler">assembled scenarios for SVG</a> that provide for more targeted use cases for the next generation, graphical web. SVG plays an integral role here.
                            </p>
                            <h4>
                                Comparing Implementations
                            </h4>
                            <p>
                                I wrote the SVG Dice demo from my own understanding of the specification using Internet Explorer 9 and subsequently tested it in other browsers. In most cases where I ran into conflicting behavior, at least two browsers still agreed. Sometimes Internet Explorer’s behavior matched Chrome or Safari, and other times it matched Firefox or Opera. Because Internet Explorer is the most recent implementation, it benefits from an SVG Specification that is in <a href="http://www.w3.org/TR/SVG11/">last call</a> where at least some of the ambiguities and conflicts have been resolved in the specification. Clearly there are more.
                            </p>
                            <p>
                                Something that caught me off guard was the impact of performance on my development effort.
                            </p><video style="width:500px" preload="metadata" src="http://ecn.channel9.msdn.com/o9/ch9/4187/564187/IE9201005_ch9.mp4" controls=""><a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration:none"><img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style:none"></a></video>
                            <p>
                                From a developer’s perspective, I wanted to use the same graphic features like opacity, gradients, and masks in all browsers, in order to provide a consistent interoperable user experience, but I couldn’t do that because of performance concerns. Fully hardware accelerated graphics on Windows helps to move these graphic intensive computations to the GPU. I added the “Low Fidelity” mode to enable users to experience this demo in browsers that don’t make full use of the GPU. One nice side effect is that this also demonstrates CSS styling of SVG.
                            </p>
                            <h5>
                                The Surprising “Switching Event”
                            </h5>
                            <p>
                                Debugging the differences between browsers caused a very interesting “switching event” for me as a developer. There were a few outstanding bugs in the IE9 debugging tools (now fixed) which prevented me from placing breakpoints in code when working with SVG, so I used the popular Firebug add-on for Firefox. However, running the demo on Firefox was too slow, so I reverted back to Internet Explorer 9 to debug.
                            </p>
                            <p>
                                I eventually found work-arounds for most of the incompatibilities without having to write browser specific code, but it required far more effort than expected or considered reasonable.  We have more work to do here as a community in building the promise of same markup for SVG.
                            </p>
                            <h4>
                                The Code
                            </h4>
                            <p>
                                Because SVG is an older spec but new to a lot of developers, I thought I would review some of the code and concepts in this demo up close.
                            </p>
                            <h5>
                                The Document Structure
                            </h5>
                            <p>
                                As a first example, most browsers do not yet support SVG in HTML5.  I had to structure the document as XHTML with inline SVG.
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#0000ff">&lt;!</span><span style="color:#800000">DOCTYPE</span> <span style="color:#ff0000">html</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">html</span> <span style="color:#ff0000">id</span><span style="color:#0000ff">="demohtml"</span> <span style="color:#ff0000">xmlns</span><span style="color:#0000ff">="http://www.w3.org/1999/xhtml"</span> <span style="color:#ff0000">class</span><span style="color:#0000ff">="testdrive"</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">head</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">title</span><span style="color:#0000ff">&gt;</span><br>      SVG Dice<br><span style="color:#0000ff">&lt;/</span><span style="color:#800000">title</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;/</span><span style="color:#800000">head</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">body</span> <span style="color:#ff0000">id</span><span style="color:#0000ff">="demobody"</span> <span style="color:#ff0000">onload</span><span style="color:#0000ff">="Setup()"</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">audio</span> <span style="color:#ff0000">id</span><span style="color:#0000ff">="sndRemove"</span> <span style="color:#ff0000">volume</span><span style="color:#0000ff">="1"</span> <span style="color:#ff0000">src</span><span style="color:#0000ff">="assets/remove.mp3"</span> <span style="color:#ff0000">preload</span><span style="color:#0000ff">="true"</span>  <span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">audio</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">svg</span>  <span style="color:#ff0000">overflow</span><span style="color:#0000ff">="visible"</span> <span style="color:#ff0000">id</span><span style="color:#0000ff">="theSVG"</span> <span style="color:#ff0000">xmlns</span>=<span style="color:#ff0000">http:</span>//<span style="color:#ff0000">www</span>.<span style="color:#ff0000">w3</span>.<span style="color:#ff0000">org</span>/<span style="color:#ff0000">2000</span>/<span style="color:#ff0000">svg</span><br><span style="color:#ff0000">xmlns:xlink</span><span style="color:#0000ff">="http://www.w3.org/1999/xlink"</span> <span style="color:#ff0000">width</span><span style="color:#0000ff">="100%"</span> <span style="color:#ff0000">height</span><span style="color:#0000ff">="100%"</span> <span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;/</span><span style="color:#800000">svg</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;/</span><span style="color:#800000">body</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;/</span><span style="color:#800000">html</span><span style="color:#0000ff">&gt;</span><br><br>
</pre><br>
                            </div>
                            <p>
                                The above simple <code>&lt;!DOCTYPE html&gt;</code> sets Internet Explorer 9 to run in “standards mode” where SVG is supported. Notice that the SVG is embedded directly into the HTML. Both the css and the script are linked in via the HTML elements as expected.
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#0000ff">&lt;</span><span style="color:#800000">script</span> <span style="color:#ff0000">type</span><span style="color:#0000ff">="text/javascript"</span> <span style="color:#ff0000">src</span><span style="color:#0000ff">="demo.js"</span><span style="color:#0000ff">&gt;&lt;/</span><span style="color:#800000">script</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">link</span> <span style="color:#ff0000">rel</span><span style="color:#0000ff">="Stylesheet"</span> <span style="color:#ff0000">type</span><span style="color:#0000ff">="text/css"</span> <span style="color:#ff0000">href</span><span style="color:#0000ff">="demo.css"</span> <span style="color:#0000ff">/&gt;</span><br>
</pre><br>
                            </div>
                            <p>
                                At this point I have my basic html and svg document, stylesheet, script file structures. Next I need to build the graphical elements, provide the styles and write the script necessary for the animations and user experience.
                            </p>
                            <h5>
                                Adding the Content
                            </h5>
                            <p>
                                One of the great benefits and unique nature of the web development community is what we called the “copy/paste” use case. Any developer can readily <a href="http://commons.wikimedia.org/w/index.php?title=Special%3ASearch&amp;search=public+domain+SVG">search Wikimedia</a> for public domain SVG art and use these directly in their applications or on their sites. Other popular tools exist for generating new or modifying existing content, from the open source <a href="http://www.inkscape.org/">Inkscape</a> which focuses specifically on SVG, to other graphic tools from Microsoft and Adobe which export to SVG. I used existing open source clip art for the dice and for the boat.
                            </p>
                            <p>
                                Initially I had kept these SVG sources in different files for the purpose of separation. Unfortunately, I ran into several different issues across browsers from sizing to SVG Images support, which forced me to include all of the SVG in the one HTML file.
                            </p>
                            <p>
                                SVG contains the concept of &lt;defs&gt;, which is used to define an element(s) with styles and attributes, that can be re &lt;use&gt;d later. These two concepts are very powerful. They allow me to create many different sized dice for use as the image on the cup, those that fall into the cup, or those that roll across the screen during game play. I organized the &lt;defs&gt; from the various files at the top document immediately after the SVG tag.
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#0000ff">&lt;</span><span style="color:#800000">defs</span><span style="color:#0000ff">&gt;</span><br><span style="color:#008000">&lt;!-- for left die --&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">linearGradient</span> <span style="color:#ff0000">id</span><span style="color:#0000ff">="<span style="background-color:yellow">grad21</span>"</span> <span style="color:#ff0000">x1</span><span style="color:#0000ff">=".445"</span> <span style="color:#ff0000">x2</span><span style="color:#0000ff">=".554"</span> <span style="color:#ff0000">y1</span><span style="color:#0000ff">=".442"</span> <span style="color:#ff0000">y2</span><span style="color:#0000ff">=".555"</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">stop</span> <span style="color:#ff0000">stop-opacity</span><span style="color:#0000ff">=".9"</span> <span style="color:#ff0000">offset</span><span style="color:#0000ff">="0"</span> <span style="color:#ff0000">stop-color</span><span style="color:#0000ff">="#470808"</span><span style="color:#0000ff">/&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">stop</span> <span style="color:#ff0000">stop-opacity</span><span style="color:#0000ff">=".9"</span> <span style="color:#ff0000">offset</span><span style="color:#0000ff">=".65"</span> <span style="color:#ff0000">stop-color</span><span style="color:#0000ff">="#700d0d"</span><span style="color:#0000ff">/&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">stop</span> <span style="color:#ff0000">stop-opacity</span><span style="color:#0000ff">=".9"</span> <span style="color:#ff0000">offset</span><span style="color:#0000ff">="1"</span> <span style="color:#ff0000">stop-color</span><span style="color:#0000ff">="#8c1111"</span><span style="color:#0000ff">/&gt;</span><br><span style="color:#0000ff">&lt;/</span><span style="color:#800000">linearGradient</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;/</span><span style="color:#800000">defs</span><span style="color:#0000ff">&gt;</span><br>
</pre><br>
                            </div>
                            <p>
                                These &lt;defs&gt; are later referenced:
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#008000">&lt;!-- edges --&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">path</span> <span style="color:#ff0000">d</span><span style="color:#0000ff">="M 2474 4434 L 4860 2945 C 5009 "</span> <span style="color:#ff0000">fill</span><span style="color:#0000ff">="url(<span style="background-color:yellow">#grad21</span>)"</span><span style="color:#0000ff">/&gt;</span><br>
</pre><br>
                            </div>
                            <p>
                                Once the &lt;defs&gt; were in place and the main clipart content was inline, I designed the rest of the experience, keeping in mind that SVG renders in layers from top to bottom. The majority of the remaining content was the scoreboard, the felt, the text and the cup.
                            </p>
                            <h5>
                                Adding the User Interactivity and Animations
                            </h5>
                            <p>
                                One of the more challenging aspects of this demo was organizing the sizing. One of the first things I do in the code is register the resize event, and set up the dimensions of the &lt;svg&gt; and the contained svg fragments. For simplicity, I &lt;g&gt;rouped them so I can apply scaling and positioning individually.
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
document.getElementById(<span style="color:#006080">"theSVG"</span>).setAttribute(<span style="color:#006080">"width"</span>, surfaceWidth.toString() + <span style="color:#006080">"px"</span>);
</pre><br>
                            </div>
                            <p>
                                Something to take notice of immediately here is that this JavaScript code is familiar to web developers because it is standard JavaScript working with the DOM. SVG has its own DOM methods which I use, but I mostly stick to DOM Level 2 constructs as there is general agreement in the SVG Working Group that the SVG DOM might need revisiting.
                            </p>
                            <p>
                                Next I needed to take both of the static dice as SVG Fragments, and create some code to clone them, store references in an array with properties that allow me to manipulate their transforms for the animation effects, as well as ensure the physics engine recognizes them accordingly. The loop to create the dice is straightforward; it loops through the number of dice desired, clones the original into the DOM and creates an array to manage them.
                            </p>
                            <p>
                                Note: Most code samples here are trimmed for brevity, but all of the code is on the Platform Preview site <a href="http://ie.microsoft.com/testdrive/Performance/SVGDice/Default.xhtml">http://ie.microsoft.com/testdrive/Performance/SVGDice/Default.xhtml</a>)
                            </p>
                            <p>
                                First I clone the prototype and add it to the DOM, setting some default attributes along the way. Note the establishment of the transform is used to move the dice (translate), rotate the dice (rotate) and size the dice (scale).
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#008000">// create an instance of die #1 and add it to the SVG Doc</span><br><span style="color:#0000ff">this</span>.die1 = createElement(<span style="color:#006080">"g"</span>);<br><span style="color:#0000ff">var</span> tmpChild = <span style="color:#0000ff">this</span>.die1.appendChild(createElement(<span style="color:#006080">"g"</span>));<br><span style="color:#0000ff">var</span> tmpNode = <span style="color:#0000ff">this</span>.die1.appendChild(tmpChild);<br>tmpNode.appendChild(nodeDie1.cloneNode(<span style="color:#0000ff">true</span>));<br><span style="color:#008000">// set some default attributes</span><br><span style="color:#0000ff">this</span>.die1.setAttribute(<span style="color:#006080">"id"</span>, <span style="color:#006080">"die_1_"</span> + number.toString());<br><span style="color:#0000ff">this</span>.die1.setAttribute(<span style="color:#006080">"transform"</span>, <br><span style="color:#006080">"translate("</span> + <span style="color:#0000ff">this</span>.x.toString() + <span style="color:#006080">","</span> + <span style="color:#0000ff">this</span>.y.toString() + <span style="color:#006080">") <br>    scale ("</span> + <span style="color:#0000ff">this</span>.scale.toString() + <span style="color:#006080">")"</span>);<br><br>
</pre><br>
                            </div>
                            <p>
                                I wanted to make use of the &lt;use&gt; element here as this is a great way to clone a group of SVG fragments. Unfortunately, the implementation of &lt;use&gt; varies across browsers, specifically in the case of styling and events.
                            </p>
                            <p>
                                Next I use the SVGDOM getBBox() method to grab the dimensions of the die as we shrink each one along the way. This method returns an SVGRect which is used in the physics engine to detect collision.
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#0000ff">var</span> rectSize = <span style="color:#0000ff">this</span>.die1.getBBox(); <span style="color:#008000">// calculate dimensions for use with physics</span><br><span style="color:#0000ff">this</span>.height = rectSize.height;<br><span style="color:#0000ff">this</span>.width = rectSize.width;<br>
</pre><br>
                            </div>
                            <p>
                                One of my favorite parts of building this sample was the discovery and use of the <a href="http://box2d-js.sourceforge.net/">Box2DJS</a> engine which made physics a breeze! This engine is used in many projects and is now available to web developers. Before I create the dice, I actually initialize the world around me:
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#0000ff">function</span> createWorld(width, height) {<br><span style="color:#0000ff">var</span> worldAABB = <span style="color:#0000ff">new</span> b2AABB();<br><br><span style="color:#0000ff">var</span> world = <span style="color:#0000ff">new</span> b2World(worldAABB, gravity, doSleep);<br>    createGround(world, width, height);<br><span style="color:#008000">// Side</span><br>    createBox(world, 0, 0, 30, height);<br>    createBox(world, width, 0, 30, height);<br>    createBox(world, 0, 0, width + 30, 30);<br>    createBox(world, 0,height , width+30,30);<br><br><span style="color:#0000ff">return</span> world;<br>}<br>
</pre><br>
                            </div>
                            <p>
                                And then during dice creation I add each die to the world and give it an initial velocity.
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#008000">// add this dice to the physics engine</span><br><span style="color:#0000ff">this</span>.circleBody = createBall(world, <span style="color:#0000ff">this</span>.xTrans, <span style="color:#0000ff">this</span>.yTrans, <span style="color:#0000ff">this</span>.width);    <br><span style="color:#008000">// give the force a slightly random starting velocity</span><br><span style="color:#0000ff">this</span>.circleBody.SetLinearVelocity(initialForce);<br>
</pre><br>
                            </div>
                            <p>
                                After adding some user interaction to add dice, I remove dice and shake the cup. Then, I create a timer and step the world.
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
timer = window.setInterval(DoStuff, 16);<br><span style="color:#008000">// move the world</span><br>world.Step(timeStep, iteration);<br>
</pre><br>
                            </div>
                            <p>
                                The Die class has a prototype update function that is called when the world steps. The primary mechanism for moving the dice is to get the coordinates from the physics engine and set the transform property with all of the elements originally established:
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#0000ff">var</span> transFormString = <span style="color:#006080">"translate("</span> + Math.round(<span style="color:#0000ff">this</span>.circleBody.m_position.x)<br>     + <span style="color:#006080">","</span> + Math.round(<span style="color:#0000ff">this</span>.circleBody.m_position.y) + <span style="color:#006080">") scale ("</span> +<br><span style="color:#0000ff">this</span>.scale.toString() + <span style="color:#006080">") rotate("</span> + Math.round(<span style="color:#0000ff">this</span>.rotation).toString()<br>     + <span style="color:#006080">","</span> + Math.round(<span style="color:#0000ff">this</span>.xTrans).toString() + <span style="color:#006080">","</span> +<br>     Math.round(<span style="color:#0000ff">this</span>.yTrans).toString() + <span style="color:#006080">")"</span>;<br>
</pre><br>
                            </div>
                            <p>
                                We now have moving, rolling, colliding dice.
                            </p>
                            <p>
                                Note that using the transform attribute is not necessarily the fastest approach, depending upon the implementation. As mentioned previously, I shied away from the SVGDOM which provides methods such as setTranslate() and setRotate(). The method I chose here considers potential future use of <a href="http://www.w3.org/TR/css3-2d-transforms/">CSS Transforms</a> with <a href="http://www.w3.org/TR/css3-transitions/">CSS Transitions</a> and/or <a href="http://www.w3.org/TR/css3-animations/">CSS Animations</a>.
                            </p>
                            <h5>
                                Styling the Graphics
                            </h5>
                            <p>
                                Lastly, I wanted to take advantage of SVG integrated into the DOM and use CSS to change the style of the scene. Since the original art came from a design tool, it contained RGB values for colors and opacities.
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#0000ff">&lt;</span><span style="color:#800000">linearGradient</span> <span style="color:#ff0000">id</span><span style="color:#0000ff">="cgrad2c"</span> <span style="color:#ff0000">x1</span><span style="color:#0000ff">="1"</span> <span style="color:#ff0000">x2</span><span style="color:#0000ff">=".17"</span> <span style="color:#ff0000">y1</span><span style="color:#0000ff">="0"</span> <span style="color:#ff0000">y2</span><span style="color:#0000ff">=".58"</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">stop</span> <span style="background-color:yellow"><span style="color:#ff0000">stop-opacity</span><span style="color:#0000ff">=".9"</span> <span style="color:#ff0000">offset</span><span style="color:#0000ff">="0"</span>  <span style="color:#ff0000">stop-color</span><span style="color:#0000ff">="#700d0d"</span></span><span style="color:#0000ff">/&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">stop</span> <span style="background-color:yellow"><span style="color:#ff0000">stop-opacity</span><span style="color:#0000ff">=".9"</span> <span style="color:#ff0000">offset</span><span style="color:#0000ff">="1"</span> <span style="color:#ff0000">stop-color</span><span style="color:#0000ff">="#b51616"</span></span><span style="color:#0000ff">/&gt;</span><br><span style="color:#0000ff">&lt;/</span><span style="color:#800000">linearGradient</span><span style="color:#0000ff">&gt;</span><br>
</pre><br>
                            </div>
                            <p>
                                I replaced these RGB values with styles:
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#0000ff">&lt;</span><span style="color:#800000">linearGradient</span> <span style="color:#ff0000">id</span><span style="color:#0000ff">="cgrad2c"</span> <span style="color:#ff0000">x1</span><span style="color:#0000ff">="1"</span> <span style="color:#ff0000">x2</span><span style="color:#0000ff">=".17"</span> <span style="color:#ff0000">y1</span><span style="color:#0000ff">="0"</span> <span style="color:#ff0000">y2</span><span style="color:#0000ff">=".58"</span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">stop</span> <span style="background-color:yellow"><span style="color:#ff0000">class</span><span style="color:#0000ff">="diceCorner6"</span></span><span style="color:#0000ff">/&gt;</span><br><span style="color:#0000ff">&lt;</span><span style="color:#800000">stop</span> <span style="background-color:yellow"><span style="color:#ff0000">class</span><span style="color:#0000ff">="diceCorner7"</span></span><span style="color:#0000ff">&gt;</span><br><span style="color:#0000ff">&lt;/</span><span style="color:#800000">linearGradient</span><span style="color:#0000ff">&gt;</span><br>
</pre><br>
                            </div>
                            <p>
                                This allowed me to create style sheets for each of these styles:
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
g#classHandler<span style="color:#cc6633">.vegas</span> <span style="background-color:yellow;color:#cc6633">.diceCorner6</span> {stop-opacity:<span style="color:#006080">.9;</span>offset:0;stop-<span style="color:#0000ff">color</span>:<span style="color:#006080">#700d0d;</span>}<br>g#classHandler<span style="color:#cc6633">.vegas</span> <span style="background-color:yellow;color:#cc6633">.diceCorner6</span> {stop-opacity:<span style="color:#006080">.9;</span>offset:1;stop-<span style="color:#0000ff">color</span>:<span style="color:#006080">#b51616;</span>}<br><br>g#classHandler<span style="color:#cc6633">.lowfidielity</span> <span style="background-color:yellow;color:#cc6633">.diceCorner6</span> {offset:0;stop-<span style="color:#0000ff">color</span>:<span style="color:#006080">#000000;</span>}<br>g#classHandler<span style="color:#cc6633">.lowfidielity</span> <span style="background-color:yellow;color:#cc6633">.diceCorner6</span> {offset:1;stop-<span style="color:#0000ff">color</span>:<span style="color:#006080">#000000;</span>}<br>
</pre><br>
                            </div>
                            <p>
                                And then set the one class property at the top of the document to change all of the styles in the document:
                            </p>
                            <div style="border-bottom:silver 1px solid;text-align:left;border-left:silver 1px solid;padding-bottom:4px;line-height:12pt;background-color:#f4f4f4;margin:20px 0px 10px;padding-left:4px;width:97.5%;padding-right:4px;font-family:'Courier New', courier, monospace;direction:ltr;max-height:200px;font-size:8pt;overflow:auto;border-top:silver 1px solid;border-right:silver 1px solid;padding-top:4px">
                                <pre style="border-bottom-style:none;text-align:left;padding-bottom:0px;line-height:12pt;background-color:#f4f4f4;margin:0em;border-left-style:none;padding-left:0px;width:100%;padding-right:0px;font-family:'Courier New', courier, monospace;direction:ltr;border-top-style:none;color:black;border-right-style:none;font-size:8pt;overflow:visible;padding-top:0px">
<span style="color:#008000">// set the overall stylesheet via class</span><br>document.getElementById(<span style="color:#006080">"classHandler"</span>).setAttribute(<span style="color:#006080">"class"</span>, style);<br>
</pre><br>
                            </div>
                            <p>
                                This allows the user to change the style sheet even while the dice are rolling as there is no difference to the DOM as to when these styles are changed. Hardware accelerated graphics in Internet Explorer 9 enable this to happen very quickly.
                            </p>
                            <h3>
                                Call to Action
                            </h3>
                            <p>
                                Start working with SVG in Internet Explorer 9. IE9 is platform complete for SVG in the latest platform preview release. Experiment with the feature set and tell us about incompatibilities or bugs you find using the “Report Issue” command and on <a href="https://connect.microsoft.com/IE">Microsoft Connect</a>.
                            </p>
                            <p>
                                The IE team is testing sites, libraries and other SVG content on the web. Our goal is to help authors with their content and find any bugs in our feature set. One important best practice is using <a href="http://blogs.msdn.com/b/ie/archive/2010/06/10/same-markup-explaining-quot-jscript-version-quot-and-styling-new-html5-elements.aspx">feature detection, not browser detection</a> when testing for SVG support. Help us find the places where developers are detecting specific browsers instead of testing for functionality, and make any changes to open source libraries, or contact content authors such that we can help fix any issues that may arise.
                            </p>
                            <p>
                                We’re excited to see web developers start using this technology and the next generation, graphically rich, websites built with SVG.
                            </p>
                            <p>
                                Patrick Dengler<br>
                                Senior Program Manager<br>
                                Internet Explorer
                            </p>
                            <div style="clear:both"></div><img src="http://blogs.msdn.com/aggbug.aspx?PostID=10056018" width="1" height="1">
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://blogs.msdn.com/b/ie/archive/2010/08/31/getting-ready-for-svg-open.aspx">http://blogs.msdn.com/b/ie/archive/2010/08/31/getting-ready-for-svg-open.aspx</a>
                    </p>
                </div>
            </article>

            <nav id="post-nav">


            </nav>

            <script id="discus-javascript">
                var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script>

            <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>

        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a>
                This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer>

        <script async src="/static/js/common.js"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js" integrity="sha256-hj+5FRlAuvAFANiefn0PpJYCkV1X4QT9EgiPd+6QnCw=" crossorigin="anonymous"></script>
    </body>
</html>
