<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Technical details of the Street View WiFi payload controversy</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all">
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->

        <meta http-equiv="last-modified" content="Sat, 19 Jun 2010 22:04:54 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-2097834-1', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1><a href="/about/">Chris Adams</a></h1>
                <h2>Programmer, cyclist, photographer</h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="https://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="https://pinboard.in/u:acdha/" rel="me">Pinboard</a>
                </li>
                <li>
                    <a href="https://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2010-05-19T13:38:00-04:00">
                    <meta itemprop="dateModified" content="2010-05-19T13:38:00-04:00">
                    <time class="date" itemprop="datePublished" datetime="2010-05-19T17:38:00+00:00">May 19</time>
                    <h2 class="" itemprop="title">Technical details of the Street View WiFi payload controversy</h2>
                </header>

                <div class="body" itemprop="articleBody"><div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/faf5738c13a80ca4">
                        <blockquote>
                            <div style="clear:both;text-align:center">
                                <a href="http://i.telegraph.co.uk/telegraph/multimedia/archive/01212/googlestreetview_1212782c.jpg" style="clear:right;float:right;margin-bottom:1em;margin-left:1em"><img border="0" height="151" src="http://i.telegraph.co.uk/telegraph/multimedia/archive/01212/googlestreetview_1212782c.jpg" width="200"></a>
                            </div>The latest privacy controversy with Google is that while scanning for WiFi access-points in their <a href="http://maps.google.com/help/maps/streetview/index.html">Street View</a> <a href="http://i.telegraph.co.uk/telegraph/multimedia/archive/01212/googlestreetview_1212782c.jpg">cars</a>, they may have <a href="http://yro.slashdot.org/story/10/05/14/2259204/Google-Says-It-Mistakenly-Collected-Wi-Fi-Data-While-Mapping">inadvertently captured data payloads</a> containing private information (URLs, fragments of e-mails, and so on).<br>
                            <br>
                            Although some people are suspicious of their explanation, Google is almost certainly telling the truth when it claims it was an accident. The technology for WiFi scanning means it's easy to inadvertently capture too much information, and be unaware of it.<br>
                            <br>
                            This article discusses technically how such scanning works.<br>
                            <br>
                            <a name="more" id="more"></a><br>
                            <br>
                            BACKGROUND<br>
                            <br>
                            There have been many controversies surrounding Street View. The first is about the images the cars take. They often contain private information, such as the license plates of cars parked on the side of the road. Google keeps improving algorithms to fix this, such as automatically covering license plates within images.<br>
                            <br>
                            Street View cars also record nearby WiFi access-points. The purpose of this is to provide an alternate to GPS. A computer without GPS can scan for nearby access-points, look up their location in Google's database, and figure out it's own location. This is similar to the service provided by the company <a href="http://www.skyhookwireless.com/">Skyhook Wireless</a>, or by the collaborative effort <a href="http://www.wigle.net/">WIGLE</a>. Even though this is a useful tool, it is still a bit controversial, because it's yet one more piece of data (the location of everyone's access-points) that Google knows about us.<br>
                            <br>
                            The current controversy s that while scanning for access-points, it may have captured private data.<br>
                            <br>
                            PACKET SNIFFERS<br>
                            <br>
                            <div style="clear:both;text-align:center">
                                <a href="http://2.bp.blogspot.com/_TJ2XNCjin0s/S_QhDMsLbGI/AAAAAAAAAOI/bZMWk3gXoRU/s1600/blog-streetviewifi-netstumbler.PNG" style="clear:right;float:right;margin-bottom:1em;margin-left:1em"><img border="0" src="http://2.bp.blogspot.com/_TJ2XNCjin0s/S_QhDMsLbGI/AAAAAAAAAOI/bZMWk3gXoRU/s320/blog-streetviewifi-netstumbler.PNG"></a>
                            </div>Many people expect that Google would use a standard tool for mapping access-points, such as "<a href="http://en.wikipedia.org/wiki/Netstumbler">NetStumbler</a>". This is a popular program on Windows that makes it easy to both find access-points, as well as record their GPS location.<br>
                            <br>
                            <div style="clear:both;text-align:center">
                                <a href="http://4.bp.blogspot.com/_TJ2XNCjin0s/S_QiA-6K9iI/AAAAAAAAAOo/MGJSmT-qlqk/s1600/blog-streetviewifi-listwifis.PNG" style="clear:right;float:right;margin-bottom:1em;margin-left:1em"><img border="0" height="150" src="http://4.bp.blogspot.com/_TJ2XNCjin0s/S_QiA-6K9iI/AAAAAAAAAOo/MGJSmT-qlqk/s200/blog-streetviewifi-listwifis.PNG" width="200"></a>
                            </div>The problem with NetStumbler is that while it's easy to use, it isn't comprehensive. It doesn't capture the raw signals from access-points, but instead relies upon the underlying operating system (Windows) to do the work for it. A lot of information is lost in the process. In order to comprehensively map access-points, you need to capture the raw wifi signals and packets, such as through a "packet-sniffer".<br>
                            <br>
                            The WiFi radio in your laptop receives all packets on the current channel, including packets sent by other people's laptops near you. However, the WiFi device checks the incoming packets to see if they have the proper "MAC address" (the unique serial number assigned to your WiFi device). If they have the wrong MAC address, then the WiFi device will drop the packets. Only packets destined to your MAC address will be continue to be processed by your computer.<br>
                            <br>
                            The way a packet-sniffer works is to turn off the MAC address check. All packets received by the WiFi radio are kept in the system, then saved to disk.<br>
                            <br>
                            There are two parts to a packet: the header information (the envelope) and the payload/contents. Google is only interested in the headers.<br>
                            <br>
                            THE BEACON PACKET<br>
                            <br>
                            There are many types of packets. The most interesting packet is the "Beacon". The average access-point sends out this Beacon many times per second, advertising its existence, its name (the "SSID"), and a list of features (like whether a password is required).<br>
                            <br>
                            When your laptop gives you a list of nearby access-point, it's simply listing the access-points from which it has received a Beacon. A program like NetStumbler builds its list from the same information.<br>
                            <br>
                            The following picture shows a typical Beacon packet. I'm sitting a <a href="http://www.panerabread.com/">Panera</a> café with free WiFi, this is the Beacon from the local access-point.<br>
                            <div style="clear:both;text-align:center">
                                <a href="http://4.bp.blogspot.com/_TJ2XNCjin0s/S_QhT-k-CKI/AAAAAAAAAOQ/UuMrGGmOFgI/s1600/blog-streetviewifi-beacon.PNG" style="margin-left:1em;margin-right:1em"><img border="0" src="http://4.bp.blogspot.com/_TJ2XNCjin0s/S_QhT-k-CKI/AAAAAAAAAOQ/UuMrGGmOFgI/s320/blog-streetviewifi-beacon.PNG"></a>
                            </div><br>
                            The raw packet is shown in a "hex dump" at the bottom, with the decode explanation at the top. I've selected the "SSID" field to show how the decoded information corresponds to the selected hex data.<br>
                            <br>
                            THE DATA PACKET<br>
                            <br>
                            While the Beacon packet is the most useful packet, other packets can be useful too.<br>
                            <br>
                            Let's say that there is an access-point within a building, but the Beacon packets are blocked or too weak to reach the street. The access-point will exist, but Street View won't be able to see it.<br>
                            <br>
                            However, somebody could be using a laptop halfway between the access-point and the Street View car. The laptop's packets can reach both the car and the access-point. Thus, even though Street View cannot see the access-point itself, it can still infer its existence by looking at the DATA packets.<br>
                            <br>
                            A data packet example is shown below (in typical decode+hexdump format). This packet sent was sent by my laptop to the local access-point. I've highlighted the "BSS ID" field, which is the MAC address of the access-point (the same one shown in the Beacon above).<br>
                            <div style="clear:both;text-align:center">
                                <a href="http://2.bp.blogspot.com/_TJ2XNCjin0s/S_QhcsOB5iI/AAAAAAAAAOY/E7kRhAlAURk/s1600/blog-streetviewifi-data2.PNG" style="margin-left:1em;margin-right:1em"><img border="0" src="http://2.bp.blogspot.com/_TJ2XNCjin0s/S_QhcsOB5iI/AAAAAAAAAOY/E7kRhAlAURk/s320/blog-streetviewifi-data2.PNG"></a>
                            </div><br>
                            <br>
                            In addition, you'll notice that the signal strength in the decode. Google can use this to triangulate the location of the device that sent the packet. Street View knows the precise GPS location of the car as it rolls down the street. If it can get three beacons (or other data packets) from the access-point, it can triangulate the position of the access-point. Moreover, if it stores the raw packets from one day as the car takes one route, it can correlate the packets with another day's packets on a different route.<br>
                            <div style="clear:both;text-align:center">
                                <a href="http://2.bp.blogspot.com/_TJ2XNCjin0s/S_QhkTTOb7I/AAAAAAAAAOg/UrvyHuVp6pY/s1600/blog-streetviewifi-triangulate.PNG" style="margin-left:1em;margin-right:1em"><img border="0" height="193" src="http://2.bp.blogspot.com/_TJ2XNCjin0s/S_QhkTTOb7I/AAAAAAAAAOg/UrvyHuVp6pY/s200/blog-streetviewifi-triangulate.PNG" width="200"></a>
                            </div><br>
                            Triangulation is a lot harder than you'd think. This is because many things will block or reflect the signal. Therefore, as the car drives buy, it wants to get every single packet transmitted by the access-point in order to figure out its location. Curiously, with all that data, Google can probably also figure out the structure of the building, by finding things like support columns that obstruct the signal.<br>
                            <br>
                            What's important about this packet is that Google only cares about the MAC addresses found in the header, and the signal strength, but doesn't care about the payload. If you look further down in the payload, you'll notice that it's inadvertently captured a URL.<br>
                            <div style="clear:both;text-align:center">
                                <a href="http://2.bp.blogspot.com/_TJ2XNCjin0s/S_QhcsOB5iI/AAAAAAAAAOY/E7kRhAlAURk/s1600/blog-streetviewifi-data2.PNG" style="margin-left:1em;margin-right:1em"><img border="0" src="http://2.bp.blogspot.com/_TJ2XNCjin0s/S_QhcsOB5iI/AAAAAAAAAOY/E7kRhAlAURk/s320/blog-streetviewifi-data2.PNG"></a>
                            </div><br>
                            Take a look again. Even though the access-point MAC address is highlighted, there's extra data in the packet. These extra data will include URLs, fragments of data returned from websites (like images), the occasional password, cookies, fragments of e-mails, and so on. However, the quantity of this information will be low compared to the total number of packets sniffed by Google.<br>
                            <br>
                            That's the core of this problem. Google sniffed packets, only caring about MAC addresses and SSIDs, but when somebody did an audit, they found that the captured packets occasionally contained more data, such as URLs and e-mail fragments.<br>
                            <br>
                            <br>
                            NEIGHBORHOOD SNIFFING<br>
                            <br>
                            Google captured very little as it drove through neighborhoods. The primary reason is that most people encrypt their connections (by putting a password on their access-point). The second reason is that the car is only near an access-point for a few seconds - during which time it's unlikely that any data is being transferred.<br>
                            <br>
                            You can verify this yourself (assuming it's legal in your area). You can download a version of Linux full of security tools like "BackTrack 4". You don't have to install it on your laptop, but instead, can put it on a USB flash drive, and boot from the flash drive. You can then run a tool like "<a href="http://www.erratasec.com/ferret.html">ferret</a>" that will sniff the wifi and show you interesting private information, like URLs. (Only half the wifi devices support such raw sniffing, you may have to buy a separate USB wifi stick for $10).<br>
                            <br>
                            If you drive down the street running 'ferret', you'll see that it almost never shows you any information other than wifi control traffic (like Beacons).<br>
                            <br>
                            The real reason Google might have data payload isn't from neighborhoods at all, but from cyber cafes and hotspots. If a Google Street View car came down the street near this Panera, it will be flooded with data packets from people within the café. This is the slowest period of the day, but I count 7 people using their laptops and one person using their iPhone to surf the web. Moreover, whereas people may encrypt their traffic at home, the hot spot here at Panera is unencrypted.<br>
                            <br>
                            <br>
                            PROTECT YOURSELF, DON'T PUNISH GOOGLE<br>
                            <br>
                            It's really easy to protect your data: simply turn on WPA. This completely stops Google (or anybody else) from spying on your private data (assuming you haven't done something stupid like chosen an easily guessed password, or chosen WEP instead of WPA). If you don't encrypt your traffic, then by implication, you don't care if people eavesdrop on it.<br>
                            <br>
                            Laws against this won't stop the bad guys (hackers). They will only unfairly punish good guys (like Google) whenever they make a mistake.<br>
                            <br>
                            HOW TO FIX IT<br>
                            <br>
                            Google can easily get rid of the payloads by "slicing" data packets to the first 24 bytes. This preserves the MAC address and signal strength information Google wants, but gets rid of any private information inadvertently gathered from people who do not encrypt their connection.<br>
                            <br>
                            EDITORIAL: THE NEED FOR TRANSPARENCY<br>
                            <br>
                            This situation was only found because somebody audited Google's data. Just because they have no evil intentions doesn't mean they haven't made an evil mistake. The more Google becomes our overlord, the more we should demand that they be open and transparent about what data they are keeping about people.<br>
                            <br>
                            CONCLUSION<br>
                            <br>
                            What I've focused on here is question of Google's collection of "data" payloads, not the other privacy issues. Some people have accused Google of lying, and for having some nefarious purpose for gathering these packets. However, anybody who has experience in WiFi mapping would believe Google. Data packets help Google find more access-points and triangulate them, yet the payload of the packets do nothing useful for Google because they are only fragments.
                            <div>
                                <img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/37798047-4781307615521107759?l=erratasec.blogspot.com" alt="">
                            </div>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://erratasec.blogspot.com/2010/05/technical-details-of-street-view-wifi.html">http://erratasec.blogspot.com/2010/05/technical-details-of-street-view-wifi.html</a>
                    </p>
                </div>
            </article>

            <nav id="post-nav">


            </nav>

            <script id="discus-javascript">
                var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script>

            <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>

        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a>
                This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer>

        <script async src="/static/js/common.js"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js" integrity="sha256-hj+5FRlAuvAFANiefn0PpJYCkV1X4QT9EgiPd+6QnCw=" crossorigin="anonymous"></script>
    </body>
</html>
