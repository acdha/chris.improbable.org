<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>
            AutoHead – my first Browserscope user test
        </title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all"><!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->
        <meta http-equiv="last-modified" content="Thu, 13 May 2010 18:06:17 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script type="application/javascript">
var _prum={id:"5166be01e6e53d1007000001"};var PRUM_EPISODES=PRUM_EPISODES||{};PRUM_EPISODES.q=[];PRUM_EPISODES.mark=function(b,a){PRUM_EPISODES.q.push(["mark",b,a||new Date().getTime()])};PRUM_EPISODES.measure=function(b,a,b){PRUM_EPISODES.q.push(["measure",b,a,b||new Date().getTime()])};PRUM_EPISODES.done=function(a){PRUM_EPISODES.q.push(["done",a])};PRUM_EPISODES.mark("firstbyte");(function(){var b=document.getElementsByTagName("script")[0];var a=document.createElement("script");a.type="text/javascript";a.async=true;a.charset="UTF-8";a.src="//rum-static.pingdom.net/prum.min.js";b.parentNode.insertBefore(a,b)})();
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1>
                    <a href="/about/">Chris Adams</a>
                </h1>
                <h2>
                    Programmer, cyclist, photographer
                </h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="http://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="http://delicious.com/acdha" rel="me">del.icio.us</a>
                </li>
                <li>
                    <a href="http://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://plus.google.com/116562742092842686896?rel=author" rel="me">Google+</a>
                </li>
                <li>
                    <a href="http://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="http://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
                <li>
                    <a href="http://connect.garmin.com/explore?owner=acdha" rel="me">Garmin Connect</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2010-05-12T18:17:57-04:00">
                    <meta itemprop="dateModified" content="2010-05-12T18:17:57-04:00"><time class="date" itemprop="datePublished" datetime="2010-05-12T22:17:57+00:00">May 12</time>
                    <h2 itemprop="title">
                        AutoHead – my first Browserscope user test
                    </h2>
                </header>
                <div class="body" itemprop="articleBody">
                    <div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/4fe38cede455d95a">
                        <blockquote>
                            <p>
                                In the comments from my last blog post (<a href="http://www.stevesouders.com/blog/2010/05/11/appendchild-vs-insertbefore/">appendChild vs insertBefore</a>) someone asked which browsers do and don’t automatically create a HEAD element. This is important when you’re deciding how to dynamically add scripts to your web page. I used this question as the motivation for creating my first <a href="http://www.browserscope.org/user/tests/howto">Browserscope user test</a>. Here’s the story behind this new feature in Browserscope and the answer to the automatically create HEAD question. (You can run the <a href="http://stevesouders.com/tests/autohead.html">AutoHead test</a> to skip ahead and see the results.)
                            </p>
                            <h2>
                                Level, Meta-level, Meta-meta-level
                            </h2>
                            <p>
                                <strong>Level1:</strong> When Chrome was launched in 2008 I started a project called <a href="http://www.stevesouders.com/blog/2008/09/09/ua-profiler-and-google-chrome/">UA Profiler</a> to analyze the performance characteristics of browsers. The key concept was to crowdsource gathering the data – publish the test framework and encourage the web community to run the tests on their browser of choice. There are numerous benefits to this approach:
                            </p>
                            <ul style="margin-top:0">
                                <li>a wider variety of browsers are tested (more than I could possibly install in a test lab)
                                </li>
                                <li>results for new browsers happen immediately (often before the browser is officially released)
                                </li>
                                <li>tests are performed under real world conditions
                                </li>
                            </ul>
                            <p>
                                <strong>Level 2:</strong> I teamed up with Lindsey Simon to take UA Profiler to the next level. The result was the <a href="http://www.stevesouders.com/blog/2009/09/13/browserscope-how-does-your-browser-compare/">launch</a> of <a href="http://www.browserscope.org/">Browserscope</a>. In addition to making this a functioning open source project, the framework was opened up to include multiple test categories. In addition to performance (renamed “<a href="http://www.browserscope.org/?category=network&amp;v=top">Network</a>“), other test categories were added: <a href="http://www.browserscope.org/?category=security&amp;v=top">Security</a>, <a href="http://www.browserscope.org/?category=acid3&amp;v=top">Acid3</a>, <a href="http://www.browserscope.org/?category=selectors&amp;v=top">Selectors API</a>, and <a href="http://www.browserscope.org/?category=richtext&amp;v=top">Rich Text</a>.
                            </p>
                            <p>
                                <strong>Level 3:</strong> <a href="http://is.onthafly.com/2010/04/user-tests-in-browserscope.html">A few weeks ago</a> Lindsey took Browserscope to the next level with the addition of the <a href="http://www.browserscope.org/user/tests/howto">User Tests feature</a>. Now, <em>anyone</em> can add a test to Browserscope. In this early alpha version of the feature, users create one or more test pages on their own server, register the test with Browserscope, and embed a JavaScript snippet at the end of their test to send the results back to Browserscope for storing. The benefit for the test creator is that Browserscope stores all the data, parses the User-Agent strings for proper categorization, and provides a widget for viewing the results.
                            </p>
                            <p>
                                Even though Lindsey is careful to call this an alpha, it went very smoothly for me. Once I had my test page, it took less than 15 minutes to integrate with Browserscope and start gathering results. So let’s take a look at my test…
                            </p>
                            <h2>
                                the test – AutoHead
                            </h2>
                            <p>
                                In my <a href="http://www.stevesouders.com/blog/2010/05/12/2010/05/11/appendchild-vs-insertbefore/">appendChild vs insertBefore</a> blog post I talk about why this code generates bugs:
                            </p>
                            <pre style="margin-left:20px;margin-right:20px;background:#F0F0F0;padding:8px;margin-bottom:0">
document.getElementsByTagName['head'][0].appendChild(...)
</pre>
                            <p>
                                The context was using this pattern in 3rd party code snippets – where you don’t have any control of the main page. It turns out that some web pages out in the wild wild web don’t use the HEAD tag. Luckily, most browsers automatically create a HEAD element if one isn’t specified in the page. Unfortunately, not all browsers do this.
                            </p>
                            <p>
                                In the comments on that blog post <a href="http://www.stevesouders.com/blog/2010/05/11/appendchild-vs-insertbefore/#comment-2072">Andy asked</a>, “What browsers are we talking about here?”
                            </p>
                            <p>
                                How can I possibly attempt to answer that question? It would require running a test on many different versions of many different browsers, including mobile devices. I’m not equipped with a setup to do that.
                            </p>
                            <p>
                                Then the light bulb lit up. <img title="light bulb" src="http://stevesouders.com/images/lightbulb-15x22.png" alt="light bulb" width="15" height="22"> I can do this with a Browserscope User Test!
                            </p>
                            <p>
                                Creating the test was easy. My HTML page doesn’t have a HEAD tag. I put a script at the bottom that checks if the page contains a head element:
                            </p>
                            <pre style="margin-left:20px;margin-right:20px;background:#F0F0F0;padding:8px;margin-bottom:0">
bHead = document.getElementsByTagName('head').length;
</pre>
                            <p>
                                I have to store the result in a specific variable that Browserscope looks for:
                            </p>
                            <pre style="margin-left:20px;margin-right:20px;background:#F0F0F0;padding:8px;margin-bottom:0">
var _bTestResults = {
'autohead': bHead
};
</pre>
                            <p>
                                This data structure is slurped up by Browserscope via this snippet (as shown on the <a href="http://www.browserscope.org/user/tests/howto">User Tests Howto page</a>):
                            </p>
                            <pre style="margin-left:20px;margin-right:20px;background:#F0F0F0;padding:8px;margin-bottom:0">
(function() {
var _bTestKey = '&lt;YOUR-TEST-ID-GOES-HERE&gt;';
var _bScript = document.createElement('script');
_bScript.src = 'http://www.browserscope.org/user/beacon/'
               + _bTestKey;
_bScript.setAttribute('async', 'true');
var scripts = document.getElementsByTagName('script');
var lastScript = scripts[scripts.length - 1];
lastScript.parentNode.insertBefore(_bScript, lastScript);
})();
</pre>
                            <p>
                                Voila! You’re done. Well, almost done. You still have to promote your test.
                            </p>
                            <h2>
                                Promoting your test
                            </h2>
                            <p>
                                With this small amount of work I’m now ready to ask the web community to help me gather results. For me personally, I accomplish this by writing this blog post asking for help:
                            </p>
                            <p style="text-align:center">
                                <span style="color:#333399;font-family:Arial;font-size:1.2em"><strong>Help me out by running the <a href="http://stevesouders.com/tests/autohead.html">AutoHead test</a>. Thanks!</strong></span>
                            </p>
                            <p>
                                I’ve embedded the Browserscope results snippet in the iframe below, so you can see results as they come in. So far iPhone and Safari 3.2 are the only browsers that don’t automatically create the HEAD element.
                            </p>
                            <p>
                                If you want to avoid bugs when dynamically adding scripts, you might want to use one of the more solid patterns mentioned in my <a href="http://www.stevesouders.com/blog/2010/05/11/appendchild-vs-insertbefore/">appendChild vs insertBefore</a> blog post. If you want to gather data on some browser test that interests you, read the <a href="http://www.browserscope.org/user/tests/howto">Browserscope User Test Howto</a> and go for it. If you have problems, contact the Browserscope <a href="http://groups.google.com/group/browserscope">mailing list</a>. If you have success, <a href="http://stevesouders.com/contact.php">contact me</a> and I’ll tweet your test to drive more traffic to it. This is still in alpha, but I’m very excited about the possibilities. I can’t wait to see the kinds of tests you come up with.
                            </p>
                            <div style="background:#FDFAE1;padding:2px 16px 2px 16px">
                                <p>
                                    <strong>Update:</strong> After just one day, thanks to all of you who ran the test, I’ve collected 400 measurements on 20 different browsers and 60 unique versions. The results show that the following browsers do NOT automatically create a HEAD element: <strong>Android 1.6</strong>, <strong>Chrome 5.0.307</strong> (strange), <strong>iPhone 3.1.3</strong>, <strong>Nokia 90</strong>, <strong>Opera 8.50</strong>, <strong>Opera 9.27</strong>, and <strong>Safari 3.2.1</strong>. This adds up to over 1% of your users, so it’s important to keep this in mind when adding scripts dynamically.
                                </p>
                                <p>
                                    I also had some comments I wanted to pass on about my Browserscope user test. In hindsight, I wish I had chosen a better “test_key” name for the _bTestResults object. I didn’t realize this would appear as the column header in my results table. Rather than “autohead” I would have done “Automatically Creates HEAD”. Also, rather than return 0 or 1, I wish I had returned “no” and “yes”. Finally, I wish there was a way to embed the results table widget besides using an iframe. I’ll file bugs requesting better documentation for these items.
                                </p>
                            </div>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://www.stevesouders.com/blog/2010/05/12/autohead-my-first-browserscope-user-test/">http://www.stevesouders.com/blog/2010/05/12/autohead-my-first-browserscope-user-test/</a>
                    </p>
                </div>
            </article>
            <nav id="post-nav"></nav><script id="discus-javascript">
    var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>
        <footer id="site-footer">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer><script async="" defer src="/static/js/common.js">
</script><script id="google-analytics">
    var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-2097834-1']);
            _gaq.push(['_setDomainName', 'improbable.org']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </body>
</html>
