<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>
            Code for Flexibility: A Manifesto
        </title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all"><!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->
        <meta http-equiv="last-modified" content="Fri, 16 Apr 2010 12:37:06 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script type="application/javascript">
var _prum={id:"5166be01e6e53d1007000001"};var PRUM_EPISODES=PRUM_EPISODES||{};PRUM_EPISODES.q=[];PRUM_EPISODES.mark=function(b,a){PRUM_EPISODES.q.push(["mark",b,a||new Date().getTime()])};PRUM_EPISODES.measure=function(b,a,b){PRUM_EPISODES.q.push(["measure",b,a,b||new Date().getTime()])};PRUM_EPISODES.done=function(a){PRUM_EPISODES.q.push(["done",a])};PRUM_EPISODES.mark("firstbyte");(function(){var b=document.getElementsByTagName("script")[0];var a=document.createElement("script");a.type="text/javascript";a.async=true;a.charset="UTF-8";a.src="//rum-static.pingdom.net/prum.min.js";b.parentNode.insertBefore(a,b)})();
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1>
                    <a href="/about/">Chris Adams</a>
                </h1>
                <h2>
                    Programmer, cyclist, photographer
                </h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="http://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="http://delicious.com/acdha" rel="me">del.icio.us</a>
                </li>
                <li>
                    <a href="http://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://plus.google.com/116562742092842686896?rel=author" rel="me">Google+</a>
                </li>
                <li>
                    <a href="http://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="http://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
                <li>
                    <a href="http://connect.garmin.com/explore?owner=acdha" rel="me">Garmin Connect</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2010-04-16T08:37:06-04:00">
                    <meta itemprop="dateModified" content="2010-04-16T08:37:06-04:00"><time class="date" itemprop="datePublished" datetime="2010-04-16T12:37:06+00:00">Apr 16</time>
                    <h2 itemprop="title">
                        Code for Flexibility: A Manifesto
                    </h2>
                </header>
                <div class="body" itemprop="articleBody">
                    <div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/aafa7fbfe40a3b96">
                        <blockquote>
                            <p>
                                Different environments give rise to different programming styles. Over the last few years there’s been a massive trend for software to move from:
                            </p>
                            <blockquote>
                                <p>
                                    Work for a whole year then release a fixed binary, then write for another year.
                                </p>
                            </blockquote>
                            <p>
                                to the more dynamic, web 2.0 ideal of:
                            </p>
                            <blockquote>
                                <p>
                                    Whip up a web application and upload each feature as soon as it’s done.
                                </p>
                            </blockquote>
                            <p>
                                This is a much more efficient way to do business, but it’s a very different kind of programming environment and benefits from a very different programming style – not the one we’ve all picked up by copying API conventions and old-fashioned corporate practices.
                            </p>
                            <p>
                                If you’re able to make your software available to customers instantly, there is <strong>one optimal strategy</strong>: code for flexibility.
                            </p>
                            <p>
                                The flexibility of your code is defined by the ease with which you can modify it to fulfill some purpose you hadn’t envisaged at the time you wrote it.
                            </p>
                            <p>
                                This is important, because when you give your customers a rapidly-iterating product you’re going to find your initial guess at what they wanted was completely wrong. In fact, all your guesses are probably wrong. You’re going to spend <i>years</i> learning from your customers and adapting your software in all sorts of unexpected ways to fit their needs as precisely as possible.
                            </p>
                            <p>
                                For a long time I confused generality with flexibility; I was always worrying about how I <i>might</i> want to use a class in the future and trying to abstract out all the common use cases right form the start. As it turns out, this is the opposite of flexibility; this builds rigidity into the project. The moment you realise that actually it makes much more sense to have flip your design so that users vote for *each other’s* questions a little part of you dies inside, because you now have five levels of abstraction and four different database tables to rewrite.
                            </p>
                            <p>
                                In fact, flexible code is <i>specific</i> code. We want to write code that expresses, as succinctly as possible, a solution to a problem. It’s quicker to read and understand code with fewer syntactic elements, such as variables, functions and classes. It’s also quicker to repurpose.
                            </p>
                            <p>
                                We also build flexibility – or rigidity – into the large-scale structure of our programs. I’ve often fallen in love with the idea of encapsulation for its own sake; I thought that each part of my program should be as well-hidden from the rest as possible, with only one or two well-specified interfaces connecting things. This is a very tempting dream that results in a kind of tree-like structure of classes. This is <i>extremely</i> rigid, because by design it’s difficult to get access to classes in another branch of the tree.
                            </p>
                            <p>
                                The best way to build for flexibility is drawn from the Lisp world and championed by Paul Graham: when working on a problem, write code that builds up into a language for describing and reasoning about the problem succinctly.
                            </p>
                            <blockquote>
                                <p>
                                    You can magnify the effect of a powerful language by using a style called bottom-up programming, where you write programs in multiple layers, the lower ones acting as programming languages for those above.
                                </p>
                            </blockquote>
                            <p>
                                This way the solution ends up being a clear, readable algorithm written in this language – the language of the problem domain. In non-lisp languages you end up with a set of functions and classes that make it easy to reason about the problem, a little like the standard string and mail classes make it easy to work with strings and email.
                            </p>
                            <p>
                                Building up code for reasoning about the problem domain is vital for flexibility, because although our solution to the problem might change drastically as we get extra insights from our customers, the domain of the problem will probably only change incrementally as we expand into new areas. Adopting this flatter, domain-language appropach to program design almost always increases flexibility.
                            </p>
                            <p>
                                Another aspect of flexibility is robustness. A function or class that makes assumptions about the circumstances it is called in is going to break as soon as we repurpose it in some other part of the code; sooner or later I always forget that the caller needs to check the file exists, or that the user isn’t null and already has a validated address. There are two schools of thought on how to deal with this – contract programming (essentially visible, machine-verified preconditions) and defensive programming (make no assumptions, handle all the exceptions you can locally and try hard not to destroy any persistent state if things go wrong). It doesn’t really matter which you use, but use one of them.
                            </p>
                            <p>
                                Many of the extreme programming principles help us write flexible code – the c2 team recognized that:
                            </p>
                            <blockquote>
                                <p>
                                    Change is the only constant, so optimize for change.
                                </p>
                            </blockquote>
                            <p>
                                They looked at this from a project management perspective, but code guidelines like Don’t Repeat Yourself and You Ain’t Gonna Need It are well-recognized as being fundamental to producing flexible code. In fact, these two oft-quoted principles are worth looking at more closely in terms of how they create flexibility.
                            </p>
                            <p>
                                <strong>Don’t Repeat Yourself</strong>: When modifying a bit of code it doesn’t help if there are three or four undocumented places it also needs to be changed; I never remember them all. A perfectly good way to deal with this is to add a comment in each block mentioning the link rather than to refactor right away. Over-zealous refactoring tends to merge lots of bits of code together that look kind of similar but ultimately end up going in different directions. At this point very few people take the logical step of splitting a class or subsystem back into two more specialized units; instead it’s over-generalized again and again until it’s completely unmaintainable
                            </p>
                            <p>
                                Refactoring should always be Just In Time, because the later you leave it the better you understand the problem; refactor too soon and you’ll combine things in a way that restricts you later, building rigidity into the system.
                            </p>
                            <p>
                                <strong>You Ain’t Gonna Need It</strong>: This doesn’t just apply to extra functionality. It applies to all elements of your code, from accessors (a waste of time in most cases) to overall class structure. You’re not going to need to handle N kinds of book loan, you’re going to handle at most two, so don’t write some complicated code to handle the general case. You’re not going to need three classes, one interface and two event types for your “please wait” animation because there’s only ever going to be one and it’s always going to be while printing. Just write a function with a callback and release – the simpler it is, the quicker we can write it today and the more easily we can modify it tomorrow.
                            </p>
                            <p>
                                There is a tension here. On the one hand, we want to write our software by constructing recombinable blocks that represent the problem domain, yet on the other we want to write the simplest thing possible – and writing reusable blocks of code isn’t usually the simplest thing possible.
                            </p>
                            <p>
                                This tension is resolved when we stop looking at a program as a snapshot of its state at any one time and instead look at it as an evolving codebase with many possible futures. So we write the simplest thing possible, yet while doing so we keep an eye on its potential for being refactored into nice, reusable blocks and avoid doing making poor choices that will make that process difficult. The potential for refactoring is just as valuable as the refactoring itself, but by deferring the refactoring we keep our options open.
                            </p>
                            <p>
                                The ability to see the code you’re writing today <i>and</i> its possible evolution through time is something you can focus on learning, but it also grows with experience. It’s one of the things that makes a great hacker’s code subtly better than a newbie’s code – both start writing simple code that addresses the problem directly, but the newbie makes all sorts of small structural mistakes that get in the way of the code’s growth, whereas the hacker knows when it’s time to turn this set of functions into a class, or to abstract out this behaviour, <i>and has already prepared the way for doing so</i>. The effect is to make programming look effortless again, naturally flowing from the simple into the complex.
                            </p>
                            <p>
                                I’m not a great hacker who does this as naturally as breathing. I have tasted it, have seen glimpses of it in my own work and in other people’s, but I still make mistakes; I mistime my refactoring – sometimes too early, sometimes too late. I still bind objects to each other too tightly here, or too loosely there. Despite my failings, just aiming at this goal makes me far more productive than I’ve ever been before. It’s not an all-or-nothing premise. The closer you come, the smoother and lower-friction your development will be.
                            </p>
                            <p>
                                We can gather all these heuristics together into a concise manifesto:
                            </p>
                            <p>
                                <strong>A Manifesto for Flexibility</strong>
                            </p>
                            <ol>
                                <li>
                                    <strong>Write new code quickly</strong>, as if you’re holding your breath. Cut corners and get it in front of users as quickly as possible.
                                </li>
                                <li>
                                    <strong>Keep your code specific</strong>, with a clear purpose. Don’t over-generalize and don’t refactor too early – it should be as simple as possible, but not simpler.
                                </li>
                                <li>
                                    <strong>Stay aware that all code is thrown away or changed dramatically</strong>. Hold the image of the refactoring you’d like to do in your mind and avoid doing things that will make it more difficult – this is slightly better than doing the refactoring now.
                                </li>
                                <li>
                                    <strong>Recognize the point at which simple code becomes messy code</strong> and refactor just enough to keep the message clear. Just In Time refactoring is not the same as no refactoring.
                                </li>
                                <li>
                                    <strong>Build up a language</strong> for reasoning about your domain and express your application in that language. Avoid building up a large, rigid hierarchy of over-encapsulated classes that embody your particular solution to the problem.
                                </li>
                            </ol>
                            <p>
                                Postscript: You should do this in a startup and you should do it in personal project, but you shouldn’t do it everywhere. If, say, you’re writing the Java or .NET API then none this applies to you because:
                            </p>
                            <ol>
                                <li>Millions of people will abuse your API in every way possible the very second it’s released.
                                </li>
                                <li>Every time you change something a howling mob will descend upon your office, making it difficult to get a good parking spot.
                                </li>
                            </ol><br>
                            <a rel="nofollow" href="http://feeds.wordpress.com/1.0/gocomments/coderoom.wordpress.com/70/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/comments/coderoom.wordpress.com/70/"></a> <a rel="nofollow" href="http://feeds.wordpress.com/1.0/godelicious/coderoom.wordpress.com/70/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/delicious/coderoom.wordpress.com/70/"></a> <a rel="nofollow" href="http://feeds.wordpress.com/1.0/gostumble/coderoom.wordpress.com/70/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/stumble/coderoom.wordpress.com/70/"></a> <a rel="nofollow" href="http://feeds.wordpress.com/1.0/godigg/coderoom.wordpress.com/70/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/digg/coderoom.wordpress.com/70/"></a> <a rel="nofollow" href="http://feeds.wordpress.com/1.0/goreddit/coderoom.wordpress.com/70/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/reddit/coderoom.wordpress.com/70/"></a> <img alt="" border="0" src="http://stats.wordpress.com/b.gif?host=coderoom.wordpress.com&amp;blog=10966040&amp;post=70&amp;subd=coderoom&amp;ref=&amp;feed=1">
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://coderoom.wordpress.com/2010/04/16/code-for-flexibility-a-manifesto/">http://coderoom.wordpress.com/2010/04/16/code-for-flexibility-a-manifesto/</a>
                    </p>
                </div>
            </article>
            <nav id="post-nav"></nav><script id="discus-javascript">
    var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>
        <footer id="site-footer">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer><script async="" defer src="/static/js/common.js">
</script><script id="google-analytics">
    var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-2097834-1']);
            _gaq.push(['_setDomainName', 'improbable.org']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </body>
</html>
