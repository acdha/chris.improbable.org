<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>
            Reversing Code Bloat with the JavaScript Knowledge Base
        </title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all"><!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->
        <meta http-equiv="last-modified" content="Wed, 16 Jun 2010 00:01:57 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script type="application/javascript">
var _prum={id:"5166be01e6e53d1007000001"};var PRUM_EPISODES=PRUM_EPISODES||{};PRUM_EPISODES.q=[];PRUM_EPISODES.mark=function(b,a){PRUM_EPISODES.q.push(["mark",b,a||new Date().getTime()])};PRUM_EPISODES.measure=function(b,a,b){PRUM_EPISODES.q.push(["measure",b,a,b||new Date().getTime()])};PRUM_EPISODES.done=function(a){PRUM_EPISODES.q.push(["done",a])};PRUM_EPISODES.mark("firstbyte");(function(){var b=document.getElementsByTagName("script")[0];var a=document.createElement("script");a.type="text/javascript";a.async=true;a.charset="UTF-8";a.src="//rum-static.pingdom.net/prum.min.js";b.parentNode.insertBefore(a,b)})();
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1>
                    <a href="/about/">Chris Adams</a>
                </h1>
                <h2>
                    Programmer, cyclist, photographer
                </h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="http://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="http://delicious.com/acdha" rel="me">del.icio.us</a>
                </li>
                <li>
                    <a href="http://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://plus.google.com/116562742092842686896?rel=author" rel="me">Google+</a>
                </li>
                <li>
                    <a href="http://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="http://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
                <li>
                    <a href="http://connect.garmin.com/explore?owner=acdha" rel="me">Garmin Connect</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2010-06-15T20:01:57-04:00">
                    <meta itemprop="dateModified" content="2010-06-15T20:01:57-04:00"><time class="date" itemprop="datePublished" datetime="2010-06-16T00:01:57+00:00">Jun 16</time>
                    <h2 itemprop="title">
                        Reversing Code Bloat with the JavaScript Knowledge Base
                    </h2>
                </header>
                <div class="body" itemprop="articleBody">
                    <div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/bd87a73a00eb0f2b">
                        <p class="annotation">
                            Interesting - I wonder how far we are from having something like the YUI Loader selectively download things like non-native JSON support only on browsers which have to pay that tax. It'd certainly push IE further back in the performance line.
                        </p>
                        <blockquote>
                            <div>
                                <p style="margin:0pt"></p>
                                <div>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        JavaScript libraries let developers do more with less code. But JavaScript libraries need to work on a variety of browsers, so using them often means shipping even more code. If JQuery has code to support XMLHttpRequest over ActiveX on an older browser like IE6 then you end up shipping that code even if your application doesn't support IE6. Not only that, but you ship that code to the other 90% of newer browsers that don't need it.
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt"></p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        <br>
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        This problem is only going to get worse. Browsers are rushing to implement HTML5 and EcmaScript5 features like <span style="font-family:monospace">JSON.parse</span> that used to be provided only in library code, but libraries will likely have to keep that code for years if not decades to support older browsers.
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        <br>
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt"></p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:16pt;margin-left:0pt">
                                        Lots of compilers (incl. (<a href="http://www.crockford.com/javascript/jsmin.html">JSMin</a>, <a href="http://www.dojotoolkit.org/reference-guide/shrinksafe/index.html">Dojo</a>, <a href="http://developer.yahoo.com/yui/compressor/">YUI</a>, <a href="http://code.google.com/closure/compiler/">Closure</a>, <a href="http://caja.appspot.com/tools/index">Caja</a>) remove unnecessary code from JavaScript to make the code you ship smaller. They seem like a natural place to address this problems. Optimization is just taking into account the context that code is going to run in to improve it; giving compilers information about browsers will help them avoid shipping code to support marginal browsers to modern browsers.
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        The JavaScript Knowledge Base (JSKB) on <a href="http://www.browserscope.org/jskb/test">browserscope.org</a> seeks to systematically capture this information in a way that compilers can use.
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:16pt;margin-left:0pt">
                                        It collects facts about browsers using JavaScript snippet. The JavaScript code (<span style="font-family:monospace">!!window.JSON &amp;&amp; typeof window.JSON.stringify === 'function'</span>) is true if JSON is defined. JSKB knows that this is true for Firefox 3.5 but not Netscape 2.0.
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        <a href="http://caja.appspot.com/tools/index">Caja Web Tools</a> includes a code optimizer that uses these facts. If it sees code like
                                    </p>
                                    <pre>
if (typeof JSON.stringify !== 'function') { /* lots of code */ }
</pre>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        it knows that the body will never be executed on Firefox 3.5, and can optimize it out. The key here is that the developer writes feature tests, not version tests, and as browsers roll out new features, JSKB captures that information, letting compilers produce smaller code for that browser.
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        <br>
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        The Caja team just released Caja Web Tools, which already uses JSKB to optimize code. We hope that other JavaScript compilers will adopt these techniques. If you're working on a JavaScript optimizer, take a look at our <a href="http://www.browserscope.org/jskb/json">JSON</a> APIs to get an idea of what the JSKB contains.
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        <br>
                                    </p>
                                    <p style="margin-top:0pt;margin-right:0pt;margin-bottom:0pt;margin-left:0pt">
                                        If you're writing JavaScript library code or application code then the <a href="http://www.browserscope.org/jskb/about">JSKB</a> documentation can suggest good feature tests. And the examples in the Caja Web Tools <a href="http://caja.appspot.com/tools/index">testbed</a> are good starting places.
                                    </p>
                                </div><br>
                                <span style="font-style:italic;font-size:100%">By Mike Samuel (Caja), Lindsey Simon (Browserscope)</span>
                            </div>
                            <div>
                                <img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/11300808-5776355219552294527?l=googlecode.blogspot.com" alt="">
                            </div>
                            <div>
                                <a href="http://feeds.feedburner.com/~ff/blogspot/Dcni?a=ykPl52TiHvE:JyCyhRS0488:-BTjWOF_DHI"><img src="http://feeds.feedburner.com/~ff/blogspot/Dcni?i=ykPl52TiHvE:JyCyhRS0488:-BTjWOF_DHI" border="0"></a> <a href="http://feeds.feedburner.com/~ff/blogspot/Dcni?a=ykPl52TiHvE:JyCyhRS0488:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/blogspot/Dcni?d=yIl2AUoC8zA" border="0"></a> <a href="http://feeds.feedburner.com/~ff/blogspot/Dcni?a=ykPl52TiHvE:JyCyhRS0488:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/blogspot/Dcni?i=ykPl52TiHvE:JyCyhRS0488:V_sGLiPBpWU" border="0"></a>
                            </div>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://googlecode.blogspot.com/2010/06/reversing-code-bloat-with-javascript.html?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+blogspot%2FDcni+%28Google+Code+Blog%29">http://googlecode.blogspot.com/2010/06/reversing-code-bloat-with-javascript.html?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+blogspot%2FDcni+%28Google+Code+Blog%29</a>
                    </p>
                </div>
            </article>
            <nav id="post-nav"></nav><script id="discus-javascript">
    var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>
        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer><script async="" defer src="/static/js/common.js">
</script><script id="google-analytics">
    var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-2097834-1']);
            _gaq.push(['_setDomainName', 'improbable.org']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </body>
</html>
