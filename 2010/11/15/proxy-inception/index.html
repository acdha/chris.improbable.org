<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>
            Proxy Inception
        </title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all"><!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->
        <meta http-equiv="last-modified" content="Mon, 15 Nov 2010 13:52:32 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script type="application/javascript">
var _prum={id:"5166be01e6e53d1007000001"};var PRUM_EPISODES=PRUM_EPISODES||{};PRUM_EPISODES.q=[];PRUM_EPISODES.mark=function(b,a){PRUM_EPISODES.q.push(["mark",b,a||new Date().getTime()])};PRUM_EPISODES.measure=function(b,a,b){PRUM_EPISODES.q.push(["measure",b,a,b||new Date().getTime()])};PRUM_EPISODES.done=function(a){PRUM_EPISODES.q.push(["done",a])};PRUM_EPISODES.mark("firstbyte");(function(){var b=document.getElementsByTagName("script")[0];var a=document.createElement("script");a.type="text/javascript";a.async=true;a.charset="UTF-8";a.src="//rum-static.pingdom.net/prum.min.js";b.parentNode.insertBefore(a,b)})();
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1>
                    <a href="/about/">Chris Adams</a>
                </h1>
                <h2>
                    Programmer, cyclist, photographer
                </h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="http://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="http://delicious.com/acdha" rel="me">del.icio.us</a>
                </li>
                <li>
                    <a href="http://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://plus.google.com/116562742092842686896?rel=author" rel="me">Google+</a>
                </li>
                <li>
                    <a href="http://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="http://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
                <li>
                    <a href="http://connect.garmin.com/explore?owner=acdha" rel="me">Garmin Connect</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2010-11-15T08:52:32-04:00">
                    <meta itemprop="dateModified" content="2010-11-15T08:52:32-04:00"><time class="date" itemprop="datePublished" datetime="2010-11-15T12:52:32+00:00">Nov 15</time>
                    <h2 itemprop="title">
                        Proxy Inception
                    </h2>
                </header>
                <div class="body" itemprop="articleBody">
                    <div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/5029358193649cb5">
                        <p class="annotation">
                            I think I previously noted how JS proxy's have an interesting one-time-become story. Much fun will be had by all.
                        </p>
                        <blockquote>
                            <p>
                                After marinating for a few months, my <a href="http://jsconf.eu/">JSConf.eu</a> slides:
                            </p>
                            <div style="width:640px">
                                <strong style="display:block;margin:12px 0 4px"><a title="Proxies are Awesome!" href="http://www.slideshare.net/BrendanEich/metaprog-5303821">Proxies are Awesome!</a></strong><iframe src="http://reader.googleusercontent.com/reader/embediframe?src=http://static.slidesharecdn.com/swf/ssplayer2.swf?doc%3Dmetaprog-100928014929-phpapp01%26stripped_title%3Dmetaprog-5303821%26userName%3DBrendanEich&amp;width=640&amp;height=535" width="640" height="535"></iframe>
                            </div>
                            <p>
                                (<a href="http://www.slideshare.net/mobile/BrendanEich/metaprog-5303821">Mobile/No-Flash version</a>)
                            </p>
                            <p>
                                These are based directly on the excellent work of Mark Miller and Tom Van Cutsem, who developed the <a href="http://wiki.ecmascript.org/doku.php?id=harmony:proxies">harmony:proxies</a> proposal that is now approved for the next major iteration of the JavaScript standard (ECMA-262, probably edition 6 but we’ve learned the hard way not to number prematurely — anyway, approved for “<a href="http://wiki.ecmascript.org/doku.php?id=harmony:harmony">ECMAScript Harmony</a>” [<a href="https://mail.mozilla.org/pipermail/es-discuss/2008-August/003400.html">my original Harmony-coining post</a>]).
                            </p>
                            <p>
                                Harmony Proxies are already prototyped in Firefox 4 betas, thanks to <a href="http://andreasgal.com/">Andreas Gal</a>.
                            </p>
                            <p>
                                When I reached the “meta-level shifting” slide:
                            </p>
                            <div>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/meta-level-shifting.png" alt="meta-level shifting" height="480" width="640">
                            </div>
                            <p>
                                someone in the audience tweeted about how my talk was like <a href="http://www.imdb.com/title/tt1375666/">Inception</a> (<a href="https://github.com/karthick18/inception/">github-sourced simulator</a>). Meta-meta dreams within dreams (warning: meta-to-the-4th-shifting leads to Limbo).
                            </p>
                            <div>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/cobb-salad.jpg" alt="Cobb Salad"> (h/t <a href="http://twitter.com/#!/jedschmidt">@jedschmidt</a>)
                            </div>
                            <p>
                                The money-shot slide in my view is:
                            </p>
                            <div>
                                <img src="http://brendaneich.com/brendaneich_content/uploads/selective-interception.png" height="480" width="640">
                            </div>
                            <p>
                                which depicts how Proxies finally level the playing field between browser implementors using burned-into-browser-binaries C++ and web developers using downloaded JS.
                            </p>
                            <p>
                                It’s hard to overstate how this matters. The DOM (IE’s for sure, but all of them, back to the original I hacked in Netscape 2) suffers from its “VM territory” privileges, which have been abused to make all kinds of odd-ball “host objects”. Proxies both greatly reduce the weirdness of host objects and let JS hackers emulate and even implement such objects.
                            </p>
                            <p>
                                Novice JS hackers and all JS programmers happy at the base level of the language need not worry about the details of Proxies. Proxies cannot break the invariants that keep the JS lucid dream unfolding on stage. Specifically, you can’t hack traps onto an existing non-proxy object — you can only create a new proxy and start using it afresh, perhaps passing it off as a preexisting kind of object that it emulates [1].
                            </p>
                            <p>
                                But when you need to go backstage of the dream and change the rules without breaking the dreamer’s illusion, by interceding on every <code>get</code>, <code>set</code>, <code>call</code>, <code>construct</code>, etc., then Proxies are indispensable.
                            </p>
                            <p>
                                Firefox 4 is using Proxies to implement all of its <a href="https://developer.mozilla.org/en/XPConnect_security_membranes">security wrappers</a>.
                            </p>
                            <p>
                                Long-time SpiderMonkey fans will ask “why no <code>__noSuchMethod__</code>” (or: why not also have a <code>noSuchMethod</code> or <code>invoke</code> trap, or a flag to <code>get</code> telling when it is trapping a get for the entire callee part of a call expression)? The short answer is to keep the set of handler traps minimal in terms of JS semantics (modulo scalability), which do not include “invoke-only methods”. The <a href="https://mail.mozilla.org/pipermail/es-discuss/2010-October/011929.html">longer answer</a> is on <a href="https://mail.mozilla.org/listinfo/es-discuss">es-discuss</a>.
                            </p>
                            <p>
                                /be
                            </p>
                            <p>
                                [1] Inside the engine, a clever trick from Smalltalk called <code>becomes</code> is used to <a href="http://mxr.mozilla.org/mozilla-central/search?string=JSObject::swap&amp;find=jsobj.cpp">swap</a> a newborn Proxy and an existing object that has arbitrarily many live references. Thus an object requiring no behavioral intercession can avoid the overhead of traps until it escapes from a same-origin or same-thread context, and only if it does escape through a barrier will it become a trapping Proxy whose handler accesses the original object after performing access control checks or mutual exclusion.
                            </p>
                            <p>
                                The local jargon for such object/Proxy swapping is <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=580128">“brain transplants”</a>.
                            </p>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://brendaneich.com/2010/11/proxy-inception/">http://brendaneich.com/2010/11/proxy-inception/</a>
                    </p>
                </div>
            </article>
            <nav id="post-nav"></nav><script id="discus-javascript">
    var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>
        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer><script async="" defer src="/static/js/common.js">
</script><script id="google-analytics">
    var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-2097834-1']);
            _gaq.push(['_setDomainName', 'improbable.org']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </body>
</html>
