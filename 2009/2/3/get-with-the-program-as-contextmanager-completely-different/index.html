<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Get with the program as contextmanager | Completely Different</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all">
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->

        <meta http-equiv="last-modified" content="Tue, 03 Feb 2009 14:30:13 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-2097834-1', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1><a href="/about/">Chris Adams</a></h1>
                <h2>Programmer, cyclist, photographer</h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="https://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="https://pinboard.in/u:acdha/" rel="me">Pinboard</a>
                </li>
                <li>
                    <a href="https://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2009-02-03T09:30:13-04:00">
                    <meta itemprop="dateModified" content="2009-02-03T09:30:13-04:00">
                    <time class="date" itemprop="datePublished" datetime="2009-02-03T13:30:13+00:00">Feb 03</time>
                    <h2 class="" itemprop="title">Get with the program as contextmanager | Completely Different</h2>
                </header>

                <div class="body" itemprop="articleBody"><div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/79940d4b545f99f7">
                        <blockquote>
                            <blockquote>
                                <p>
                                    One of the cooler features that came with Python 2.5’s release is the ‘with’ statement and the context manager protocol behind it. I could make the argument that these two things alone make the upgrade to Python 2.5 more than compelling for those of you trapped in the dark ages of 2.4 or worse: 2.3!
                                </p>
                            </blockquote>
                            <p>
                                <em>This is a reprint of an article I wrote for <a href="http://www.pythonmagazine.com/">Python Magazine</a> as a Completely Different column that was published in the July 2008 issue. <b>I have republished this in its original form, bugs and all</b></em>
                            </p>
                            <h3>
                                Introduction
                            </h3>
                            <p>
                                In Python 2.5, a with_statement hook was added to the ”__future__” module . This was brought on by PEP (Python Enhancement Proposal) 343, “The with statement”. PEP 343, like many PEPs in Python, was a fusion of good ideas into a rather elegant solution. See <a href="http://www.python.org/dev/peps/">http://www.python.org/dev/peps/</a> for a complete listing of PEPs, including those referenced in this article.
                            </p>
                            <p>
                                Two of the influencing PEPs, 310 (Reliable Acquisition/Release Pairs) and 319 (Python Synchronize/Asynchronize Block) were primarily focused on a system to add a simple method of acquiring and then releasing a lock. PEP 310 proposed the ”with” statement (i.e., ”with lock:”) and PEP 319 proposed ‘’synchronized” and ”asynchronize” keywords that would allow you to define an function or method that would use the proposed keywords to access and modify shared objects, essentially hiding the common form of managing the lock directly:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
initialize_lock<span style="color:black">(</span><span style="color:black">)</span>
...
<span style="color:black">acquire_lock</span><span style="color:black">(</span><span style="color:black">)</span>
<span style="color:#ff7700;font-weight:bold">try</span>:
    change_shared_data<span style="color:black">(</span><span style="color:black">)</span>
<span style="color:#ff7700;font-weight:bold">finally</span>:
    release_lock<span style="color:black">(</span><span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                While both PEPs 310 and 319 were (are) good ideas, there were additional influences from other PEPs as well. PEP 340, “Anonymous Block Statements”, and PEP 346, “User Defined (’with’) Statements”, by Nick Coghlan were both important. In the end, what I think is an elegant and powerful middle ground was reached.
                            </p>
                            <p>
                                If you want a very detailed overview of all of the reasoning behind the introduction of the with statement, I recommend reading PEP 346 <a href="http://www.python.org/dev/peps/pep-0346/">http://www.python.org/dev/peps/pep-0346/</a>, where Nick Coghlan explains it in excellent detail with many examples.
                            </p>
                            <h3>
                                Context Managers
                            </h3>
                            <p>
                                The key thing to understand about ”with” and all of the work in the PEP is that under the covers, when you write:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">with</span> EXPRESSION <span style="color:black">[</span><span style="color:#ff7700;font-weight:bold">as</span> VARIABLE<span style="color:black">]</span>:
    BLOCK OF CODE
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                The EXPRESSION is expanded into two calls. The first call is to the ”__enter__()” method on the object. After the nested block completes, the object’s ”__exit__()” method is run. “as VARIABLE” is in brackets because it is an optional argument to the expression to store the return value of EXPRESSION to the BLOCK as VARIABLE name.
                            </p>
                            <p>
                                Take a look at Listing 1 for an example. In order to illustrate the methods and call order, I’ve created a simple class, Foo, that defines the required protocol methods. At the bottom of the listing. When an instance of Foo is used in the ”with Foo()” call, the output is simply:
                            </p>
                            <p>
                                <code><br>
                                I<br>
                                like<br>
                                turtles<br></code>
                            </p>
                            <p>
                                Listing 1:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
8
9
10
11
12
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">__future__</span> <span style="color:#ff7700;font-weight:bold">import</span> with_statement

<span style="color:#ff7700;font-weight:bold">class</span> Foo<span style="color:black">(</span><span style="color:#008000">object</span><span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">def</span> <span style="color:#0000cd">__init__</span><span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>:
        <span style="color:#ff7700;font-weight:bold">pass</span>
    <span style="color:#ff7700;font-weight:bold">def</span> __enter__<span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>:
        <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#483d8b">"I"</span>
    <span style="color:#ff7700;font-weight:bold">def</span> __exit__<span style="color:black">(</span><span style="color:#008000">self</span>, <span style="color:#008000">type</span>, value, <span style="color:#dc143c">traceback</span><span style="color:black">)</span>:
        <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#483d8b">"turtles"</span>

<span style="color:#ff7700;font-weight:bold">with</span> Foo<span style="color:black">(</span><span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#483d8b">"like"</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                As you can see, the ”__enter__()” method is called on the object, control is released and the “print turtles” code block is executed. Once the block is completed, the ”__exit__()” method is called.
                            </p>
                            <p>
                                Per the PEP, the ”__enter__()” method on the object accepts no arguments, but can perform actions (in this case, print) or return data. If an object has no data to return it should return self, although that is not required.
                            </p>
                            <p>
                                The ”__exit__()” method on the object has to accept three arguments: type, value, and traceback, these correspond to the arguments to the ”raise” statement. These arguments are passed in because the context manager handles all exceptions during ”__exit__()”. For example, if type is ”None” then that indicates that the nested block executed successfully, without error. Otherwise the ”__exit__()” method can properly handle the exception condition and clean up the resource.
                            </p>
                            <p>
                                For example, you might ask what happens to the ”__exit__()” method execution if an exception is raised when the code block is executing. Let’s examine this further by changing the bottom part of Listing 1 to be:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">with</span> Foo<span style="color:black">(</span><span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">raise</span> <span style="color:#008000">Exception</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                The output now looks like this:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
I
turtles
Traceback <span style="color:black">(</span>most recent call last<span style="color:black">)</span>:
  File <span style="color:#483d8b">"scratch.py"</span>, line <span style="color:#ff4500">12</span>, <span style="color:#ff7700;font-weight:bold">in</span> <span style="color:#66cc66">&lt;</span>module<span style="color:#66cc66">&gt;</span>
    <span style="color:#ff7700;font-weight:bold">raise</span> <span style="color:#008000">Exception</span>
<span style="color:#008000">Exception</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                If the code block being executed raises an exception, ”__exit__()” is still called on the Foo() object. This makes it darn handy for, say, cleaning up locks, database handles, sockets, unruly children, etc. Early I mentioned that objects that define the new protocol could also return ‘’self”, which would then be packed into the variable defined in the [as VARIABLE].
                            </p>
                            <p>
                                Listing 2 provides a class with an ”__enter__()” method that returns the instance of the object for access by the code block. In the example, the instance of the object is associated with the variable name “baz”. Take a look at the output:
                            </p>
                            <p>
                                <code><br>
                                setting count to 0<br>
                                &lt;__main__.Foo object at 0x73bb0&gt;<br>
                                count is now: 4<br></code>
                            </p>
                            <p>
                                Listing 2:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">__future__</span> <span style="color:#ff7700;font-weight:bold">import</span> with_statement

<span style="color:#ff7700;font-weight:bold">class</span> Foo<span style="color:black">(</span><span style="color:#008000">object</span><span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">def</span> <span style="color:#0000cd">__init__</span><span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>:
        <span style="color:#ff7700;font-weight:bold">pass</span>

    <span style="color:#ff7700;font-weight:bold">def</span> __enter__<span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>:
        <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#483d8b">"setting count to 0"</span>
        <span style="color:#008000">self</span>.<span style="color:black">count</span> = <span style="color:#ff4500">0</span>
        <span style="color:#ff7700;font-weight:bold">return</span> <span style="color:#008000">self</span>

    <span style="color:#ff7700;font-weight:bold">def</span> __exit__<span style="color:black">(</span><span style="color:#008000">self</span>, <span style="color:#008000">type</span>, value, <span style="color:#dc143c">traceback</span><span style="color:black">)</span>:
        <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#483d8b">"count is now: %d"</span> <span style="color:#66cc66">%</span> <span style="color:#008000">self</span>.<span style="color:black">count</span>

    <span style="color:#ff7700;font-weight:bold">def</span> incr<span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>:
        <span style="color:#008000">self</span>.<span style="color:black">count</span> += <span style="color:#ff4500">1</span>

<span style="color:#ff7700;font-weight:bold">with</span> Foo<span style="color:black">(</span><span style="color:black">)</span> <span style="color:#ff7700;font-weight:bold">as</span> baz:
    <span style="color:#ff7700;font-weight:bold">print</span> baz
    <span style="color:#ff7700;font-weight:bold">for</span> i <span style="color:#ff7700;font-weight:bold">in</span> <span style="color:#008000">range</span><span style="color:black">(</span><span style="color:#ff4500">4</span><span style="color:black">)</span>:
        baz.<span style="color:black">incr</span><span style="color:black">(</span><span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                As you can see, within the for-loop in the main block of code we were able to alter the state of the object we’re reliant on. We can access all of it’s internals, change state, call methods, etc. Again, this is especially handy if you want to create something that acts as some sort of handle.
                            </p>
                            <p>
                                Let’s look at two snippets, the old way of declaring a lock, then later acquiring it to modify state:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
8
9
10
11
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
lock = RLock<span style="color:black">(</span><span style="color:black">)</span>

<span style="color:#ff7700;font-weight:bold">class</span> thread_object<span style="color:black">(</span>Thread<span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">def</span> run<span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>:
        lock.<span style="color:black">acquire</span><span style="color:black">(</span><span style="color:black">)</span>
        <span style="color:#ff7700;font-weight:bold">try</span>:
            <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#008000">self</span>.<span style="color:black">getName</span><span style="color:black">(</span><span style="color:black">)</span>
        <span style="color:#ff7700;font-weight:bold">except</span>:
            <span style="color:#ff7700;font-weight:bold">raise</span> <span style="color:#008000">Exception</span><span style="color:black">(</span><span style="color:#483d8b">"Something is broken"</span><span style="color:black">)</span>
        <span style="color:#ff7700;font-weight:bold">finally</span>:
            lock.<span style="color:black">release</span><span style="color:black">(</span><span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                Now, let’s look at code refactored to use ”with”:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
lock = RLock<span style="color:black">(</span><span style="color:black">)</span>

<span style="color:#ff7700;font-weight:bold">class</span> thread_object<span style="color:black">(</span>Thread<span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">def</span> run<span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>:
        <span style="color:#ff7700;font-weight:bold">with</span> lock:
            <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#008000">self</span>.<span style="color:black">getName</span><span style="color:black">(</span><span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                This is possible because threading.RLock implements the new context manager protocol, go ahead, take a peek at threading.py yourself or look at the code below:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">class</span> _RLock<span style="color:black">(</span>_Verbose<span style="color:black">)</span>:
    __enter__ = acquire
    ...<span style="color:black">snip</span>...
    <span style="color:#ff7700;font-weight:bold">def</span> __exit__<span style="color:black">(</span><span style="color:#008000">self</span>, t, v, tb<span style="color:black">)</span>:
        <span style="color:#008000">self</span>.<span style="color:black">release</span><span style="color:black">(</span><span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                The lock management classes are not the only ones to implement the protocol. The io.py, tempfile.py, and other modules all implement the protocol to allow you do do something like the following:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">with</span> <span style="color:#008000">open</span><span style="color:black">(</span><span style="color:#483d8b">"hey"</span>, <span style="color:#483d8b">"r"</span><span style="color:black">)</span> <span style="color:#ff7700;font-weight:bold">as</span> mfile:
    mfile.<span style="color:black">readlines</span><span style="color:black">(</span><span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                This will automatically open, and close the file on the way in and way out. Magic! Obviously, the simple way of thinking of these is as resource managers. For example, what if you wanted to ensure a given state was set for a particular code block? PEP 346 points out an excellent example of disabling signals during the BLOCK execution. Take a look at Listing 3 where I have implemented that very code to simply catch and ignores SIGABRT signals.
                            </p>
                            <p>
                                When the script is run in one window, and in another we start running “kill -6 “, we see:
                            </p>
                            <pre>
Tis but a scratch!
Tis but a scratch!
I got an abort, but I like it here.
Tis but a scratch!
Tis but a scratch!
</pre>
                            <p>
                                Listing 3:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">__future__</span> <span style="color:#ff7700;font-weight:bold">import</span> with_statement
<span style="color:#ff7700;font-weight:bold">from</span> contextlib <span style="color:#ff7700;font-weight:bold">import</span> contextmanager
<span style="color:#ff7700;font-weight:bold">import</span> <span style="color:#dc143c">signal</span>

<span style="color:#ff7700;font-weight:bold">def</span> handler<span style="color:black">(</span>signum, frame<span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#483d8b">"I got an abort, but I like it here."</span>
    <span style="color:#ff7700;font-weight:bold">pass</span>

@contextmanager
<span style="color:#ff7700;font-weight:bold">def</span> no_sigabort<span style="color:black">(</span><span style="color:black">)</span>:
    <span style="color:#dc143c">signal</span>.<span style="color:#dc143c">signal</span><span style="color:black">(</span><span style="color:#dc143c">signal</span>.<span style="color:black">SIGABRT</span>, handler<span style="color:black">)</span>
    <span style="color:#ff7700;font-weight:bold">yield</span>
    <span style="color:#dc143c">signal</span>.<span style="color:#dc143c">signal</span><span style="color:black">(</span><span style="color:#dc143c">signal</span>.<span style="color:black">SIGABRT</span>, <span style="color:#dc143c">signal</span>.<span style="color:black">SIG_DFL</span><span style="color:black">)</span>

<span style="color:#ff7700;font-weight:bold">with</span> no_sigabort<span style="color:black">(</span><span style="color:black">)</span>:
    <span style="color:#808080;font-style:italic"># code executed without worrying about signals</span>
    <span style="color:#ff7700;font-weight:bold">while</span> <span style="color:#008000">True</span>:
        <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#483d8b">"Tis but a scratch!"</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                Instead of passing in the handler function on line 12 we could also pass in signal.SIG_IGN - which just makes the signal ignored. You can easily catch all sorts of state and react to it. Another one of the examples in PEP 346 is committing or rolling back database transactions:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">def</span> transaction<span style="color:black">(</span>db<span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">try</span>:
        <span style="color:#ff7700;font-weight:bold">yield</span>
    <span style="color:#ff7700;font-weight:bold">except</span>:
        db.<span style="color:black">rollback</span><span style="color:black">(</span><span style="color:black">)</span>
    <span style="color:#ff7700;font-weight:bold">else</span>:
        db.<span style="color:black">commit</span><span style="color:black">(</span><span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                Using this style, your code becomes a lot more succinct, clear, and you drastically reduce the amount of boilerplate you have to add to your application.
                            </p>
                            <h3>
                                Contextlib
                            </h3>
                            <p>
                                As part of Python 2.5 a new module ”contextlib” was introduced. This module is an excellent reference point of how to use context managers (it’s great example code!). It also provides some pretty cool tools. You’ve already seen me use contextlib.contextmanager to remove the need to define an object with ”__enter__()” and ”__exit__()” methods on the last example.
                            </p>
                            <p>
                                The contextlib.contextmanager decorator allows you to create nice user statements out of a simple function that yields at one point in the middle. This means you could do:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
@contextmanager
<span style="color:#ff7700;font-weight:bold">def</span> test_setup<span style="color:black">(</span><span style="color:black">)</span>:
    start database...
    <span style="color:black">inject</span> fake data...
    <span style="color:#ff7700;font-weight:bold">yield</span> <span style="color:black">(</span>to <span style="color:#dc143c">test</span><span style="color:black">)</span>
    confirm result...
    <span style="color:black">shut</span> database down...
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                Which allows you to:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">def</span> mytest<span style="color:black">(</span><span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">with</span> test_setup<span style="color:black">(</span><span style="color:black">)</span>:
        ... <span style="color:black">do</span> stuff ...
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                You can technically do anything else you want within that decorated function, and it can take as long as you want as long as:
                            </p>
                            <p>
                                - It yields once.<br>
                                - It does not yield again after an exception is raised.
                            </p>
                            <p>
                                The other nice thing is that you could change the test_setup example above to accept any number or type of arguments, so tests could pass identity and other information into the test_setup function.
                            </p>
                            <p>
                                Now let’s turn this up to 11. Up until now, I’ve shown you simple examples - basically, how to get/set some resource and then release it. But did you know you could nest them? Via the contextlib.nested function, you can define a series of nested contextmanagers and then bind each one to a different variable name.
                            </p>
                            <p>
                                Let’s try a simple nested context out for starters. In the first example in Listing 4, we want to move the data from file1 to file2. It’s easy to list the open file handles as arguments to ”nested()”, but what about mixing types? The second example in Listing 4 (lines 8-11) mixes file handles with thread locks.
                            </p>
                            <p>
                                Listing 4:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
8
9
10
11
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#808080;font-style:italic">#!/usr/bin/env python</span>
<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">__future__</span> <span style="color:#ff7700;font-weight:bold">import</span> with_statement
<span style="color:#ff7700;font-weight:bold">from</span> contextlib <span style="color:#ff7700;font-weight:bold">import</span> nested

<span style="color:#ff7700;font-weight:bold">with</span> nested<span style="color:black">(</span><span style="color:#008000">open</span><span style="color:black">(</span><span style="color:#483d8b">"file1"</span>, <span style="color:#483d8b">"r"</span><span style="color:black">)</span>, <span style="color:#008000">open</span><span style="color:black">(</span><span style="color:#483d8b">"file2"</span>, <span style="color:#483d8b">"w"</span><span style="color:black">)</span><span style="color:black">)</span> <span style="color:#ff7700;font-weight:bold">as</span> <span style="color:black">(</span>a, b<span style="color:black">)</span>:
    b.<span style="color:black">write</span><span style="color:black">(</span>a.<span style="color:black">read</span><span style="color:black">(</span><span style="color:black">)</span><span style="color:black">)</span>

<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">threading</span> <span style="color:#ff7700;font-weight:bold">import</span> RLock
lock = RLock<span style="color:black">(</span><span style="color:black">)</span>
<span style="color:#ff7700;font-weight:bold">with</span> nested<span style="color:black">(</span>lock, <span style="color:#008000">open</span><span style="color:black">(</span><span style="color:#483d8b">"file1"</span>, <span style="color:#483d8b">"r"</span><span style="color:black">)</span>, <span style="color:#008000">open</span><span style="color:black">(</span><span style="color:#483d8b">"file2"</span>, <span style="color:#483d8b">"w"</span><span style="color:black">)</span><span style="color:black">)</span> <span style="color:#ff7700;font-weight:bold">as</span> <span style="color:black">(</span>a, b, c<span style="color:black">)</span>:
    c.<span style="color:black">write</span><span style="color:black">(</span>b.<span style="color:black">read</span><span style="color:black">(</span><span style="color:black">)</span><span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                Yes, we have officially crossed into <em>maybe that’s too much</em> territory. But, you can see we can pass in any number of contextmanagers and all of them will be handled as needed. This is great if, like above, you need to acquire a lock and then perform an action which requires some cleanup.
                            </p>
                            <p>
                                Finally, we have contextlib.closing. This is, as the documentation states, “a context manager that closes <em>thing</em> upon completion of the block”. Anything with a ”close()” method is eligible to be used here. At last count on trunk, ”close()” occured at least 71 times in the Lib directory. You can use ”closing” on URLs from urllib, StringIO objects, as well as gzip objects.
                            </p>
                            <p>
                                For example, from the standard library documentation:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
8
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">__future__</span> <span style="color:#ff7700;font-weight:bold">import</span> with_statement
<span style="color:#ff7700;font-weight:bold">from</span> contextlib <span style="color:#ff7700;font-weight:bold">import</span> closing
<span style="color:#ff7700;font-weight:bold">import</span> <span style="color:#dc143c">urllib</span>

url = <span style="color:#483d8b">'http://www.python.org'</span>
<span style="color:#ff7700;font-weight:bold">with</span> closing<span style="color:black">(</span><span style="color:#dc143c">urllib</span>.<span style="color:black">urlopen</span><span style="color:black">(</span>url<span style="color:black">)</span><span style="color:black">)</span> <span style="color:#ff7700;font-weight:bold">as</span> page:
    <span style="color:#ff7700;font-weight:bold">for</span> line <span style="color:#ff7700;font-weight:bold">in</span> page:
        <span style="color:#ff7700;font-weight:bold">print</span> line
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                All three of these make it easy to factor-out code which we all end up repeating; that’s the nature of boilerplate. As we all know, less boilerplate and copy and pasted code means easier to read, and easier to manage.
                            </p>
                            <h3>
                                Let’s Go Off-Roading
                            </h3>
                            <p>
                                As I was writing this, I was trying to think of something really interesting to do with an object defining ”__enter__()” and ”__exit__()” methods that wasn’t just resource management. Then I realized, given I’m doing a lot of parallel stuff right now, I could create a threadpool that allowed jobs to be submitted to it, and the ”__exit__()” would call ”join()” on the threads and so on.
                            </p>
                            <p>
                                Fantastic idea! Within Listing 5, I have defined a basic thread object that subclasses threading.Thread. Then, in Listing 6 I define a ThreadPool, which is the context manager I will use.
                            </p>
                            <p>
                                Listing 5:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">__future__</span> <span style="color:#ff7700;font-weight:bold">import</span> with_statement
<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">threading</span> <span style="color:#ff7700;font-weight:bold">import</span> Thread
<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">Queue</span> <span style="color:#ff7700;font-weight:bold">import</span> Empty
<span style="color:#ff7700;font-weight:bold">from</span> Listing6 <span style="color:#ff7700;font-weight:bold">import</span> ThreadPool

<span style="color:#ff7700;font-weight:bold">class</span> myThread<span style="color:black">(</span>Thread<span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">def</span> <span style="color:#0000cd">__init__</span><span style="color:black">(</span><span style="color:#008000">self</span>, myq<span style="color:black">)</span>:
        Thread.<span style="color:#0000cd">__init__</span><span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>
        <span style="color:#008000">self</span>.<span style="color:black">myq</span> = myq
    <span style="color:#ff7700;font-weight:bold">def</span> run<span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>:
        <span style="color:#ff7700;font-weight:bold">while</span> <span style="color:#008000">True</span>:
            <span style="color:#ff7700;font-weight:bold">try</span>:
                job = <span style="color:#008000">self</span>.<span style="color:black">myq</span>.<span style="color:black">get</span><span style="color:black">(</span><span style="color:black">)</span>
                <span style="color:#ff7700;font-weight:bold">if</span> job == <span style="color:#483d8b">'STOP'</span>:
                    <span style="color:#ff7700;font-weight:bold">break</span>
                <span style="color:#ff7700;font-weight:bold">print</span> <span style="color:#008000">self</span>.<span style="color:black">getName</span><span style="color:black">(</span><span style="color:black">)</span>, job
            <span style="color:#ff7700;font-weight:bold">except</span> Empty:
                <span style="color:#ff7700;font-weight:bold">continue</span>

<span style="color:#ff7700;font-weight:bold">with</span> ThreadPool<span style="color:black">(</span><span style="color:#ff4500">10</span>, myThread<span style="color:black">)</span> <span style="color:#ff7700;font-weight:bold">as</span> pool:
    <span style="color:#ff7700;font-weight:bold">for</span> i <span style="color:#ff7700;font-weight:bold">in</span> <span style="color:#008000">range</span><span style="color:black">(</span><span style="color:#ff4500">100</span><span style="color:black">)</span>:
        pool.<span style="color:black">put</span><span style="color:black">(</span>i<span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                Listing 6:
                            </p>
                            <div>
                                <span><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" title="WP-CodeBox HowTo?"><span style="color:#99cc00">?</span></a></sup></span><span><a href="javascript:void(0);">View Code</a> PYTHON</span>
                            </div>
                            <div>
                                <table width="100%">
                                    <tr>
                                        <td>
                                            <pre>
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre>
                                        </td>
                                        <td>
                                            <pre style="font-family:monospace">
<span style="color:#ff7700;font-weight:bold">from</span> <span style="color:#dc143c">Queue</span> <span style="color:#ff7700;font-weight:bold">import</span> <span style="color:#dc143c">Queue</span>

<span style="color:#ff7700;font-weight:bold">class</span> ThreadPool<span style="color:black">(</span><span style="color:#008000">object</span><span style="color:black">)</span>:
    <span style="color:#ff7700;font-weight:bold">def</span> <span style="color:#0000cd">__init__</span><span style="color:black">(</span><span style="color:#008000">self</span>, workers, workerClass<span style="color:black">)</span>:
        <span style="color:#008000">self</span>.<span style="color:black">myq</span> = <span style="color:#dc143c">Queue</span><span style="color:black">(</span><span style="color:black">)</span>
        <span style="color:#008000">self</span>.<span style="color:black">workers</span> = workers
        <span style="color:#008000">self</span>.<span style="color:black">workerClass</span> = workerClass
        <span style="color:#008000">self</span>.<span style="color:black">pool</span> = <span style="color:black">[</span><span style="color:black">]</span>

    <span style="color:#ff7700;font-weight:bold">def</span> __enter__<span style="color:black">(</span><span style="color:#008000">self</span><span style="color:black">)</span>:
        <span style="color:#808080;font-style:italic"># On entering, start all the workers, who will block trying to</span>
        <span style="color:#808080;font-style:italic"># get work off the queue</span>
        <span style="color:#ff7700;font-weight:bold">for</span> i <span style="color:#ff7700;font-weight:bold">in</span> <span style="color:#008000">range</span><span style="color:black">(</span><span style="color:#008000">self</span>.<span style="color:black">workers</span><span style="color:black">)</span>:
            <span style="color:#008000">self</span>.<span style="color:black">pool</span>.<span style="color:black">append</span><span style="color:black">(</span><span style="color:#008000">self</span>.<span style="color:black">workerClass</span><span style="color:black">(</span><span style="color:#008000">self</span>.<span style="color:black">myq</span><span style="color:black">)</span><span style="color:black">)</span>
        <span style="color:#ff7700;font-weight:bold">for</span> i <span style="color:#ff7700;font-weight:bold">in</span> <span style="color:#008000">self</span>.<span style="color:black">pool</span>:
            i.<span style="color:black">start</span><span style="color:black">(</span><span style="color:black">)</span>
        <span style="color:#ff7700;font-weight:bold">return</span> <span style="color:#008000">self</span>.<span style="color:black">myq</span>

    <span style="color:#ff7700;font-weight:bold">def</span> __exit__<span style="color:black">(</span><span style="color:#008000">self</span>, <span style="color:#008000">type</span>, value, <span style="color:#dc143c">traceback</span><span style="color:black">)</span>:
        <span style="color:#808080;font-style:italic"># Now, shut down the pool once all work is done</span>
        <span style="color:#ff7700;font-weight:bold">for</span> i <span style="color:#ff7700;font-weight:bold">in</span> <span style="color:#008000">self</span>.<span style="color:black">pool</span>:
            <span style="color:#008000">self</span>.<span style="color:black">myq</span>.<span style="color:black">put</span><span style="color:black">(</span><span style="color:#483d8b">'STOP'</span><span style="color:black">)</span>
        <span style="color:#ff7700;font-weight:bold">for</span> i <span style="color:#ff7700;font-weight:bold">in</span> <span style="color:#008000">self</span>.<span style="color:black">pool</span>:
            i.<span style="color:black">join</span><span style="color:black">(</span><span style="color:black">)</span>
</pre>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <p>
                                Note that ThreadPool returns a value from __enter__(). After it builds up the worker-pool, instead of returning ‘’self” (which would be silly), it actually returns the queue built in the constructor. This makes it so that when we call it on line 20 in Listing 5, we get the reference to the queue we need.
                            </p>
                            <p>
                                Now, this is a nominal example. We’re not returning any results or anything, we’re just printing the numbers off of the queue as we get them. But it demonstrates the concept of creating an object that tracks some state, sets up a resource, and then ultimately manages that resource.
                            </p>
                            <p>
                                In Listing 6, I made sure we built the pool at ”__enter__()” time rather than in the constructor because what happens if we need to do more customization or hit an exception? If we do hit an exception, we will immediately jump out and the BLOCK we’re running will not be executed. In the ”__exit__()” method, I insert STOP tokens to tell the threads to exit their work loop.
                            </p>
                            <p>
                                If you wanted, you could use this code inside of your own application (once you make it so it returns data to the caller) to spawn worker pools on-demand, do some processing, and then cleanly shut them down with a minimal amount of boilerplate involved.
                            </p>
                            <p>
                                The nice thing about this is that all of the responsibility for management is done in the object that does all of the work itself. There is no more needing to remember to shut down the worker pool, release the database connection, or close that socket.
                            </p>
                            <h3>
                                Conclusion
                            </h3>
                            <p>
                                I hope I’ve shown you a compelling new feature within Python that you might not have known about. Python is evolving rapidly every day. We don’t just have things like context managers and Python 3000 to look forward to. We have a wealth of improvements going into core every single day.
                            </p>
                            <p>
                                I think people are going to really love context managers for their elegance, once they become mainstream to the language (in 2.6). Centralizing the control and management of state, resources and other-like things while reducing the total lines of code you have to debug, manage and read is a good thing.
                            </p>
                            <p>
                                Well, as long as the end result is still readable.
                            </p>
                            <p>
                                Related Links:
                            </p>
                            <ul>
                                <li>PEP 0343 - <a href="http://www.python.org/dev/peps/pep-0343/">http://www.python.org/dev/peps/pep-0343/</a>
                                </li>
                                <li>PEP 0346 - <a href="http://www.python.org/dev/peps/pep-0346/">http://www.python.org/dev/peps/pep-0346/</a>
                                </li>
                                <li>PEP 0319 - <a href="http://www.python.org/dev/peps/pep-0319/">http://www.python.org/dev/peps/pep-0319/</a>
                                </li>
                                <li>PEP 0310 - <a href="http://www.python.org/dev/peps/pep-0310/">http://www.python.org/dev/peps/pep-0310/</a>
                                </li>
                                <li>PEP 0340 - <a href="http://www.python.org/dev/peps/pep-0340/">http://www.python.org/dev/peps/pep-0340/</a>
                                </li>
                                <li>Python Wiki discussion - <a href="http://wiki.python.org/moin/WithStatement">http://wiki.python.org/moin/WithStatement</a>
                                </li>
                                <li>Understanding Python’s “with” statement, by Fredrik Lundh - <a href="http://effbot.org/zone/python-with-statement.htm">http://effbot.org/zone/python-with-statement.htm</a>
                                </li>
                                <li>Python Module of the Week: contextlib, by Doug Hellmann - <a href="http://blog.doughellmann.com/2008/05/pymotw-contextlib.html">http://blog.doughellmann.com/2008/05/pymotw-contextlib.html</a>
                                </li>
                            </ul>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://jessenoller.com/2009/02/03/get-with-the-program-as-contextmanager-completely-different/?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+Jessenollercom+%28jessenoller.com%29">http://jessenoller.com/2009/02/03/get-with-the-program-as-contextmanager-completely-different/?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+Jessenollercom+%28jessenoller.com%29</a>
                    </p>
                </div>
            </article>

            <nav id="post-nav">


            </nav>

            <script id="discus-javascript">
                var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script>

            <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>

        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a>
                This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer>

        <script async src="/static/js/common.js"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js" integrity="sha256-hj+5FRlAuvAFANiefn0PpJYCkV1X4QT9EgiPd+6QnCw=" crossorigin="anonymous"></script>
    </body>
</html>
