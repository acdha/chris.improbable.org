<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Cost of Testing</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all">
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->

        <meta http-equiv="last-modified" content="Fri, 02 Oct 2009 16:11:50 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-2097834-1', 'auto');
            ga('send', 'pageview');
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1><a href="/about/">Chris Adams</a></h1>
                <h2>Programmer, cyclist, photographer</h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="https://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="https://pinboard.in/u:acdha/" rel="me">Pinboard</a>
                </li>
                <li>
                    <a href="https://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2009-10-02T12:07:00-04:00">
                    <meta itemprop="dateModified" content="2009-10-02T12:07:00-04:00">
                    <time class="date" itemprop="datePublished" datetime="2009-10-02T16:07:00+00:00">Oct 02</time>
                    <h2 class="" itemprop="title">Cost of Testing</h2>
                </header>

                <div class="body" itemprop="articleBody"><div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/68e8a3efde445275">
                        <blockquote>
                            By <a href="http://misko.hevery.com/">Mi≈°ko Hevery</a><br>
                            <br>
                            A lot of people have been asking me lately, what is the cost of testing, so I decided, that I will try to measure it, to dispel the myth that testing takes twice as long.<br>
                            <br>
                            For the last two weeks I have been keeping track of the amount of time I spent writing tests versus the time writing production code. The number surprised even me, but after I thought about it, it makes a lot of sense. The magic number is about 10% of time spent on writing tests. Now before, you think I am nuts, let me back it up with some real numbers from a personal project I have been working on.<br>
                            <br>
                            <table border="0">
                                <tbody>
                                    <tr>
                                        <th></th>
                                        <th>
                                            Total
                                        </th>
                                        <th>
                                            Production
                                        </th>
                                        <th>
                                            Test
                                        </th>
                                        <th>
                                            Ratio
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>
                                            Commits
                                        </th>
                                        <td>
                                            1,347
                                        </td>
                                        <td>
                                            1,347
                                        </td>
                                        <td>
                                            1,347
                                        </td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th>
                                            LOC
                                        </th>
                                        <td>
                                            14,709
                                        </td>
                                        <td>
                                            8,711
                                        </td>
                                        <td>
                                            5,988
                                        </td>
                                        <td>
                                            40.78%
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            JavaScript LOC
                                        </th>
                                        <td>
                                            10,077
                                        </td>
                                        <td>
                                            6,819
                                        </td>
                                        <td>
                                            3,258
                                        </td>
                                        <td>
                                            32.33%
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            Ruby LOC
                                        </th>
                                        <td>
                                            4,632
                                        </td>
                                        <td>
                                            1,892
                                        </td>
                                        <td>
                                            2,740
                                        </td>
                                        <td>
                                            59.15%
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            Lines/Commit
                                        </th>
                                        <td>
                                            10.92
                                        </td>
                                        <td>
                                            6.47
                                        </td>
                                        <td>
                                            4.45
                                        </td>
                                        <td>
                                            40.78%
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            Hours(estimate)
                                        </th>
                                        <td>
                                            1,200
                                        </td>
                                        <td>
                                            1,080
                                        </td>
                                        <td>
                                            120
                                        </td>
                                        <td>
                                            10.00%
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>
                                            Hours/Commit
                                        </th>
                                        <td>
                                            0.89
                                        </td>
                                        <td>
                                            0.80
                                        </td>
                                        <td>
                                            0.09
                                        </td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th>
                                            Mins/Commit
                                        </th>
                                        <td>
                                            53
                                        </td>
                                        <td>
                                            48
                                        </td>
                                        <td>
                                            5
                                        </td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table><br>
                            Commits refers to the number of commits I have made to the repository. LOC is lines of code which is broken down by language. The ratio shows the typical breakdown between the production and test code when you test drive and it is about half, give or take a language. It is interesting to note that on average I commit about 11 lines out of which 6.5 are production and 4.5 are test. Now, keep in mind this is average, a lot of commits are large where you add a lot of code, but then there are a lot of commits where you are tweaking stuff, so the average is quite low.<br>
                            <br>
                            The number of hours spent on the project is my best estimate, as I have not kept track of these numbers. Also, the 10% breakdown comes from keeping track of my coding habits for the last two weeks of coding. But, these are my best guesses.<br>
                            <br>
                            Now when I test drive, I start with writing a test which usually takes me few minutes (about 5 minutes) to write. The test represents my scenario. I then start implementing the code to make the scenario pass, and the implementation usually takes me a lot longer (about 50 minutes). The ratio is highly asymmetrical! Why does it take me so much less time to write the scenario than it does to write the implementation given that they are about the same length? Well look at a typical test and implementation:<br>
                            <br>
                            Here is a typical test for a feature:<br>
                            <pre>
ArrayTest.prototype.testFilter = function() {<br> var items = ["MIsKO", {name:"john"}, ["mary"], 1234];<br> assertEquals(4, items.filter("").length);<br> assertEquals(4, items.filter(undefined).length);<br><br> assertEquals(1, items.filter('iSk').length);<br> assertEquals("MIsKO", items.filter('isk')[0]);<br><br> assertEquals(1, items.filter('ohn').length);<br> assertEquals(items[1], items.filter('ohn')[0]);<br><br> assertEquals(1, items.filter('ar').length);<br> assertEquals(items[2], items.filter('ar')[0]);<br><br> assertEquals(1, items.filter('34').length);<br> assertEquals(1234, items.filter('34')[0]);<br><br> assertEquals(0, items.filter("I don't exist").length);<br>};<br><br>ArrayTest.prototype.testShouldNotFilterOnSystemData = function() {<br> assertEquals("", "".charAt(0)); // assumption<br> var items = [{$name:"misko"}];<br> assertEquals(0, items.filter("misko").length);<br>};<br><br>ArrayTest.prototype.testFilterOnSpecificProperty = function() {<br> var items = [{ignore:"a", name:"a"}, {ignore:"a", name:"abc"}];<br> assertEquals(2, items.filter({}).length);<br><br> assertEquals(2, items.filter({name:'a'}).length);<br><br> assertEquals(1, items.filter({name:'b'}).length);<br> assertEquals("abc", items.filter({name:'b'})[0].name);<br>};<br><br>ArrayTest.prototype.testFilterOnFunction = function() {<br> var items = [{name:"a"}, {name:"abc", done:true}];<br> assertEquals(1, items.filter(function(i){return i.done;}).length);<br>};<br><br>ArrayTest.prototype.testFilterIsAndFunction = function() {<br> var items = [{first:"misko", last:"hevery"},<br>              {first:"mike", last:"smith"}];<br><br> assertEquals(2, items.filter({first:'', last:''}).length);<br> assertEquals(1, items.filter({first:'', last:'hevery'}).length);<br> assertEquals(0, items.filter({first:'mike', last:'hevery'}).length);<br> assertEquals(1, items.filter({first:'misko', last:'hevery'}).length);<br> assertEquals(items[0], items.filter({first:'misko', last:'hevery'})[0]);<br>};<br><br>ArrayTest.prototype.testFilterNot = function() {<br> var items = ["misko", "mike"];<br><br> assertEquals(1, items.filter('!isk').length);<br> assertEquals(items[1], items.filter('!isk')[0]);<br>};
</pre><br>
                            Now here is code which implements this scenario tests above:<br>
                            <pre>
Array.prototype.filter = function(expression) {<br> var predicates = [];<br> predicates.check = function(value) {<br>   for (var j = 0; j &lt; predicates.length; j++) {<br>      if(!predicates[j](value)) {<br>        return false;<br>      }<br>    }<br>    return true;<br>  };<br>  var getter = Scope.getter;<br>  var search = function(obj, text){<br>    if (text.charAt(0) === '!') {<br>      return !search(obj, text.substr(1));<br>    }<br>    switch (typeof obj) {<br>    case "bolean":<br>    case "number":<br>    case "string":<br>      return ('' + obj).toLowerCase().indexOf(text) &gt; -1;<br>   case "object":<br>     for ( var objKey in obj) {<br>       if (objKey.charAt(0) !== '$' &amp;&amp; search(obj[objKey], text)) {<br>         return true;<br>       }<br>     }<br>     return false;<br>   case "array":<br>     for ( var i = 0; i &lt; obj.length; i++) {<br>       if (search(obj[i], text)) {<br>         return true;<br>       }<br>     }<br>     return false;<br>   default:<br>     return false;<br>   }<br> };<br> switch (typeof expression) {<br>   case "bolean":<br>   case "number":<br>   case "string":<br>     expression = {$:expression};<br>   case "object":<br>     for (var key in expression) {<br>       if (key == '$') {<br>         (function(){<br>           var text = (''+expression[key]).toLowerCase();<br>           if (!text) return;<br>           predicates.push(function(value) {<br>             return search(value, text);<br>           });<br>         })();<br>       } else {<br>         (function(){<br>           var path = key;<br>           var text = (''+expression[key]).toLowerCase();<br>           if (!text) return;<br>           predicates.push(function(value) {<br>             return search(getter(value, path), text);<br>           });<br>         })();<br>       }<br>     }<br>     break;<br>   case "function":<br>     predicates.push(expression);<br>     break;<br>   default:<br>     return this;<br> }<br> var filtered = [];<br> for ( var j = 0; j &lt; this.length; j++) {<br>   var value = this[j];<br>   if (predicates.check(value)) {<br>     filtered.push(value);<br>   }<br> }<br> return filtered;<br>};
</pre><br>
                            Now, I think that if you look at these two chunks of code, it is easy to see that even though they are about the same length, one is much harder to write. The reason, why tests take so little time to write is that they are linear in nature. No loops, ifs or interdependencies with other tests. Production code is a different story, I have to create complex ifs, loops and have to make sure that the implementation works not just for one test, but all test. This is why it takes you so much longer to write production than test code. In this particular case, I remember rewriting this function three times, before I got it to work as expected. :-)<br>
                            <br>
                            So a naive answer is that writing test carries a 10% tax. But, we pay taxes in order to get something in return. Here is what I get for 10% which pays me back:<br>
                            <ul>
                                <li style="list-style: none">
                                    <br>
                                </li>
                                <li>When I implement a feature I don't have to start up the whole application and click several pages until I get to page to verify that a feature works. In this case it means that I don't have to refreshing the browser, waiting for it to load a dataset and then typing some test data and manually asserting that I got what I expected. This is immediate payback in time saved!
                                </li>
                                <li style="list-style: none">
                                    <br>
                                </li>
                                <li>Regression is almost nil. Whenever you are adding new feature you are running the risk of breaking something other then what you are working on immediately (since you are not working on it you are not actively testing it). At least once a day I have a what the @#$% moment when a change suddenly breaks a test at the opposite end of the codebase which I did not expect, and I count my lucky stars. This is worth a lot of time spent when you discover that a feature you thought was working no longer is, and by this time you have forgotten how the feature is implemented.
                                </li>
                                <li style="list-style: none">
                                    <br>
                                </li>
                                <li>Cognitive load is greatly reduced since I don't have to keep all of the assumptions about the software in my head, this makes it really easy to switch tasks or to come back to a task after a meeting, good night sleep or a weekend.
                                </li>
                                <li style="list-style: none">
                                    <br>
                                </li>
                                <li>I can refactor the code at will, keeping it from becoming stagnant, and hard to understand. This is a huge problem on large projects, where the code works, but it is really ugly and everyone is afraid to touch it. This is worth money tomorrow to keep you going.
                                </li>
                                <li style="list-style: none">
                                    <br>
                                </li>
                            </ul><br>
                            These benefits translate to real value today as well as tomorrow. I write tests, because the additional benefits I get more than offset the additional cost of 10%. Even if I don't include the long term benefits, the value I get from test today are well worth it. I am faster in developing code with test. How much, well that depends on the complexity of the code. The more complex the thing you are trying to build is (more ifs/loops/dependencies) the greater the benefit of tests are.<br>
                            <br>
                            So now you understand my puzzled look when people ask me how much slower/costlier the development with tests is.
                            <div>
                                <img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/15045980-1974718471053623145?l=googletesting.blogspot.com" alt="">
                            </div>
                            <div>
                                <a href="http://feeds.feedburner.com/~ff/blogspot/RLXA?a=MEsMrMwVaTY:YWTvxTXgjCA:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/blogspot/RLXA?d=yIl2AUoC8zA" border="0"></a> <a href="http://feeds.feedburner.com/~ff/blogspot/RLXA?a=MEsMrMwVaTY:YWTvxTXgjCA:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/blogspot/RLXA?i=MEsMrMwVaTY:YWTvxTXgjCA:V_sGLiPBpWU" border="0"></a>
                            </div>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://googletesting.blogspot.com/2009/10/cost-of-testing.html?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+blogspot%2FRLXA+%28Google+Testing+Blog%29">http://googletesting.blogspot.com/2009/10/cost-of-testing.html?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+blogspot%2FRLXA+%28Google+Testing+Blog%29</a>
                    </p>
                </div>
            </article>

            <nav id="post-nav">


            </nav>

            <script id="discus-javascript">
                var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script>

            <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>

        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a>
                This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer>

        <script async src="/static/js/common.js"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js" integrity="sha256-hj+5FRlAuvAFANiefn0PpJYCkV1X4QT9EgiPd+6QnCw=" crossorigin="anonymous"></script>
    </body>
</html>
