<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>
            The HTML5 drag and drop disaster
        </title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all"><!--[if lte IE 8]>
            <link rel="stylesheet" href="/static/css/ie-fixes.css" type="text/css" media="all">
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->
        <meta http-equiv="last-modified" content="Mon, 21 Sep 2009 11:14:17 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
        <script type="application/javascript">
var _prum={id:"5166be01e6e53d1007000001"};var PRUM_EPISODES=PRUM_EPISODES||{};PRUM_EPISODES.q=[];PRUM_EPISODES.mark=function(b,a){PRUM_EPISODES.q.push(["mark",b,a||new Date().getTime()])};PRUM_EPISODES.measure=function(b,a,b){PRUM_EPISODES.q.push(["measure",b,a,b||new Date().getTime()])};PRUM_EPISODES.done=function(a){PRUM_EPISODES.q.push(["done",a])};PRUM_EPISODES.mark("firstbyte");(function(){var b=document.getElementsByTagName("script")[0];var a=document.createElement("script");a.type="text/javascript";a.async=true;a.charset="UTF-8";a.src="//rum-static.pingdom.net/prum.min.js";b.parentNode.insertBefore(a,b)})();
        </script>
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1>
                    <a href="/about/">Chris Adams</a>
                </h1>
                <h2>
                    Programmer, cyclist, photographer
                </h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="http://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="http://delicious.com/acdha" rel="me">del.icio.us</a>
                </li>
                <li>
                    <a href="http://twitter.com/acdha" rel="me">Twitter</a>
                </li>
                <li>
                    <a href="https://plus.google.com/116562742092842686896?rel=author" rel="me">Google+</a>
                </li>
                <li>
                    <a href="http://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="http://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
                <li>
                    <a href="http://connect.garmin.com/explore?owner=acdha" rel="me">Garmin Connect</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2009-09-21T07:09:36-04:00">
                    <meta itemprop="dateModified" content="2009-09-21T07:09:36-04:00"><time class="date" itemprop="datePublished" datetime="2009-09-21T11:09:36+00:00">Sep 21</time>
                    <h2 itemprop="title">
                        The HTML5 drag and drop disaster
                    </h2>
                </header>
                <div class="body" itemprop="articleBody">
                    <div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/8029b8d167b75c22">
                        <blockquote>
                            <p>
                                After spending about a day and a half in testing I am forced to conclude that the <a href="http://dev.w3.org/html5/spec/editing.html#dnd">HTML5 drag and drop module</a> is not just a disaster, it’s a <em>fucking</em> disaster.
                            </p>
                            <p>
                                The module should be removed from the HTML5 specification straight away, and conforming browsers should disable it at their earliest opportunity pending a complete rewrite from the ground up.
                            </p>
                            <p>
                                Web developers MUST NOT (in the sense of RFC 2119) use HTML 5 drag and drop. They should use <a href="http://www.quirksmode.org/js/dragdrop.html">old-school scripts</a> instead.
                            </p>
                            <p>
                                Before we continue I’d like to say that in general I thoroughly approve of the HTML5 specification. Exactly <em>because</em> the spec has such an overall quality I was so surprised (and, frankly, a bit confused and hurt) to find drag and drop a steaming pile of bovine manure.
                            </p>
                            <p>
                                In fact, it’s so outrageously bad that I’ve gone on strike. I refuse to do any more research on drag and drop. Go do it yourself. Or don’t bother. Whatever. I don’t care.
                            </p>
                            <p>
                                What follows is a rant laced with profanity. No apologies. Drag and drop deserves no better.
                            </p>
                            <h3>
                                Who got us into this mess?
                            </h3>
                            <p>
                                Microsoft “designed” and implemented drag and drop way back in 1999, when IE 5.0 was released. IE versions has supported it ever since.
                            </p>
                            <p>
                                This specification was terribly bad, as we’ll see in a moment. Microsoft dropped the ball <em>majorly</em> here.
                            </p>
                            <p>
                                Still, while Microsoft is to blame initially, the HTML5 WG and the other browser vendors are accessories to the crime.
                            </p>
                            <p>
                                One of the guiding principles of HTML5 and its WHAT-WG precursors is to document everything that already works in browsers but previous Working Groups couldn’t be arsed to specify, such as <code>innerHTML</code> and <code>offsetWidth</code>.
                            </p>
                            <p>
                                Although I thoroughly support that principle and see how it applies to the Microsoft drag and drop module, I still think that some form of critical reflection might have been in order in this particular case.
                            </p>
                            <p>
                                <a href="http://twitter.com/Hixie/status/4075253361">Hixie said</a>:
                            </p>
                            <blockquote>
                                <p>
                                    The drag-and-drop API is horrible, but it has one thing going for it: IE6 implements it, as do Safari and Firefox.
                                </p>
                            </blockquote>
                            <p>
                                Now that is undeniably true. God knows why, but Firefox, Safari, and Chrome have shoveled it straight into their rendering engines, and critical reflection be damned. Only Opera has retained its sanity.
                            </p>
                            <p>
                                Interoperability is very important. But not at any price. The price is too high when it comes to drag and drop.
                            </p>
                            <h3>
                                The transcript of my testing sessions
                            </h3>
                            <p>
                                OK, so what exactly is wrong with the HTML5 drag and drop module?
                            </p>
                            <p>
                                I’ll show you.
                            </p>
                            <p>
                                Below follows an approximate transcript of my testing sessions. It shows you what I went through and why I wrote this entry.
                            </p>
                            <p>
                                This was an exceptionally bad case. The worst I’ve encountered since the demise of Netscape 4, in fact. That’s why the transcript includes profanity. Lots and lots of profanity.
                            </p>
                            <h4>
                                Too many events
                            </h4>
                            <p>
                                There are no less than seven events associated with drag and drop: dragstart, drag, dragover, dragenter, dragleave, drop, and dragend.
                            </p>
                            <p>
                                This seems rather a lot for a series of actions that can be accurately described by the mousedown, mousemove, and mouseup events.
                            </p>
                            <p>
                                In itself that’s not a disaster, just bad API design. We have to pick a few events and ignore the rest.
                            </p>
                            <p>
                                [ ... tinker ... ]
                            </p>
                            <p>
                                [ ... tinker ... ]
                            </p>
                            <h4>
                                Say. Fucking. WHAT?!?
                            </h4>
                            <p>
                                The drop event fires when the user drops an element he’s dragging.
                            </p>
                            <p>
                                And, you see, dropping the element you’re dragging is the POINT of this entire module.
                            </p>
                            <p>
                                So drop is the most important event. But it doesn’t fire. Let’s see ...
                            </p>
                            <p>
                                [ ... tinker ... ]
                            </p>
                            <p>
                                [ ... consult spec and example ... ]
                            </p>
                            <p>
                                OK, got it.
                            </p>
                            <p>
                                For the drop event to fire at all, you have to cancel the defaults of both the dragover and the dragenter event.
                            </p>
                            <p>
                                [ ... ]
                            </p>
                            <p>
                                ... say WHAT?!?
                            </p>
                            <p>
                                OK, let’s try again:
                            </p>
                            <p>
                                The default action of the dragover and the dragenter events is <em>NOT</em> being able to drop an element. And you have to cancel these default actions in order to drop an element. Obviously.
                            </p>
                            <p>
                                [ ... ]
                            </p>
                            <p>
                                Say. Fucking. WHAT?!?
                            </p>
                            <p>
                                OK, one more time:
                            </p>
                            <p>
                                <a href="http://dev.w3.org/html5/spec/editing.html#events-fired-during-a-drag-and-drop-action">The dragover and dragenter events exist</a> for the sole reason of forcing web developers who want to perform a drop action to cancel their obscure default actions.
                            </p>
                            <p>
                                You’re kidding me.
                            </p>
                            <p>
                                [ ... crickets ... ]
                            </p>
                            <p>
                                You’ve GOT to be FUCKING kidding me!
                            </p>
                            <p>
                                I’m not going to cancel the default actions of not one but <em>two</em> of your <em>bullshit</em> events in order to get the most important action in the <em>entire fucking module</em> working.
                            </p>
                            <p>
                                Then we won’t play. Nyaa, nyaa...
                            </p>
                            <p>
                                You bunch of fucking idiots don’t have the <em>fuckingest</em> clue what you’re doing!
                            </p>
                            <p>
                                [ ... crickets ... ]
                            </p>
                            <p>
                                Now listen carefully, and you might actually learn something:
                            </p>
                            <p>
                                Default actions are supposed to be defined in positive terms: if you take <em>this</em> action, <em>that</em> will happen, unless the script cancels it. That’s how JavaScript events were designed to work.
                            </p>
                            <p>
                                [ ... crickets ... ]
                            </p>
                            <p>
                                No wonder I can’t give up smoking.
                            </p>
                            <p>
                                [ ... drag ... ]
                            </p>
                            <p>
                                Calm down, calm down. Let it be. Maybe it’ll go away by itself.
                            </p>
                            <p>
                                Do something else first.
                            </p>
                            <h4>
                                Return to normalcy
                            </h4>
                            <p>
                                When I defined a dragstart event handler, the other events just stopped firing in IE. All of them.
                            </p>
                            <p>
                                When I studied <a href="http://html5demos.com/drag">Remy Sharp’s test case</a>, however, I found it works in IE8 despite the presence of the dragstart event.
                            </p>
                            <p>
                                This is a strange inconsistency, especially since the spec is supposed to be <em>based</em> on the IE implementation. So either the spec has overlooked a special case in which all the other events are canceled, or IE sometimes doesn’t implement its own implementation.
                            </p>
                            <p>
                                I’m guessing the latter right now. Browser bug #1. To be retested, ascertained, and documented.
                            </p>
                            <p>
                                Phew, finally something <em>normal</em>.
                            </p>
                            <p>
                                Maybe the ... other thing ... will turn out not so bad, after all.
                            </p>
                            <p>
                                But first some more events.
                            </p>
                            <h4>
                                dragthis
                            </h4>
                            <p>
                                The drag event is like mousemove, except that it fires during a drag operation. Hey, this makes sense! Works everywhere? Yup. Next.
                            </p>
                            <h4>
                                dragthat and dragsomethingelse
                            </h4>
                            <p>
                                In theory dragenter and dragleave could be great events, since they fire when you enter or leave an HTML element in the middle of a drag operation. If that element is a valid drop target you could change its styles ondragenter and ondragleave to indicate this fact to the user.
                            </p>
                            <p>
                                With the spec being based on the Microsoft API, I expected dragenter and dragleave to emulate mouseenter and mouseleave. But they didn’t. Not even in IE. They’re based on mouseover and mouseout and suck every bit as badly. And their names are wrong.
                            </p>
                            <p>
                                Mouseover and mouseout are terrible because they bubble up all the time and make it very hard to distinguish important events from unimportant ones. If I mouse over (or drag enter) a child element of the one that the event is set on, it also fires. And that’s exactly what we <em>don’t</em> want. The events will fire incessantly the whole time the mouse is above the element, and we have to work hard in order to distinguish useful events from useless ones.
                            </p>
                            <p>
                                <a href="http://www.quirksmode.org/dom/events/mouseover.html">Mouseenter and mouseleave</a>, on the other hand, fire only when you enter and leave the element they’re defined on, and they don’t bubble. That makes them much easier to use.
                            </p>
                            <p>
                                They are Microsoft extensions, by the way, and excellent ones at that. They work only in IE.
                            </p>
                            <p>
                                Note that originally mouseenter and mouseleave had <em>exactly the same</em> IE only compatibility pattern as drag and drop. Mouseenter and mouseleave are a good idea, drag and drop ... isn’t. Guess what the other browsers chose to implement?
                            </p>
                            <p>
                                No wonder web development is such a fucking pain with fucking morons in charge of the browsers.
                            </p>
                            <p>
                                Wait, that could be construed as an insult to morons.
                            </p>
                            <p>
                                Ah, what the fuck.
                            </p>
                            <h4>
                                dragbullshit
                            </h4>
                            <p>
                                Dragover, now, has nothing to do with mouseover. It’s exactly the same as the drag event, except that you can set it on any element instead of just the document. Or something. Whatever.
                            </p>
                            <p>
                                Why do we need the dragover event if we already have the drag event?
                            </p>
                            <p>
                                [ ... fume ... ]
                            </p>
                            <p>
                                To cancel its default action!
                            </p>
                            <p>
                                If we didn’t have to cancel its default action the dragbullshit event would <em>have no fucking point!</em>
                            </p>
                            <p>
                                And we can’t have pointless events in our nice specification, now, can we?
                            </p>
                            <p>
                                So we give it a default action. A <em>very complicated</em> default action.
                            </p>
                            <p>
                                That has to be canceled. Absolutely, <em>positively</em> has to be canceled.
                            </p>
                            <p>
                                [ ... crickets ... ]
                            </p>
                            <p>
                                Anybody LISTENING to what I say?
                            </p>
                            <p>
                                [ ... drag ... ]
                            </p>
                            <p>
                                I deserve a fucking MEDAL for this. Above and beyond the call of fucking DUTY.
                            </p>
                            <h4>
                                draggable
                            </h4>
                            <p>
                                Then we have the <code>draggable</code> attribute that, when set to <code>true</code>, allows an element to be dragged. It only works in Firefox. Links and images are draggable by default.
                            </p>
                            <p>
                                Actually that’s a pretty good idea.
                            </p>
                            <p>
                                Wow, I can finally say something nice. But to whom?
                            </p>
                            <p>
                                I’m <em>assuming</em> that <code>draggable</code> is an HTML5 addition because it doesn’t work in IE, and therefore I’m <em>assuming</em> I can congratulate the HTML5 WG with having had a good idea.
                            </p>
                            <p>
                                You see, I can’t find the Microsoft documentation on drag and drop, so I can’t check whether <code>draggable</code> is supposed to be supported in IE.
                            </p>
                            <p>
                                In practice it isn’t, that’s for sure.
                            </p>
                            <p>
                                (If you know where to find the Microsoft documentation, don’t bother leaving a comment. Meanwhile I don’t care any more.)
                            </p>
                            <h4>
                                Safari fuckup
                            </h4>
                            <p>
                                Next problem.
                            </p>
                            <p>
                                In order to get drag and drop working in Safari, add this <em>to your CSS!</em>
                            </p>
                            <pre>
#tobedragged {
        -khtml-user-drag: element;
}
</pre>
                            <p>
                                [ ... ]
                            </p>
                            <p>
                                <strong>Q</strong>: Hi, how do you want me to present this element to the user?<br>
                                <strong>A</strong>: It’s draggable.
                            </p>
                            <p>
                                [ ... ]
                            </p>
                            <p>
                                Fuck you, Safari team. Fuck. You.
                            </p>
                            <p>
                                Wait, let’s rephrase that. A gentle question might help more than a rant.
                            </p>
                            <p>
                                Dear Safari team, does “separation of presentation and behaviour” mean anything to you?
                            </p>
                            <p>
                                [ ... crickets ... ]
                            </p>
                            <p>
                                Thought not.
                            </p>
                            <p>
                                [ ... drag ... ]
                            </p>
                            <p>
                                Fuck you anyway.
                            </p>
                            <h4>
                                Drop effects? Or drag effects?
                            </h4>
                            <p>
                                The <a href="http://dev.w3.org/html5/spec/editing.html#dom-datatransfer-dropeffect"><code>dropEffect</code> property</a> might actually set the <em>drag</em> effect. At least, that’s how I read the spec right now.
                            </p>
                            <p>
                                I could be wrong here. I have no fucking clue what a drag (or drop) effect is, and you don’t, either.
                            </p>
                            <p>
                                As an experiment I set the property to every single value the spec allows, and it made no difference whatsoever in any browser.
                            </p>
                            <p>
                                Then I discovered I had to set <code>effectsAllowed</code> to <code>all</code> in order to decree that all drop effects (which really may be drag effects) are allowed. This made no difference, either — no browser reacted to my setting of <code>dropEffect</code> by showing any of the now-allowed drag (or drop?) effects.
                            </p>
                            <p>
                                Some browsers report the value of <code>effectsAllowed</code> as <code>copyLink</code>, by the way. Just after I set it to <code>all</code> . A little creativity to show their good spirits, I presume.
                            </p>
                            <p>
                                And why would I need to give permission at all? Setting <code>dropEffect</code> to the desired value indicates that I command (and, by implication, permit) the effect to take place.
                            </p>
                            <p>
                                Doesn’t it?
                            </p>
                            <p>
                                [ ... crickets ... ]
                            </p>
                            <p>
                                [ ... crickets ... ]
                            </p>
                            <p>
                                Oh, fuck you. I give up.
                            </p>
                            <h3>
                                Strike
                            </h3>
                            <p>
                                If you’re still not convinced that drag and drop sucks, read <a href="http://www.alertdebugging.com/2009/08/16/on-html-5-drag-and-drop/">Francisco Tolmasky’s article</a> on bugs and problems he encountered.
                            </p>
                            <p>
                                In fact, from his piece it almost seems as if the browser vendors have <em>trouble</em> implementing drag and drop.
                            </p>
                            <p>
                                Gee, I wonder why that is.
                            </p>
                            <p>
                                But I’m not going to figure it out. I’ve had enough.
                            </p>
                            <p>
                                Any unanswered questions you might have after reading this piece will remain unanswered for all eternity, as far as I’m concerned. I don’t see why I should spend another two to three (unpaid) days on this pile of junk.
                            </p>
                            <p>
                                Go do your own research for a change.
                            </p>
                            <p>
                                And don’t bother leaving pointers to useful articles and stuff. I just don’t care any more, and I’m <em>certainly</em> not going to read them.
                            </p>
                            <p>
                                I’m on strike.
                            </p>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://www.quirksmode.org/blog/archives/2009/09/the_html5_drag.html">http://www.quirksmode.org/blog/archives/2009/09/the_html5_drag.html</a>
                    </p>
                </div>
            </article>
            <nav id="post-nav"></nav><script id="discus-javascript">
    var disqus_shortname = 'improbable';

                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    document.getElementsByTagName('body')[0].appendChild(dsq);
                })();
            </script><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            <div id="disqus_thread"></div>
        </section>
        <footer id="site-footer">
            <p>
                This site is purely my personal work and does not reflect the views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
            </p>
        </footer><script async="" defer src="/static/js/common.js">
</script><script id="google-analytics">
    var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-2097834-1']);
            _gaq.push(['_setDomainName', 'improbable.org']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    </body>
</html>
