<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>NaCl: DJB’s new crypto library</title>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/static/css/main.min.css" type="text/css" media="all">
        <!--[if lte IE 8]>
            <link
                rel="stylesheet"
                href="/static/css/ie-fixes.css"
                type="text/css"
                media="all"
            />
            <script src="/static/js/html5shiv.js"></script>
        <![endif]-->

        <meta http-equiv="last-modified" content="Tue, 14 Jul 2009 19:53:21 GMT">
        <link rel="alternate" type="application/atom+xml" title="All Posts (Atom)" href="/feeds/all.atom">
        <link rel="alternate" type="application/rss+xml" title="All Posts (RSS)" href="/feeds/all.rss">
        <link rel="icon" type="image/jpeg" sizes="287x287" href="/static/img/favicon-287x287.jpg">
        <link rel="icon" type="image/jpeg" sizes="128x128" href="/static/img/favicon-128x128.jpg">
    </head>
    <body class="blog post_detail" itemscope itemtype="http://schema.org/BlogPosting">
        <nav id="site-nav">
            <header id="about">
                <h1><a href="/about/">Chris Adams</a></h1>
                <h2>Programmer, cyclist, photographer</h2>
            </header>
            <ul class="links">
                <li>
                    <a href="/">Home</a>
                </li>
                <li>
                    <a href="/about/">About</a>
                </li>
                <li>
                    <a href="/feeds/all.atom" title="Site Feed">Site Feed</a>
                </li>
            </ul>
            <ul class="social-networks">
                <li>
                    <a rel="me" href="https://code4lib.social/@acdha">Mastodon</a>
                </li>
                <li>
                    <a href="https://github.com/acdha" rel="me">Github</a>
                </li>
                <li>
                    <a href="https://bitbucket.org/acdha" rel="me">Bitbucket</a>
                </li>
                <li>
                    <a href="https://pinboard.in/u:acdha/" rel="me">Pinboard</a>
                </li>
                <li>
                    <a href="https://www.flickr.com/photos/acdha" rel="me">Flickr</a>
                </li>
                <li>
                    <a href="https://www.linkedin.com/in/acdha" rel="me">LinkedIn</a>
                </li>
            </ul>
            <div id="site-search"></div>
        </nav>
        <section id="main">
            <article class="post">
                <header>
                    <meta itemprop="dateCreated" content="2009-07-14T15:53:21-04:00">
                    <meta itemprop="dateModified" content="2009-07-14T15:53:21-04:00">
                    <time class="date" itemprop="datePublished" datetime="2009-07-14T19:53:21+00:00">Jul 14</time>
                    <h2 class="" itemprop="title">NaCl: DJB’s new crypto library</h2>
                </header>

                <div class="body" itemprop="articleBody"><div class="googlereader description" data-google-id="tag:google.com,2005:reader/item/a15d24f2c14a3017">
                        <blockquote>
                            <div>
                                <br>
                                <p>
                                    <a href="http://nacl.cace-project.eu/">NaCl</a> is a new crypto library, courtesy of <a href="http://cr.yp.to/">Dan Bernstein</a> of <a href="http://cr.yp.to/qmail.html">qmail</a> fame and <a href="http://www.hyperelliptic.org/tanja/">Tanja Lange</a>. After my <a href="http://rdist.root.org/2009/05/20/amazon-web-services-signature-vulnerability/">series</a> of <a href="http://rdist.root.org/2009/06/10/when-crypto-attacks-slides-posted/">posts</a> on why crypto libraries have seriously hurt web security by offering an API that is <a href="http://www.matasano.com/log/1749/typing-the-letters-a-e-s-into-your-code-youre-doing-it-wrong/">too low-level</a>, I was pleased to find NaCl’s main interface is high-level. In addition to the kind of fanatical attention to security you can expect from DJB, it also has his unique (some would say quirky) viewpoint.
                                </p>
                                <p>
                                    On a related note, I’m sorry to say I have to withdraw my recommendation of Google <a href="http://www.keyczar.org/">Keyczar</a>. It has had another <a href="http://groups.google.com/group/keyczar-discuss/browse_thread/thread/781c4db2c0b72b36">vulnerability announced</a>, this time in the random source for the python library. This is exactly the same attack against DSA I <a href="http://rdist.root.org/2009/05/17/the-debian-pgp-disaster-that-almost-was/">described previously</a>. I may reconsider this decision as it matures.
                                </p>
                                <p>
                                    There’s a lot Keyczar gets right. Its high-level API and key management make a lot of sense. Up until recently, there haven’t been many high-level libraries I could recommend. Gutmann’s <a href="http://www.cryptlib.com/">cryptlib</a> is probably the best one. It has been around a while and is implemented in C with multiple language bindings. It is covered by the <a href="http://www.cryptlib.com/security-faq.htm#How_is_Cryptlib_licensed_">Sleepycat license</a>, so it works like the GPL or you can pay for closed-source use. <a href="http://www.gnupg.org/gpgme.html">GPGME</a> provides well-reviewed crypto with the simple PGP usage model. However, it only offers a C API. It also works by forking the command-line gpg underneath, something that may bother some developers. It is covered by the LGPL license.
                                </p>
                                <p>
                                    While cryptlib and GPGME have been around a while, I have not personally reviewed either of them and can’t vouch for their implementation security. When I found the <a href="http://rdist.root.org/2009/05/28/timing-attack-in-google-keyczar-library/">timing attack in Keyczar’s HMAC verification</a>, I took a brief look around. It seemed ok overall, but I did not do a thorough review. I was so glad to see another high-level library that I included Keyczar along with cryptlib and GPGME as a good alternative to implementing your own crypto in a <a href="http://rdist.root.org/2009/06/10/when-crypto-attacks-slides-posted/">recent talk</a>. I should have emphasized that while these libraries are taking the right approach, we need much more thorough reviews by cryptographers before standardizing on them. Keyczar, as the newest library of those three, deserved a note that it especially needed review.
                                </p>
                                <p>
                                    NaCl is the latest entry on the scene and it shows a lot of promise. Take a moment to read its design <a href="http://nacl.cace-project.eu/features.html">features</a>. The code is public domain. It offers a set of high-level functions such as:
                                </p>
                                <ul>
                                    <li>
                                        <a href="http://nacl.cace-project.eu/box.html">Public-key authenticated encryption</a>: establish a shared key with an authenticated partner, encrypt, and integrity-protect each message.<br>
                                        Analogy: the SSL protocol
                                    </li>
                                    <li>
                                        <a href="http://nacl.cace-project.eu/secretbox.html">Secret-key authenticated encryption</a>: encryption and integrity protection for messages, using a pre-selected secret key.<br>
                                        Analogy: IPSEC with encryption and authentication using a pre-shared key
                                    </li>
                                    <li>
                                        <a href="http://nacl.cace-project.eu/auth.html">Secret-key authentication</a>: integrity protection for a message using a pre-selected secret key<br>
                                        Analogy: HMAC-protected cookies
                                    </li>
                                    <li>Other low-level primitives such as a <a href="http://nacl.cace-project.eu/stream.html">stream cipher</a> and <a href="http://nacl.cace-project.eu/hash.html">hash</a>.
                                    </li>
                                </ul>
                                <p>
                                    There are some good things to be excited about here. The design is extremely high-speed, although that isn’t my personal priority. The high-level APIs are good but not perfect. For example, the caller is expected to specify a nonce and set certain bytes to zero for <em><a href="http://nacl.cace-project.eu/box.html">crypto_box</a></em>. This is a little too much control for a high-level API. It might be better if NaCl created its own nonce using its PRNG (/dev/urandom, actually), and then focused on making sure it was seeded well.
                                </p>
                                <p>
                                    The design and implementation security, as expected for DJB, is excellent. (Note that I have not done a thorough review and thus cannot yet recommend it.) For example, he focuses on side channel resistance, creating a non-branching<a href="http://nacl.cace-project.eu/scalarmult.html">scalar multiplication routine</a> and an <a href="http://nacl.cace-project.eu/verify.html">API for comparing secrets</a> that resists timing attacks. Also, his design choice of using ECDH, a stream cipher, and a MAC algorithm to implement <em>crypto_box</em> fit together well.
                                </p>
                                <p>
                                    However, that’s where the quirkiness comes in. As with qmail, DJB has a really unique way of doing things. The default ECDH implementation uses <a href="http://cr.yp.to/papers.html#curve25519">Curve25519</a>, the stream cipher is <a href="http://cr.yp.to/papers.html#salsafamily">Salsa20</a>, and the authenticator is <a href="http://http://cr.yp.to/papers.html#poly1305">Poly1305</a>. All of these are primitives designed by DJB in the past four years. If it wasn’t DJB, you’d think I was crazy to even consider a library that implements all new ciphers and constructions. Even though I respect him and these may turn out to be good choices, four years is not enough time to review all of these to be certain they are sound. This will limit NaCl’s appeal until more standard ciphers are available.
                                </p>
                                <p>
                                    While NaCl is a good start, here’s what is missing before it can be more widely adopted:
                                </p>
                                <ul>
                                    <li>Language bindings: NaCl is C-only for now and needs at least Java, python, and C# bindings
                                    </li>
                                    <li>More standard crypto primitives: NIST P-256 or other curves, AES, and SHA2-HMAC
                                    </li>
                                    <li>Signature API: ability to do public-key signatures
                                    </li>
                                </ul>
                                <p>
                                    Since all these items are <a href="http://nacl.cace-project.eu/features.html">marked TODO</a>, it’s clear that Dan recognizes the need for them as well. Perhaps NaCl will mature into the library of choice in the future. If you’re a cryptographer and have a chance to review it, please publish your findings. If you’re a developer, how about contributing language bindings?
                                </p>
                                <p>
                                    On a side note, I’m convinced that the right way to create a crypto library is to do a single implementation in C with architecture awareness (e.g., cache layout, some assembly language) and then offer language bindings. This is the route NaCl and cryptlib took. It’s nearly impossible to prevent side channel attacks when your crypto is implemented in a high-level language.
                                </p><a rel="nofollow" href="http://feeds.wordpress.com/1.0/gocomments/rdist.wordpress.com/395/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/comments/rdist.wordpress.com/395/"></a> <a rel="nofollow" href="http://feeds.wordpress.com/1.0/godelicious/rdist.wordpress.com/395/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/delicious/rdist.wordpress.com/395/"></a> <a rel="nofollow" href="http://feeds.wordpress.com/1.0/gostumble/rdist.wordpress.com/395/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/stumble/rdist.wordpress.com/395/"></a> <a rel="nofollow" href="http://feeds.wordpress.com/1.0/godigg/rdist.wordpress.com/395/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/digg/rdist.wordpress.com/395/"></a> <a rel="nofollow" href="http://feeds.wordpress.com/1.0/goreddit/rdist.wordpress.com/395/"><img alt="" border="0" src="http://feeds.wordpress.com/1.0/reddit/rdist.wordpress.com/395/"></a> <img alt="" border="0" src="http://stats.wordpress.com/b.gif?host=rdist.root.org&amp;blog=893473&amp;post=395&amp;subd=rdist&amp;ref=&amp;feed=1">
                            </div>
                        </blockquote>
                    </div>
                    <p class="bookmark-source">
                        Source: <a href="http://rdist.root.org/2009/07/14/nacl-djbs-new-crypto-library/">http://rdist.root.org/2009/07/14/nacl-djbs-new-crypto-library/</a>
                    </p>
                </div>
            </article>

            <nav id="post-nav">


            </nav>
        </section>

        <footer id="site-footer" class="nocontent">
            <p>
                This site is purely my personal work and does not reflect the
                views of my employer.
            </p>
            <p class="license">
                <a class="icon" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width: 0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png"></a>
                This work is licensed under a
                <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported
                    License</a>.
            </p>
        </footer>

        <script async src="/static/js/common.js"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.min.js" integrity="sha256-hj+5FRlAuvAFANiefn0PpJYCkV1X4QT9EgiPd+6QnCw=" crossorigin="anonymous"></script>
    </body>
</html>
